gplink-2.1.1 (Sep 26 2017)
Listing File Generated: 2017-11-22  20:00:24
 
 
Address  Value    Disassembly              Source
-------  -----    -----------              ------
                                           ; -------------------------------------------------------------------------
                                           ;  _gptrget1.S - read one byte pointed to by a generic pointer
                                           ;
                                           ;  Copyright (C) 2005, Raphael Neider <rneider AT web.de>
                                           ;
                                           ;  This library is free software; you can redistribute it and/or modify it
                                           ;  under the terms of the GNU General Public License as published by the
                                           ;  Free Software Foundation; either version 2, or (at your option) any
                                           ;  later version.
                                           ;
                                           ;  This library is distributed in the hope that it will be useful,
                                           ;  but WITHOUT ANY WARRANTY; without even the implied warranty of
                                           ;  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
                                           ;  GNU General Public License for more details.
                                           ;
                                           ;  You should have received a copy of the GNU General Public License 
                                           ;  along with this library; see the file COPYING. If not, write to the
                                           ;  Free Software Foundation, 51 Franklin Street, Fifth Floor, Boston,
                                           ;   MA 02110-1301, USA.
                                           ;
                                           ;  As a special exception, if you link this library with other files,
                                           ;  some of which are compiled with SDCC, to produce an executable,
                                           ;  this library does not by itself cause the resulting executable to
                                           ;  be covered by the GNU General Public License. This exception does
                                           ;  not however invalidate any other reasons why the executable file
                                           ;  might be covered by the GNU General Public License.
                                           ;--------------------------------------------------------------------------
                                           
                                           ; calling conventions:
                                           ;   3 byte generic pointer is passed in via (WREG STK00 STK01).
                                           ;   The result is returned in (WREG (STK00 (STK01 (STK02)))).
                                           ;
                                           ;   unsigned char _gptrget  (void *gptr);
                                           ;   unsigned char _gptrget1 (void *gptr);
                                           ;   unsigned int  _gptrget2 (void *gptr);
                                           ;   void *        _gptrget3 (void *gptr);
                                           ;   unsigned long _gptrget4 (void *gptr);
                                           ;
                                           ;   void _gptrput  (void *ptr, unsigned char val);
                                           ;   void _gptrput1 (void *ptr, unsigned char val);
                                           ;   void _gptrput2 (void *ptr, unsigned int  val);
                                           ;   void _gptrput3 (void *ptr, unsigned int  val);
                                           ;   void _gptrput4 (void *ptr, unsigned long val);
                                           
                                           include macros.inc
                                           UD_abs_mc35p7041_82	udata_ovr  	0x0082
                                           _HIBYTE
                                              	res	1
                                           UD_abs_mc35p7041_83	udata_ovr  	0x0083
                                           _FSR0
                                              	res	1
                                           UD_abs_mc35p7041_84	udata_ovr  	0x0084
                                           _FSR1
                                              	res	1
                                           UD_abs_mc35p7041_86	udata_ovr  	0x0086
                                           _STATUS
                                              	res	1
                                           UD_abs_mc35p7041_ce	udata_ovr  	0x00ce
                                           _PCL
                                              	res	1
                                           UD_abs_mc35p7041_cf	udata_ovr  	0x00cf
                                           _PCH
                                              	res	1
                                           UD_abs_mc35p7041_e7	udata_ovr  	0x00e7 
                                           _INDF
                                              	res	1
                                           
                                           
                                           
                                           
                                           ; -----------------------------------------------
                                           ; --- extern declared SFRs
                                           ; -----------------------------------------------
                                           ;  	extern _STATUS
                                           ;  	extern _FSR0
                                           ;  	extern _FSR1
                                           ;  	extern _INDF0
                                           ;  	extern _INDF1
                                           ;  	extern _INDF2
                                           ;  	extern _INDF3
                                           ;  	extern _FSR
                                           ;  	extern _INDF
                                           ;  	extern _PCLATH
                                           ;  	extern _PCL
                                              	
                                           
                                           C  	EQU	2
                                           DC 	EQU	1
                                           Z  	EQU	0
                                           IRP	EQU	7
                                              	
                                           ; -----------------------------------------------
                                           ; --- generic pointer access helpers
                                           ; -----------------------------------------------
                                           
                                           GPTRTAG_DATA   	EQU	0x00
                                           GPTRTAG_CODE   	EQU	0x80
                                           
                                           ; setup FSR to point to (STK00:STK01)
                                           setup_fsr  	macro
000044   1e00     movar   0                	movar	STK00
000045   1f84     movra   0x84             	movra	_FSR1
000046   1e01     movar   0x1              	movar	STK01
000047   1f83     movra   0x83             	movra	_FSR0
                                           	endm
                                           
                                           inc_fsr	   	macro
                                              	;;incr 	_FSR
                                              	movai	1
                                              	addra 	_FSR0
                                              	jbclr	_STATUS, Z
                                              	addra	_FSR1
                                           	endm
                                           
                                           ; dispatch according to gptr type
                                           select_routine 	macro  	dataptr, codeptr
                                              	; __data pointer tag: 0x00
00003e   1d00     xorai   0                	xorai  	GPTRTAG_DATA
00003f   5086     jbclr   0x86, 0          	jbclr  	_STATUS, Z
000040   8044     goto    0x44             	goto   	dataptr
                                              	; __code pointer tag: 0x80
000041   1d80     xorai   0x80             	xorai  	(GPTRTAG_DATA ^ GPTRTAG_CODE)
000042   5086     jbclr   0x86, 0          	jbclr  	_STATUS, Z
000043   804a     goto    0x4a             	goto   	codeptr
                                           	endm
                                           
                                           check_data 	macro  	dataptr
                                              	; __data pointer tag: 0x00
                                           	xorai  	GPTRTAG_DATA
                                           	jbclr  	_STATUS, Z
                                           	goto   	dataptr
                                           	endm
                                           
                                           include mc30f_common.inc
                                           ;--------------------------------------------------------------------------
                                           ;  p16f_common.inc - definitions common to all 14 bit PIC devices
                                           ;
                                           ;  Copyright (C) 2005, Vangelis Rokas <vrokas AT otenet.gr>
                                           ;
                                           ;  This library is free software; you can redistribute it and/or modify it
                                           ;  under the terms of the GNU General Public License as published by the
                                           ;  Free Software Foundation; either version 2, or (at your option) any
                                           ;  later version.
                                           ;
                                           ;  This library is distributed in the hope that it will be useful,
                                           ;  but WITHOUT ANY WARRANTY; without even the implied warranty of
                                           ;  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
                                           ;  GNU General Public License for more details.
                                           ;
                                           ;  You should have received a copy of the GNU General Public License 
                                           ;  along with this library; see the file COPYING. If not, write to the
                                           ;  Free Software Foundation, 51 Franklin Street, Fifth Floor, Boston,
                                           ;   MA 02110-1301, USA.
                                           ;
                                           ;  As a special exception, if you link this library with other files,
                                           ;  some of which are compiled with SDCC, to produce an executable,
                                           ;  this library does not by itself cause the resulting executable to
                                           ;  be covered by the GNU General Public License. This exception does
                                           ;  not however invalidate any other reasons why the executable file
                                           ;  might be covered by the GNU General Public License.
                                           ;--------------------------------------------------------------------------
                                           
                                           	extern	STK00
                                           	extern	STK01
                                           	extern	STK02
                                           	extern	STK03
                                           	extern	STK04
                                           	extern	STK05
                                           	extern	STK06
                                           
                                           
                                           	global	__gptrget
                                           	global	__gptrget1
                                           	global	__codeptrget1
                                           	
                                           	CODE
                                           
                                           __gptrget:
                                           __gptrget1:
                                           	select_routine __dataptrget1, __codeptrget1
                                           
                                           
                                           __dataptrget1:
                                           	setup_fsr
000048   1ee7     movar   0xe7             	movar _INDF
000049   0e00     return                   	return
                                           
                                           __codeptrget1:
                                           	setup_fsr
00004e   0d00     movc                     	movc
00004f   0e00     return                   	return
                                           
                                           	END
                                           ; -------------------------------------------------------------------------
                                           ;  _gptrput1.S : write one byte pointed to by a generic pointer
                                           ;
                                           ;  Copyright (C) 2005, Raphael Neider <rneider AT web.de>
                                           ;
                                           ;  This library is free software; you can redistribute it and/or modify it
                                           ;  under the terms of the GNU General Public License as published by the
                                           ;  Free Software Foundation; either version 2, or (at your option) any
                                           ;  later version.
                                           ;
                                           ;  This library is distributed in the hope that it will be useful,
                                           ;  but WITHOUT ANY WARRANTY; without even the implied warranty of
                                           ;  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
                                           ;  GNU General Public License for more details.
                                           ;
                                           ;  You should have received a copy of the GNU General Public License 
                                           ;  along with this library; see the file COPYING. If not, write to the
                                           ;  Free Software Foundation, 51 Franklin Street, Fifth Floor, Boston,
                                           ;   MA 02110-1301, USA.
                                           ;
                                           ;  As a special exception, if you link this library with other files,
                                           ;  some of which are compiled with SDCC, to produce an executable,
                                           ;  this library does not by itself cause the resulting executable to
                                           ;  be covered by the GNU General Public License. This exception does
                                           ;  not however invalidate any other reasons why the executable file
                                           ;  might be covered by the GNU General Public License.
                                           ;--------------------------------------------------------------------------
                                           
                                           ; calling conventions:
                                           ;   3 byte generic pointer is passed in via (WREG STK00 STK01).
                                           ;   The result is returned in (WREG (STK00 (STK01 (STK02)))).
                                           ;
                                           ;   unsigned char _gptrget  (void *gptr);
                                           ;   unsigned char _gptrget1 (void *gptr);
                                           ;   unsigned int  _gptrget2 (void *gptr);
                                           ;   void *        _gptrget3 (void *gptr);
                                           ;   unsigned long _gptrget4 (void *gptr);
                                           ;
                                           ;   void _gptrput  (void *ptr, unsigned char val);
                                           ;   void _gptrput1 (void *ptr, unsigned char val);
                                           ;   void _gptrput2 (void *ptr, unsigned int  val);
                                           ;   void _gptrput3 (void *ptr, unsigned int  val);
                                           ;   void _gptrput4 (void *ptr, unsigned long val);
                                           
                                           include macros.inc
                                           UD_abs_mc35p7041_82	udata_ovr  	0x0082
                                           _HIBYTE
                                              	res	1
                                           UD_abs_mc35p7041_83	udata_ovr  	0x0083
                                           _FSR0
                                              	res	1
                                           UD_abs_mc35p7041_84	udata_ovr  	0x0084
                                           _FSR1
                                              	res	1
                                           UD_abs_mc35p7041_86	udata_ovr  	0x0086
                                           _STATUS
                                              	res	1
                                           UD_abs_mc35p7041_ce	udata_ovr  	0x00ce
                                           _PCL
                                              	res	1
                                           UD_abs_mc35p7041_cf	udata_ovr  	0x00cf
                                           _PCH
                                              	res	1
                                           UD_abs_mc35p7041_e7	udata_ovr  	0x00e7 
                                           _INDF
                                              	res	1
                                           
                                           
                                           
                                           
                                           ; -----------------------------------------------
                                           ; --- extern declared SFRs
                                           ; -----------------------------------------------
                                           ;  	extern _STATUS
                                           ;  	extern _FSR0
                                           ;  	extern _FSR1
                                           ;  	extern _INDF0
                                           ;  	extern _INDF1
                                           ;  	extern _INDF2
                                           ;  	extern _INDF3
                                           ;  	extern _FSR
                                           ;  	extern _INDF
                                           ;  	extern _PCLATH
                                           ;  	extern _PCL
                                              	
                                           
                                           C  	EQU	2
                                           DC 	EQU	1
                                           Z  	EQU	0
                                           IRP	EQU	7
                                              	
                                           ; -----------------------------------------------
                                           ; --- generic pointer access helpers
                                           ; -----------------------------------------------
                                           
                                           GPTRTAG_DATA   	EQU	0x00
                                           GPTRTAG_CODE   	EQU	0x80
                                           
                                           ; setup FSR to point to (STK00:STK01)
                                           setup_fsr  	macro
000054   1e00     movar   0                	movar	STK00
000055   1f84     movra   0x84             	movra	_FSR1
000056   1e01     movar   0x1              	movar	STK01
000057   1f83     movra   0x83             	movra	_FSR0
                                           	endm
                                           
                                           inc_fsr	   	macro
                                              	;;incr 	_FSR
                                              	movai	1
                                              	addra 	_FSR0
                                              	jbclr	_STATUS, Z
                                              	addra	_FSR1
                                           	endm
                                           
                                           ; dispatch according to gptr type
                                           select_routine 	macro  	dataptr, codeptr
                                              	; __data pointer tag: 0x00
                                           	xorai  	GPTRTAG_DATA
                                           	jbclr  	_STATUS, Z
                                           	goto   	dataptr
                                              	; __code pointer tag: 0x80
                                           	xorai  	(GPTRTAG_DATA ^ GPTRTAG_CODE)
                                           	jbclr  	_STATUS, Z
                                           	goto   	codeptr
                                           	endm
                                           
                                           check_data 	macro  	dataptr
                                              	; __data pointer tag: 0x00
000050   1d00     xorai   0                	xorai  	GPTRTAG_DATA
000051   5086     jbclr   0x86, 0          	jbclr  	_STATUS, Z
000052   8054     goto    0x54             	goto   	dataptr
                                           	endm
                                           
                                           include mc30f_common.inc
                                           ;--------------------------------------------------------------------------
                                           ;  p16f_common.inc - definitions common to all 14 bit PIC devices
                                           ;
                                           ;  Copyright (C) 2005, Vangelis Rokas <vrokas AT otenet.gr>
                                           ;
                                           ;  This library is free software; you can redistribute it and/or modify it
                                           ;  under the terms of the GNU General Public License as published by the
                                           ;  Free Software Foundation; either version 2, or (at your option) any
                                           ;  later version.
                                           ;
                                           ;  This library is distributed in the hope that it will be useful,
                                           ;  but WITHOUT ANY WARRANTY; without even the implied warranty of
                                           ;  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
                                           ;  GNU General Public License for more details.
                                           ;
                                           ;  You should have received a copy of the GNU General Public License 
                                           ;  along with this library; see the file COPYING. If not, write to the
                                           ;  Free Software Foundation, 51 Franklin Street, Fifth Floor, Boston,
                                           ;   MA 02110-1301, USA.
                                           ;
                                           ;  As a special exception, if you link this library with other files,
                                           ;  some of which are compiled with SDCC, to produce an executable,
                                           ;  this library does not by itself cause the resulting executable to
                                           ;  be covered by the GNU General Public License. This exception does
                                           ;  not however invalidate any other reasons why the executable file
                                           ;  might be covered by the GNU General Public License.
                                           ;--------------------------------------------------------------------------
                                           
                                           	extern	STK00
                                           	extern	STK01
                                           	extern	STK02
                                           	extern	STK03
                                           	extern	STK04
                                           	extern	STK05
                                           	extern	STK06
                                           
                                           
                                           	global	__gptrput
                                           	global	__gptrput1
                                           	
                                           	CODE
                                           
                                           __gptrput:
                                           __gptrput1:
                                           	check_data	__dataptrput1
                                           	; cannot write to __code space
000053   0e00     return                   	return
                                           
                                           __dataptrput1:
                                           	setup_fsr
000058   1e02     movar   0x2              	movar STK02		; get LSB(val)
000059   1fe7     movra   0xe7             	movra _INDF
00005a   0e00     return                   	return
                                           
                                           	END
                                           ;#include "2K7041.inc"
                                           ;#include "_gptrget1.S"
                                           
                                           sharebank  	udata_ovr  	0x0000 
                                           STK00  	res 1
                                           STK01  	res 1
                                           STK02  	res 1
                                           STK03  	res 1
                                           STK04  	res 1
                                           STK05  	res 1
                                           STK06  	res 1  
                                              	   	
                                              	global 	STK00
                                              	global 	STK01
                                              	global 	STK02
                                              	global 	STK03
                                              	global 	STK04
                                              	global 	STK05
                                              	global 	STK06
                                              	   	
                                              	extern __gptrget
                                              	extern __gptrput
                                              	extern __gptrget2
                                           
                                           
                                           ID_aaa_0   	code 0x2ff
                                           _rom
0002ff   0055     dw      0x55                	dw 0x55
000300   0066     dw      0x66                	dw 0x66
000301   0077     dw      0x77                	dw 0x77
000302   0088     dw      0x88                	dw 0x88
                                           
                                           UD_abs_aaa_20  	udata_ovr  	0x0020
                                           ram0 res 1
                                           ram1 res 1
                                           ram2 res 1
                                           ram3 res 1
                                           
                                           data_try udata_ovr 0x30
                                           td0 res 1
                                           td1 res 1
                                           td2 res 1
                                           td3 res 1
                                           
                                           STARTUP	code 0x0000
000000   8001     goto    0x1                 	goto start
                                           
                                           start:
000001   c008     call    0x8                 	call td_init
                                              	
000002   c011     call    0x11                	call t_gptrget_d   	; (ram0) <= 0x11
000003   c019     call    0x19                	call t_getrget_c   	; (ram0) <= 0x55
000004   c021     call    0x21                	call t_gptrput 	   	; (ram0) <= 0x12
000005   c02a     call    0x2a                	call t_gptrget2_d  	; (ram1:ram0) <= 0x2211
000006   c034     call    0x34                	call t_gptrget2_c  	; (ram1:ram0) <= 0x6655
                                              	
000007   8007     goto    0x7                 	goto $
                                              	
                                           td_init:
000008   2d11     movai   0x11                	movai 0x11
000009   1f30     movra   0x30                	movra td0
00000a   2d22     movai   0x22                	movai 0x22
00000b   1f31     movra   0x31                	movra td1
00000c   2d33     movai   0x33                	movai 0x33
00000d   1f32     movra   0x32                	movra td2
00000e   2d44     movai   0x44                	movai 0x44
00000f   1f33     movra   0x33                	movra td3
000010   0e00     return                      	return
                                           
                                           t_gptrget_d:
000011   2d30     movai   0x30                	movai (td0)
000012   1f01     movra   0x1                 	movra STK01
000013   2d00     movai   0                   	movai high(td0)
000014   1f00     movra   0                   	movra STK00
000015   2d00     movai   0                   	movai 0x00
000016   c03e     call    0x3e                	call __gptrget
000017   1f20     movra   0x20                	movra ram0
000018   0e00     return                      	return
                                           
                                           t_getrget_c:
000019   2dff     movai   0xff                	movai (_rom)
00001a   1f01     movra   0x1                 	movra STK01
00001b   2d02     movai   0x2                 	movai high(_rom)
00001c   1f00     movra   0                   	movra STK00
00001d   2d80     movai   0x80                	movai 0x80
00001e   c03e     call    0x3e                	call __gptrget
00001f   1f20     movra   0x20                	movra ram0
000020   0e00     return                      	return
                                              	
                                           t_gptrput:
000021   2d12     movai   0x12                	movai 0x12
000022   1f02     movra   0x2                 	movra STK02
000023   2d20     movai   0x20                	movai (ram0)
000024   1f01     movra   0x1                 	movra STK01
000025   2d00     movai   0                   	movai high(ram0)
000026   1f00     movra   0                   	movra STK00
000027   2d00     movai   0                   	movai 0x00
000028   c050     call    0x50                	call __gptrput
000029   0e00     return                      	return
                                           
                                           t_gptrget2_d:
00002a   2d30     movai   0x30                	movai (td0)
00002b   1f01     movra   0x1                 	movra STK01
00002c   2d00     movai   0                   	movai high(td0)
00002d   1f00     movra   0                   	movra STK00
00002e   2d00     movai   0                   	movai 0x00
00002f   c05b     call    0x5b                	call __gptrget2
000030   1f21     movra   0x21                	movra ram1
000031   1e00     movar   0                   	movar STK00
000032   1f20     movra   0x20                	movra ram0
000033   0e00     return                      	return
                                           
                                           t_gptrget2_c:
000034   2dff     movai   0xff                	movai (_rom)
000035   1f01     movra   0x1                 	movra STK01
000036   2d02     movai   0x2                 	movai high(_rom)
000037   1f00     movra   0                   	movra STK00
000038   2d80     movai   0x80                	movai 0x80
000039   c05b     call    0x5b                	call __gptrget2
00003a   1f21     movra   0x21                	movra ram1
00003b   1e00     movar   0                   	movar STK00
00003c   1f20     movra   0x20                	movra ram0
00003d   0e00     return                      	return
                                           
                                              	end
                                           ; -------------------------------------------------------------------------
                                           ;  _gptrget2.S - read two bytes pointed to by a generic pointer
                                           ;
                                           ;  Copyright (C) 2005, Raphael Neider <rneider AT web.de>
                                           ;
                                           ;  This library is free software; you can redistribute it and/or modify it
                                           ;  under the terms of the GNU General Public License as published by the
                                           ;  Free Software Foundation; either version 2, or (at your option) any
                                           ;  later version.
                                           ;
                                           ;  This library is distributed in the hope that it will be useful,
                                           ;  but WITHOUT ANY WARRANTY; without even the implied warranty of
                                           ;  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
                                           ;  GNU General Public License for more details.
                                           ;
                                           ;  You should have received a copy of the GNU General Public License 
                                           ;  along with this library; see the file COPYING. If not, write to the
                                           ;  Free Software Foundation, 51 Franklin Street, Fifth Floor, Boston,
                                           ;   MA 02110-1301, USA.
                                           ;
                                           ;  As a special exception, if you link this library with other files,
                                           ;  some of which are compiled with SDCC, to produce an executable,
                                           ;  this library does not by itself cause the resulting executable to
                                           ;  be covered by the GNU General Public License. This exception does
                                           ;  not however invalidate any other reasons why the executable file
                                           ;  might be covered by the GNU General Public License.
                                           ;--------------------------------------------------------------------------
                                           
                                           ; calling conventions:
                                           ;   3 byte generic pointer is passed in via (WREG STK00 STK01).
                                           ;   The result is returned in (WREG (STK00 (STK01 (STK02)))).
                                           ;
                                           ;   unsigned char _gptrget  (void *gptr);
                                           ;   unsigned char _gptrget1 (void *gptr);
                                           ;   unsigned int  _gptrget2 (void *gptr);
                                           ;   void *        _gptrget3 (void *gptr);
                                           ;   unsigned long _gptrget4 (void *gptr);
                                           ;
                                           ;   void _gptrput  (void *ptr, unsigned char val);
                                           ;   void _gptrput1 (void *ptr, unsigned char val);
                                           ;   void _gptrput2 (void *ptr, unsigned int  val);
                                           ;   void _gptrput3 (void *ptr, unsigned int  val);
                                           ;   void _gptrput4 (void *ptr, unsigned long val);
                                           
                                           include macros.inc
                                           UD_abs_mc35p7041_82	udata_ovr  	0x0082
                                           _HIBYTE
                                              	res	1
                                           UD_abs_mc35p7041_83	udata_ovr  	0x0083
                                           _FSR0
                                              	res	1
                                           UD_abs_mc35p7041_84	udata_ovr  	0x0084
                                           _FSR1
                                              	res	1
                                           UD_abs_mc35p7041_86	udata_ovr  	0x0086
                                           _STATUS
                                              	res	1
                                           UD_abs_mc35p7041_ce	udata_ovr  	0x00ce
                                           _PCL
                                              	res	1
                                           UD_abs_mc35p7041_cf	udata_ovr  	0x00cf
                                           _PCH
                                              	res	1
                                           UD_abs_mc35p7041_e7	udata_ovr  	0x00e7 
                                           _INDF
                                              	res	1
                                           
                                           
                                           
                                           
                                           ; -----------------------------------------------
                                           ; --- extern declared SFRs
                                           ; -----------------------------------------------
                                           ;  	extern _STATUS
                                           ;  	extern _FSR0
                                           ;  	extern _FSR1
                                           ;  	extern _INDF0
                                           ;  	extern _INDF1
                                           ;  	extern _INDF2
                                           ;  	extern _INDF3
                                           ;  	extern _FSR
                                           ;  	extern _INDF
                                           ;  	extern _PCLATH
                                           ;  	extern _PCL
                                              	
                                           
                                           C  	EQU	2
                                           DC 	EQU	1
                                           Z  	EQU	0
                                           IRP	EQU	7
                                              	
                                           ; -----------------------------------------------
                                           ; --- generic pointer access helpers
                                           ; -----------------------------------------------
                                           
                                           GPTRTAG_DATA   	EQU	0x00
                                           GPTRTAG_CODE   	EQU	0x80
                                           
                                           ; setup FSR to point to (STK00:STK01)
                                           setup_fsr  	macro
000061   1e00     movar   0                	movar	STK00
000062   1f84     movra   0x84             	movra	_FSR1
000063   1e01     movar   0x1              	movar	STK01
000064   1f83     movra   0x83             	movra	_FSR0
                                           	endm
                                           
                                           inc_fsr	   	macro
                                              	;;incr 	_FSR
000067   2d01     movai   0x1                 	movai	1
000068   1383     addra   0x83                	addra 	_FSR0
000069   5086     jbclr   0x86, 0             	jbclr	_STATUS, Z
00006a   1384     addra   0x84                	addra	_FSR1
                                           	endm
                                           
                                           ; dispatch according to gptr type
                                           select_routine 	macro  	dataptr, codeptr
                                              	; __data pointer tag: 0x00
00005b   1d00     xorai   0                	xorai  	GPTRTAG_DATA
00005c   5086     jbclr   0x86, 0          	jbclr  	_STATUS, Z
00005d   8061     goto    0x61             	goto   	dataptr
                                              	; __code pointer tag: 0x80
00005e   1d80     xorai   0x80             	xorai  	(GPTRTAG_DATA ^ GPTRTAG_CODE)
00005f   5086     jbclr   0x86, 0          	jbclr  	_STATUS, Z
000060   806d     goto    0x6d             	goto   	codeptr
                                           	endm
                                           
                                           check_data 	macro  	dataptr
                                              	; __data pointer tag: 0x00
                                           	xorai  	GPTRTAG_DATA
                                           	jbclr  	_STATUS, Z
                                           	goto   	dataptr
                                           	endm
                                           
                                           include mc30f_common.inc
                                           ;--------------------------------------------------------------------------
                                           ;  p16f_common.inc - definitions common to all 14 bit PIC devices
                                           ;
                                           ;  Copyright (C) 2005, Vangelis Rokas <vrokas AT otenet.gr>
                                           ;
                                           ;  This library is free software; you can redistribute it and/or modify it
                                           ;  under the terms of the GNU General Public License as published by the
                                           ;  Free Software Foundation; either version 2, or (at your option) any
                                           ;  later version.
                                           ;
                                           ;  This library is distributed in the hope that it will be useful,
                                           ;  but WITHOUT ANY WARRANTY; without even the implied warranty of
                                           ;  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
                                           ;  GNU General Public License for more details.
                                           ;
                                           ;  You should have received a copy of the GNU General Public License 
                                           ;  along with this library; see the file COPYING. If not, write to the
                                           ;  Free Software Foundation, 51 Franklin Street, Fifth Floor, Boston,
                                           ;   MA 02110-1301, USA.
                                           ;
                                           ;  As a special exception, if you link this library with other files,
                                           ;  some of which are compiled with SDCC, to produce an executable,
                                           ;  this library does not by itself cause the resulting executable to
                                           ;  be covered by the GNU General Public License. This exception does
                                           ;  not however invalidate any other reasons why the executable file
                                           ;  might be covered by the GNU General Public License.
                                           ;--------------------------------------------------------------------------
                                           
                                           	extern	STK00
                                           	extern	STK01
                                           	extern	STK02
                                           	extern	STK03
                                           	extern	STK04
                                           	extern	STK05
                                           	extern	STK06
                                           
                                           
                                           	global	__gptrget2
                                           	extern	__codeptrget1
                                           	
                                           	CODE
                                           
                                           __gptrget2:
                                           	select_routine __dataptrget2, __codeptrget2
                                           
                                           __dataptrget2:
                                           	setup_fsr
000065   1ee7     movar   0xe7             	movar _INDF
000066   1f00     movra   0                	movra STK00
                                           	inc_fsr
00006b   1ee7     movar   0xe7             	movar _INDF
00006c   0e00     return                   	return
                                           
                                           
                                           __codeptrget2:
                                           ;	pagesel	__codeptrget1	; might reside in different page
                                           ;	call	__codeptrget1
                                           ;	movwf	STK02		; temporarily store LSB
                                           ;	incfsz	STK01,F	; increment low address byte
                                           ;	decf	STK00,F	; undo increment of high address byte if low byte did not overflow
                                           ;	incf	STK00,F	; increment high address byte
                                           ;	pagesel	__codeptrget1	; might reside in different page
                                           ;	call	__codeptrget1
                                           ;	movwf	STK03		; temporarily store MSB
                                           ;	movf	STK02, W
                                           ;	movwf	STK00		; LSB in STK00
                                           ;	movf	STK03, W	; MSB in WREG
                                           	setup_fsr
000071   0d00     movc                     	movc
000072   1f00     movra   0                	movra STK00
                                           	inc_fsr
000077   0d00     movc                     	movc
000078   0e00     return                   	return
                                           
                                           	
                                           	END


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)

0000 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XX--------------
05C0 : ---------------- ---------------- ---------------- --------------XX
0600 : XXXXXX---------- ---------------- ---------------- ----------------

All other memory blocks unused.

Program Memory Words Used:   125

