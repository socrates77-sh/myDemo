gpasm-2.0.0_beta1 (Jun 21 2017)main.asm           2017-6-21  15:27:42          PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 
                      00002 
                      00003 ;************************************************
                      00004 ;仿真与烧板子有四处差异，记得修改
                      00005 ;标定准
                      00006 ;**************************************************
                      00007 
                      00008                 ;#include  "mc32p7212.inc"
                      00009 
                      00010 ;==========================================================================
                      00011 ;                               mc33p94
                      00012 ;       Revision History
                      00013 ;
                      00014 ;==========================================================================
                      00015 
                      00016 ;Rev:   Date:    Reason:
                      00017 
                      00018 ;1.00   12/06/21 Initial Release
                      00019 
                      00020 ;==========================================================================
                      00021 ;
                      00022 ;       Verify Processor
                      00023 ;
                      00024 ;==========================================================================
                      00025 ;
                      00026 ;       Register Definitions
                      00027 ;
                      00028 ;==========================================================================
                      00029 
                      00030 ;W              EQU             H'0000'
                      00031 ;F              EQU             H'0001'
                      00032 
                      00033 ;----- Register Files------------------------------------------------------
                      00034 cblock  0x180
                      00035 INDF0
                      00036 INDF1
                      00037 INDF2
                      00038 HIBYTE
                      00039 FSR0
                      00040 FSR1
                      00041 PCL
                      00042 PFALG
                      00043 ;----0x188
                      00044 MCR
                      00045 INDF3
                      00046 INTE0
                      00047 INTF0
                      00048 INVALID_ADDR0
                      00049 INVALID_ADDR1
                      00050 INVALID_ADDR2
                      00051 INVALID_ADDR3
                      00052 ;----0x190
                      00053 IOP0
                      00054 OEP0
                      00055 PUP0
                      00056 INVALID_ADDR4
                      00057 IOP1
                      00058 OEP1
                      00059 PUP1
                      00060 INVALID_ADDR5
                      00061 ;-----0x198
                      00062 OEP2
                      00063 IOP2
                      00064 PUP2
                      00065 INVALID_ADDR6
                      00066 OEP3
                      00067 IOP3
                      00068 PUP3
                      00069 INVALID_ADDR7
                      00070 ;-----0x1a0
                      00071 T0CR
                      00072 T0CNT
                      00073 T0LOAD
                      00074 T0DATA
                      00075 T1CR
                      00076 T1CNT
                      00077 T1LOAD
                      00078 T1DATA
                      00079 ;-----0x1a8
                      00080 LXTCR
                      00081 HIRCCR0
                      00082 HIRCCR1
                      00083 HIRCCR2
                      00084 INVALID_ADDR14
                      00085 PUMP
                      00086 OSCM
                      00087 LVDCR
                      00088 ;-----0x1b0
                      00089 ADCR0
                      00090 ADCR1
                      00091 ADCR2
                      00092 TPSC
                      00093 ADRH
                      00094 ADRM
                      00095 ADRL
                      00096 INVALID_ADDRff
                      00097 ;----0x1b8
                      00098 LCDCR0
                      00099 LCDCR1
                      00100 LCDIOS1
                      00101 LCDIOS2
                      00102 INVALID_ADDR15
                      00103 INVALID_ADDR16
                      00104 INVALID_ADDR17
                      00105 INVALID_ADDR18
                      00106 INVALID_ADDR19
                      00107 INVALID_ADDR20
                      00108 ;----0x1c0
                      00109 LCDDS0
                      00110 LCDDS1
                      00111 LCDDS2
                      00112 LCDDS3
                      00113 LCDDS4
                      00114 LCDDS5
                      00115 LCDDS6
                      00116 LCDDS7
                      00117 ;----0x1c8
                      00118 LCDDS8
                      00119 LCDDS9
                      00120 LCDDSa
                      00121 LCDDSb
                      00122 INVALID_ADDR21
                      00123 INVALID_ADDR22
                      00124 INVALID_ADDR23
                      00125 INVALID_ADDR24
                      00126 endc
                      00127 
  000001F3            00128 OSCCAL          equ             0x1f3
                      00129 
                      00130 #define         STATUS          PFALG
                      00131 #define         INDF            INDF0
                      00132 #define         FSR             FSR0
                      00133 #define         P0HCON          PUP0
                      00134 #define         P1HCON          PUP1
                      00135 #define         INTECON         INTE0
                      00136 #define         INTEFLAG        INTF0
                      00137 #define         LCDDS10         LCDDSa
                      00138 #define         LCDDS11         LCDDSb
                      00139 #define         LCDDS12         LCDDSc
                      00140 #define         LCDDS13         LCDDSd
                      00141 #define         LCDDS14         LCDDSe
                      00142 #define         LCDDS15         LCDDSf
                      00143 
                      00144 ;----- STATUS Bits --------------------------
                      00145 #define         Z               PFALG,2
                      00146 #define         DC              PFALG,1
                      00147 #define         C               PFALG,0
                      00148 
                      00149 ;-------------------------------------------
                      00150 ; Status register bit map
                      00151 
                      00152 ;----- MCR Bits --------------------------
                      00153 #define         GIE             MCR,7
                      00154 
                      00155 ;-----  P2HCON Bits -----------------------
                      00156 #define         P20PH           P2HCON,0
                      00157 #define         P21PH           P2HCON,1
                      00158 #define         P22PH           P2HCON,2
                      00159 #define         P23PH           P2HCON,3
                      00160 #define         P24PH           P2HCON,4
                      00161 #define         P25PH           P2HCON,5
                      00162 #define         P26PH           P2HCON,6
                      00163 #define         P27PH           P2HCON,7
                      00164 ;----- INTECON Bits --------------------------
                      00165 #define         INTE            INTECON
                      00166 #define         ADIE            INTECON,6
                      00167 #define         KBIE            INTECON,4
                      00168 #define         INT1IE          INTECON,3
                      00169 #define         INT0IE          INTECON,2
                      00170 #define         T1IE            INTECON,1
                      00171 #define         T0IE            INTECON,0
                      00172 ;----- INTEFLAG Bits --------------------------
                      00173 #define         INTF            INTEFLAG
                      00174 #define         ADIF            INTF,6
                      00175 #define         KBIF            INTF,4
                      00176 #define         INT1IF          INTF,3
                      00177 #define         INT0IF          INTF,2
                      00178 #define         T1IF            INTF,1
                      00179 #define         T0IF            INTF,0
                      00180 ;----- UCR Bits--------------------------
                      00181 #define         OPEN            UCR,4
                      00182 #define         EPEN            UCR,3
                      00183 #define         UARTEN          UCR,2
                      00184 ;----- UFR ----------------------
                      00185 #define         FREF            UFR,7
                      00186 #define         PAEF            UFR,6
                      00187 #define         OVEF            UFR,5
                      00188 #define         TSEF            UFR,4
                      00189 #define         RDAF            UFR,1
                      00190 #define         TREF            UFR,0
                      00191 ;---- ADCR0 Bits -----------------
                      00192 #define         ADCKS_16        0<<1            ; Fcpu/16
                      00193 #define         ADCKS_8         1<<1            ; Fcpu/8
                      00194 #define         ADCKS_4         2<<1            ; Fcpu/4
                      00195 #define         ADCKS_2         2<<1            ; Fcpu/2
                      00196 #define         ADCHS_0         0<<4            ; AN0
                      00197 #define         ADCHS_1         1<<4            ; AN1
                      00198 #define         ADCHS_2         2<<4            ; AN2
                      00199 #define         ADCHS_3         3<<4            ; AN3
                      00200 #define         ADCHS_4         4<<4            ; AN4
                      00201 #define         ADCHS_5         5<<4            ; AN5
                      00202 #define         ADCHS_6         6<<4            ; AN6
                      00203 #define         ADEN            ADCR0,0
                      00204 #define         ADEOC           ADCR0,3
                      00205 ;---- ADCR1 Bits -----------------
                      00206 #define         ADV_ADD         3               ; VDD
                      00207 #define         ADV_4V          2               ; 4V
                      00208 #define         ADV_3V          1               ; 3V
                      00209 #define         ADV_2V          0               ; 2V
                      00210 #define         ADV_EX          4               ; 外部参考电压
                      00211 ;----- LCDCR0 Bits --------------------------
                      00212 #define         LCDEN           LCDCR0,7
                      00213 #define         VLCDS           LCDCR0,3
                      00214 ;----- T0CR  Bits ----------------
                      00215 #define         TC0EN           T0CR,7
                      00216 #define         PWM0OUT         T0CR,6
                      00217 #define         BUZ0OUT         T0CR,5
                      00218 ;----- T1CR  Bits ----------------
                      00219 #define         TC1EN           T1CR,7
                      00220 #define         PWM1OUT         T1CR,6
                      00221 #define         BUZ1OUT         T1CR,5
                      00222 ;----- OSCM  Bits ----------------
                      00223 #define         STBL            OSCM,5
                      00224 #define         STBH            OSCM,4
                      00225 #define         CLKS            OSCM,2
                      00226 #define         LFEN            OSCM,1
                      00227 #define         HFEN            OSCM,0
                      00228 ;-----  POWCR Bits -------
                      00229 #define         LDOEN           POWCR,7
                      00230 #define         ENB             POWCR,6
                      00231 ;-----  LVDCR Bits -------
                      00232 #define         LVD             PLVDCR,7
                      00233 #define         LVDS            PLVDCR,6
                      00234 ;***********DDR1 DDR2 **********
                      00235 #define         DDR10           DDR1,0
                      00236 #define         DDR11           DDR1,1
                      00237 #define         DDR12           DDR1,2
                      00238 #define         DDR13           DDR1,3
                      00239 
                      00240 #define         DDR20           DDR2,0
                      00241 #define         DDR21           DDR2,1
                      00242 #define         DDR22           DDR2,2
                      00243 #define         DDR23           DDR2,3
                      00244 #define         DDR24           DDR2,4
                      00245 #define         DDR25           DDR2,5
                      00246 #define         DDR26           DDR2,6
                      00247 #define         DDR27           DDR2,7
                      00248 ;******************************
                      00249 
                      00250 
                      00251 ;#define        inca            addai 1
                      00252 
                      00253                 ;#include       "def_men.asm"
                      00254 #define         Buffer0         0x00
                      00255 #define         Buffer1         0x01
                      00256 #define         Buffer2         0x02
                      00257 #define         Buffer3         0x03
                      00258 #define         Buffer4         0x04
                      00259 #define         Buffer5         0x05
                      00260 #define         Buffer6         0x06
                      00261 
                      00262 #define         TempRam1        0x07
                      00263 #define         TempRam2        0x08
                      00264 #define         TempRam3        0x09
                      00265 #define         TempRam4        0x0a
                      00266 #define         TempRam5        0x0b
                      00267 #define         TempRam6        0x0c
                      00268 
                      00269 #define         TempRam11       0x0d
                      00270 #define         TempRam12       0x0e
                      00271 #define         TempRam13       0x0f
                      00272 
                      00273 #define         FtobH           TempRam8
                      00274 #define         FtobL           TempRam9
                      00275 ;************************************************
                      00276 ;************************************************
                      00277 ;Display Ram area
                      00278 ;************************************************
                      00279 #define         Display1        0x10
                      00280 
                      00281 #define         Display2        0x11
                      00282 #define         Dsp_Col         7
                      00283 
                      00284 #define         Display3        0x12
                      00285 #define         Dsp_Point       7
                      00286 
                      00287 #define         Display4        0x13
                      00288 
                      00289 #define         DisplayFs1      0x14
                      00290 
                      00291 ;************************************************
                      00292 ;************************************************
                      00293 #define         SysFlag1        0x015
  00000000            00294 WdtProcADFlag   EQU             0
  00000001            00295 AdcStartFlag    EQU             1
  00000002            00296 AdcOkFlag       EQU             2
  00000003            00297 DataOkFlag      EQU             3
  00000004            00298 SteadyFlag      EQU             4
  00000005            00299 ZeroFlag        EQU             5
  00000006            00300 NegFlag         EQU             6
                      00301 
                      00302 #define         AdcStartFlag    1
                      00303 #define         AdcOkFlag       2
                      00304 #define         SteadyFlag      3
                      00305 
                      00306 ;************************************************
                      00307 #define         H_DR            0x16
                      00308 #define         M_DR            0x17
                      00309 #define         L_DR            0x18
                      00310 
                      00311 #define         H_DRBuf         0x19
                      00312 #define         M_DRBuf         0x1a
                      00313 #define         L_DRBuf         0x1b
                      00314 
                      00315 #define         H_DATA          0x1c
                      00316 #define         M_DATA          0x1d
                      00317 #define         L_DATA          0x1e
                      00318 
                      00319 #define         H_DATAA         0x1f
                      00320 #define         M_DATAA         0x20
                      00321 #define         L_DATAA         0x21
                      00322 
                      00323 #define         H_DATAB         0x22
                      00324 #define         M_DATAB         0x23
                      00325 #define         L_DATAB         0x24
                      00326 
                      00327 #define         H_DATAC         0x25
                      00328 #define         M_DATAC         0x26
                      00329 #define         L_DATAC         0x27
                      00330 
                      00331 ;................................................
                      00332 #define         ADRamH          0x28
                      00333 #define         ADRamM          0x29
                      00334 #define         ADRamL          0x2a
                      00335 
                      00336 #define         AD_Temp0        0x2b
                      00337 #define         AD_Temp1        0x2c
                      00338 #define         AD_Temp2        0x2d
                      00339 #define         AD_Temp3        0x2e
                      00340 
                      00341 ;************************************************
                      00342 ;Counter Area
                      00343 ;************************************************
                      00344 #define         delay_reg       0x34
                      00345 #define         Reg0            0x35
                      00346 #define         Reg1            0x36
                      00347 #define         Reg2            0x37
                      00348 #define         Reg3            0x38
                      00349 ;************************************************
                      00350 ; Int  Buffer  RAM
                      00351 ;************************************************
                      00352 #define         DspZou8Count    0x39
                      00353 
                      00354 #define         WorkRegBank     0x3a
                      00355 #define         StatusBank      0x3b
                      00356 #define         SampleTimes     0x3c
                      00357 
                      00358 #define         TBASE01S        0x3d
                      00359 #define         TBASE05S        0x3e
                      00360 
                      00361 #define         DspData         0x3f
                      00362 #define         DspData1        0x40
                      00363 #define         Tbase1S         0x41
                      00364 #define         AdcCount        0x42
                      00365 
                      00366 #define         StableCount     0x46
                      00367 #define         Count1          0x47
                      00368 
                      00369 #define         CalCount1H      0x48
                      00370 #define         CalCount1L      0x49
                      00371 #define         CalDot1L        0x4A
                      00372 #define         CalDot1H        0x4B
                      00373 #define         CalDot2L        0x4C
                      00374 #define         CalDot2H        0x4D
                      00375 #define         CalDot3L        0x4E
                      00376 #define         CalDot3H        0x4F
                      00377 
                      00378 #define         CalConstL       0x50
                      00379 #define         CalConstH       0x51
                      00380 #define         CountH          0x52
  00000053            00381 CountL          EQU             53H
  00000054            00382 TF1             EQU             54H
  00000055            00383 Key_Up          EQU             55H
  00000000            00384 UnitKey         EQU             0
                      00385 
  00000056            00386 SysFlag3        EQU             56H
  00000000            00387 DspNegFlag      EQU             0
  00000001            00388 DspCalFlag      EQU             1
  00000002            00389 GlintOpen1Flag  EQU             2
  00000003            00390 UnLockDelayFlag EQU             3
  00000005            00391 Glint1Flag      EQU             5
  00000007            00392 ZFlashUnitFlag  EQU             7
                      00393 
  00000057            00394 Timer1S         EQU             57H
  00000058            00395 BiePoint        EQU             58H
                      00396                                                 ; 超载标志
  0000005A            00397 Power_Flags     EQU             5AH
  00000000            00398 Reset_Flag      EQU             0
  00000001            00399 EeFull_Flag     EQU             1               ; 内部EEPROM已经标定满的标志
  00000002            00400 FirTestBie_Flag EQU             2               ; 首次测试BIE的标志
  00000004            00401 ReadBie_Flag    EQU             4
  00000006            00402 CalNo6v_Flag    EQU             6               ; 没有6V标定的标志
  00000007            00403 FlashZFlag      EQU             7
                      00404 
  0000005B            00405 AmendZeroL      EQU             5BH
  0000005C            00406 AmendZeroH      EQU             5CH
                      00407 
  0000005E            00408 T_Auto_Off      EQU             5EH
  0000005F            00409 Prog_Flow       EQU             5FH
  00000060            00410 LockCountH      EQU             60H
  00000061            00411 LockCountL      EQU             61H
                      00412 
  00000062            00413 SysFlag2        EQU             62H
  00000000            00414 TF_01A          EQU             0
  00000001            00415 TF_01B          EQU             1
  00000002            00416 TF_05A          EQU             2
  00000003            00417 TF_05B          EQU             3
  00000004            00418 GlintOpenFlag   EQU             4               ; 允许进入中断处理闪烁的标志
  00000005            00419 GlintFlag       EQU             5               ; 闪烁亮
  00000020            00420 GlintFlagCom    EQU             00100000B
  00000006            00421 Dsp_Hide        EQU             6
  00000040            00422 DspHideData     EQU             01000000b
                      00423 
  00000063            00424 WTMemCount      EQU             63H
  00000064            00425 LCount          EQU             64H
  00000065            00426 LLCount         EQU             65H
                      00427 
  00000066            00428 SysFlag4        EQU             66H
  00000000            00429 StopFlag        EQU             0
  00000001            00430 StartFlag       EQU             1
  00000002            00431 LockFlag        EQU             2
  00000003            00432 ErrEFlag        EQU             3
  00000004            00433 LowBatFlag      EQU             4
                      00434 
  00000067            00435 TrackCount      EQU             67H
  00000068            00436 MaxCountH       EQU             68H
  00000069            00437 MaxCountL       EQU             69H
                      00438 
  0000006C            00439 Status_Flags    EQU             6CH
  00000000            00440 SWUnitFlag      EQU             0               ; 拨动开关单位转换标志
  00000001            00441 ZhenDong_Flag   EQU             1               ; 振动开机方式
  00000002            00442 Flash5_Flag     EQU             2               ; 锁定后闪烁5次关机
  00000003            00443 TwoUnit_Flag    EQU             3               ; 2个单位的标志
  00000004            00444 Max162KG_Flag   EQU             4               ; 满载为162KG
  00000005            00445 Max182KG_Flag   EQU             5               ; 满载为182KG
  00000006            00446 Max202KG_Flag   EQU             6               ; 满载为202KG
                      00447 
  0000006D            00448 FlashZTimeL     EQU             6DH
  0000006E            00449 FlashZTimeH     EQU             6EH
                      00450 
  0000006F            00451 SysFlag5        EQU             6FH
  00000003            00452 FlashZeroFlag   EQU             3               ; 已经刷新零点的标志
  00000004            00453 FirTracZeroFlag EQU             4               ; 首次归零标志
  00000006            00454 WdtTrackSFlag   EQU             6
  00000007            00455 WdtTrackBFlag   EQU             7
                      00456 
  00000070            00457 WakenUpCount    EQU             70H
  00000071            00458 AmendZeroM      EQU             71H
  00000072            00459 TempRam8        EQU             72H
  00000073            00460 TempRam9        EQU             73H
  00000074            00461 DisplayFlag     EQU             74H
  00000000            00462 Dsp_Kg          EQU             0
  00000001            00463 Dsp_Lb          EQU             1
  00000002            00464 Dsp_St          EQU             2
                      00465 
  00000075            00466 NoSteadyCount   EQU             75H
  00000076            00467 KeyTimes        EQU             76H
  00000077            00468 ScanKeyCount    EQU             77H
  00000078            00469 Key1            EQU             78H
  00000079            00470 Key2            EQU             79H
  0000007A            00471 KeyTmr          EQU             7AH
                      00472 
  0000007B            00473 displaycal1     EQU             7BH
  0000007C            00474 displaycal2     EQU             7CH
  0000007D            00475 displaycal3     EQU             7DH
                      00476 
  0000007E            00477 tempcal1        EQU             7EH             ; 读内部BIE寄存器
  0000007F            00478 tempcal2        EQU             7FH
  00000080            00479 tempcal3        EQU             80H
  00000081            00480 tempcal4        EQU             81H
                      00481 
  00000082            00482 keycode         EQU             82H
  00000083            00483 SysFlag6        EQU             83H
  00000000            00484 Caldis          EQU             0
  00000001            00485 TestWdt         EQU             1
  00000002            00486 weight_have     EQU             2               ; 有重量不进STOP
  00000084            00487 second          EQU             84H
                      00488 
  00000086            00489 DisplayRam1     EQU             86H
  00000087            00490 DisplayRam2     EQU             87H
  00000088            00491 DisplayRam3     EQU             88H
  00000089            00492 DisplayRam4     EQU             89H
  0000008A            00493 delay_reg1      EQU             8AH
  0000008B            00494 Key_Times       EQU             8BH
  0000008C            00495 second2         EQU             8CH
  0000008D            00496 second3         EQU             8DH
                      00497 
  0000008E            00498 CheckRam1       EQU             8EH
  0000008F            00499 CheckRam2       EQU             8FH
  00000090            00500 CheckRam3       EQU             90H
  00000091            00501 CheckRam4       EQU             91H
  00000092            00502 CheckRam5       EQU             92H
  00000093            00503 CheckRam6       EQU             93H
  00000094            00504 Lo_Counter      EQU             94H
  00000095            00505 REG3            EQU             95H
  00000096            00506 FlashK          EQU             96H
  00000000            00507 Fk_ADFI         EQU             0
                      00508 
                      00509 ;关机不清零
  000000CC            00510 AutoOn_Flags    EQU             0CCH
  00000000            00511 WakenOn_Flag    EQU             0
  00000001            00512 WdtWaken_Flag   EQU             1
  00000002            00513 DispOk_Flag     EQU             2
  00000003            00514 KeyOn_Flag      EQU             3
  00000005            00515 UnStableFlag    EQU             5               ; 不稳定关机标志
  00000006            00516 OnWeightFlag    EQU             6               ; 有重量在秤台上的标志
  00000007            00517 OverLoadFlag    EQU             7
  000000CD            00518 UnitFlag        EQU             0CDH
  00000000            00519 KgFlag          EQU             0
  00000001            00520 LbFlag          EQU             1
  00000002            00521 StFlag          EQU             2
                      00522 
                      00523 #define         ZeroH           0xCE
                      00524 #define         ZeroM           0xCF
                      00525 #define         ZeroL           0xD0
                      00526 
  000000D1            00527 AutoOnADH       EQU             0XD1            ;6AH
  000000D2            00528 AutoOnADL       EQU             0XD2            ;6BH
                      00529 
                      00530 ;************************************************
                      00531 ;立即数
                      00532 ;************************************************
                      00533 
                      00534                 ;#include       "macro.asm"
                      00535 ;===========================================
                      00536 ; 宏定义
                      00537 ;===========================================
                      00538 ;..................................
                      00539 ; Move Number to File Register
                      00540 ;..................................
                      00541 movfl           macro           f1,d1
                      00542                 movai           d1
                      00543                 movra           f1
                      00544                 endm
                      00545 
                      00546 ;..................................
                      00547 ; Move File to File Register
                      00548 ;..................................
                      00549 movff           macro           f2,f1
                      00550                 movar           f1
                      00551                 movra           f2
                      00552                 endm
                      00553 
                      00554 ;*******************************************************
                      00555 ;*******************************************************
                      00556                 org             00H
                      00557 ;************************************************
0000   0000           00558                 nop
0001   EB88           00559                 jbset           MCR,5
0002   A000           00560                 goto            SysInit
0003   A000           00561                 goto            WDTWankenUp             ;TO=1:发生WDT溢出
                      00562 
                      00563 ;************************************************
                      00564                 org             08H
                      00565                 ;#include       "int.asm"
                      00566 ;************************************************
0008                  00567 IntrruptProc:
0008   563A           00568                 movra           WorkRegBank
0009   5987           00569                 movar           STATUS
000A   563B           00570                 movra           StatusBank
                      00571 
                      00572 ;................................................
000B                  00573 Proc1_Interrupt:
000B   E58A           00574                 jbset           INTE, 2
000C   A000           00575                 goto            IntrruptProc1
                      00576 
000D   E58B           00577                 jbset           INTF, 2
000E   A000           00578                 goto            IntrruptProc1
000F   A000           00579                 goto            Ext0Int
0010                  00580 IntrruptProc1:
0010   ED8A           00581                 jbset           INTE, 6
0011   A000           00582                 goto            ExitIntProc
                      00583 
0012   FD8B           00584                 jbclr           INTF, 6
0013   A000           00585                 goto            ADCInt
                      00586 
                      00587 ;************************************************
0014                  00588 ExitIntProc:
0014   3C00           00589                 movai           0x00
0015   578B           00590                 movra           INTF
0016   583B           00591                 movar           StatusBank
0017   5787           00592                 movra           STATUS
0018   583A           00593                 movar           WorkRegBank
0019   000D           00594                 retie
                      00595 
                      00596 ;************************************************
                      00597 ;外部中断
                      00598 ;************************************************
001A                  00599 Ext0Int:
001A   D58B           00600                 bclr            INTF, 2
001B   3CFE           00601                 movai           0xfe
001C   578B           00602                 movra           INTF
001D   A000           00603                 goto            ExitIntProc
                      00604 
                      00605 ;************************************************
                      00606 ;ADC中断
                      00607 ;************************************************
001E                  00608 ADCInt:
001E   6657           00609                 incr            Timer1S
001F   C096           00610                 bset            FlashK,Fk_ADFI
0020   000E           00611                 CLRWDT
                      00612 
0021   E466           00613                 jbset           SysFlag4,LockFlag       ;锁定的标志位
0022   A000           00614                 goto            TimerInt2End
                      00615 
0023   E862           00616                 jbset           SysFlag2,GlintOpenFlag
0024   A000           00617                 goto            TimerInt2End
                      00618 ;-------------------------------
0025   6664           00619                 incr          LCount
0026   3C11           00620                 movai         17
0027   4864           00621                 RSUBAR         LCount
0028   E187           00622                 jbset          C
0029   A000           00623                 goto          TimerInt2End
                      00624 
002A   7664           00625                 clrr          LCount
002B   6665           00626                 incr          LLCount
                      00627 
002C   3C20           00628                 movai         GlintFlagCom
002D   4262           00629                 XORRA         SysFlag2                   ; 闪烁取反
                      00630 
002E   3C04           00631                 movai         4                              ; 闪烁2次
002F   F46C           00632                 jbclr         Status_Flags,Flash5_Flag
0030   3C0A           00633                 movai         10                              ; 闪烁5次关机
                      00634 
0031   4865           00635                 RSUBAR         LLCount
0032   E187           00636                 jbset          C
0033   A000           00637                 goto          TimerInt2End
                      00638 
0034   7665           00639                 clrr          LLCount
0035   D862           00640                 bclr          SysFlag2,GlintOpenFlag
0036   F46C           00641                 jbclr         Status_Flags,Flash5_Flag
0037   A000           00642                 goto          TimerInt1A
                      00643                 movfl         T_Auto_Off, 16      ;movff          T_Auto_Off,T_WeightMode
0038   3C10               M                 movai           d1
0039   565E               M                 movra           f1
003A   A000           00644                 goto          TimerInt2End
003B                  00645 TimerInt1A:
003B   3C03           00646                 movai                3
003C   4A5E           00647                 RSUBRA         T_Auto_Off
003D                  00648 TimerInt2End:
                      00649 ;-------------------------------
003D                  00650 TimerInt3:
003D   6684           00651                 incr            second
003E   668D           00652                 incr            second3
003F   668C           00653                 INCR            second2
0040   663E           00654                 incr            TBASE05S
0041   3C05           00655                 movai           5
0042   483E           00656                 RSUBAR          TBASE05S
0043   E187           00657                 jbset           C
0044   A000           00658                 goto            TimerInt4               ;C=0,TBASE05S<5
                      00659 
0045   763E           00660                 clrr            TBASE05S                ;C=1,TBASE05S>=5
0046   C462           00661                 bset            SysFlag2,TF_05A
                      00662 ;-------------------------------
0047                  00663 TimerInt4:
0047   6A7A           00664                 DJZR            KeyTmr                  ;KeyTmr-1
0048   A000           00665                 goto            ADCInt_Time             ;KeyTmr>0
                      00666 
0049   7676           00667                 clrr            KeyTimes                ;KeyTmr=0
004A   767A           00668                 clrr            KeyTmr
                      00669 ;*******************************
004B                  00670 ADCInt_Time:
004B   DD8B           00671                 bclr            INTF, 6                 ;ADIF=0
004C   663C           00672                 incr            SampleTimes
                      00673 
004D   E215           00674                 jbset           SysFlag1,AdcStartFlag
004E   A000           00675                 goto            ADCInt1
                      00676 
004F   3C04           00677                 movai           4
0050   483C           00678                 rsubar          SampleTimes
0051   E187           00679                 jbset           C
0052   A000           00680                 goto            ExitIntProc             ;SampleTimes<4
                      00681 
0053   D215           00682                 bclr            SysFlag1,AdcStartFlag   ;SampleTimes>=4
0054   763C           00683                 clrr            SampleTimes
0055   762B           00684                 clrr            AD_Temp0
0056   762C           00685                 clrr            AD_Temp1
0057   762D           00686                 clrr            AD_Temp2
0058   762E           00687                 clrr            AD_Temp3
0059   A000           00688                 goto            ExitIntProc
                      00689 ;................................................
005A                  00690 ADCInt1:
005A   59B4           00691                 movar           ADRH
005B   5628           00692                 movra           ADRamH
005C   59B5           00693                 movar           ADRM
005D   5629           00694                 movra           ADRamM
005E   59B6           00695                 movar           ADRL
005F   562A           00696                 movra           ADRamL                  ;保存24位ADC结果至ADRam(24bit)
                      00697 
0060   3C00           00698                 movai           0x00
0061   7E2A           00699                 addra           ADRamL
0062   3C00           00700                 movai           0x00
0063   1229           00701                 adcra           ADRamM
0064   3C80           00702                 movai           0x80
0065   1228           00703                 adcra           ADRamH                  ;ADRam + 0x800000 ?
0066   F2CC           00704                 jbclr           AutoOn_Flags,WdtWaken_Flag
0067   A000           00705                 goto            AdcInt3
                      00706 ;................................................
0068                  00707 ADCInt2:                                                ;复位初始采样
0068   582A           00708                 movar           ADRamL
0069   7E2E           00709                 addra           AD_Temp3
006A   5829           00710                 movar           ADRamM
006B   122D           00711                 adcra           AD_Temp2
006C   5828           00712                 movar           ADRamH
006D   122C           00713                 adcra           AD_Temp1
006E   3C00           00714                 movai           0
006F   122B           00715                 adcra           AD_Temp0                ;AD_Temp(32b) + ADRam(24b) -> AD_Temp
                      00716 
0070   3C08           00717                 movai           8
0071   483C           00718                 rsubar          SampleTimes
0072   E187           00719                 jbset           C
0073   A000           00720                 goto            ExitIntProc
                      00721 ;---------------
0074   763C           00722                 clrr            SampleTimes             ;采样8次
0075   3C0A           00723                 movai           10              ; 取19bit的内码数据
0076   5642           00724                 movra           AdcCount
0077   D187           00725 ADCInt2Loop:    bclr            C
0078   4E2B           00726                 rrr             AD_Temp0
0079   4E2C           00727                 rrr             AD_Temp1
007A   4E2D           00728                 rrr             AD_Temp2
007B   4E2E           00729                 rrr             AD_Temp3
007C   6A42           00730                 djzr            AdcCount
007D   A000           00731                 goto            ADCInt2Loop
                      00732 
007E   582C           00733                 movar           AD_Temp1
007F   561C           00734                 movra           H_DATA
0080   582D           00735                 movar           AD_Temp2
0081   561D           00736                 movra           M_DATA
0082   582E           00737                 movar           AD_Temp3
0083   561E           00738                 movra           L_DATA                  ;24位ADC数据*8/1024=17位数据,结果存于HML_DATA
                      00739 
0084   762B           00740                 clrr            AD_Temp0
0085   762C           00741                 clrr            AD_Temp1
0086   762D           00742                 clrr            AD_Temp2
0087   762E           00743                 clrr            AD_Temp3
                      00744 ;................................................
0088                  00745 AdcInt3:
0088   C415           00746                 bset            SysFlag1,AdcOkFlag
0089   A000           00747                 goto            ExitIntProc
                      00748 
                      00749 ;;*************************************************
                      00750 ;
                      00751 
                      00752 ;**************************************************
                      00753 
                      00754                 ;#include         "subroutine.asm"
                      00755 ;***********************************************
008A                  00756 delay1:                                                 ;延时约198K指令周期
008A   3CFF           00757                 movai           0xff
008B   5634           00758                 movra           delay_reg
008C   3CFF           00759                 movai           0xff
008D   0010           00760                 djza
008E   A000           00761                 goto            $-1
008F   0000           00762                 nop
0090   0000           00763                 nop
0091   0000           00764                 nop
0092   000E           00765                 clrwdt
0093   0000           00766                 nop
0094   0000           00767                 nop
0095   0000           00768                 nop
0096   0000           00769                 nop
0097   6A34           00770                 djzr            delay_reg
0098   A000           00771                 goto            $-12
0099   000C           00772                 return
                      00773 ;-------------------------------
009A                  00774 delay2:                                                 ;延时约791K指令周期
009A   3CFF           00775                 movai           0xff
009B   568A           00776                 movra           delay_reg1
009C   3CFF           00777                 movai           0xff
009D   5634           00778                 movra           delay_reg
009E   3CFF           00779                 movai           0xff
009F   0010           00780                 djza
00A0   A000           00781                 goto            $-1
00A1   0000           00782                 nop                                     ;延时255*3=765指令周期
00A2   0000           00783                 nop
00A3   0000           00784                 nop
00A4   0000           00785                 nop
00A5   0000           00786                 nop
00A6   0000           00787                 nop
00A7   0000           00788                 nop
00A8   0000           00789                 nop
00A9                  00790 delay2A:
00A9   3CFF           00791                 movai           0xff
00AA   5634           00792                 movra           delay_reg
00AB   0010           00793                 djza
00AC   A000           00794                 goto            $-1
00AD   0000           00795                 nop
00AE   0000           00796                 nop
00AF   0000           00797                 nop
00B0   0000           00798                 nop
00B1   0000           00799                 nop
00B2   0000           00800                 nop
00B3   0000           00801                 nop
00B4   0000           00802                 nop
00B5   3CFF           00803                 movai           0xff
00B6   5634           00804                 movra           delay_reg
00B7   0010           00805                 djza
00B8   A000           00806                 goto            $-1
00B9   0000           00807                 nop
00BA   0000           00808                 nop
00BB   0000           00809                 nop
00BC   0000           00810                 nop
00BD   0000           00811                 nop
00BE   0000           00812                 nop
00BF   0000           00813                 nop
00C0   0000           00814                 nop
00C1   3CFF           00815                 movai           0xff
00C2   5634           00816                 movra           delay_reg
00C3   0010           00817                 djza
00C4   A000           00818                 goto            $-1
00C5   0000           00819                 nop
00C6   0000           00820                 nop
00C7   0000           00821                 nop
00C8   0000           00822                 nop
00C9   0000           00823                 nop
00CA   0000           00824                 nop
00CB   0000           00825                 nop
00CC   0000           00826                 nop
00CD   3CFF           00827                 movai           0xff
00CE   5634           00828                 movra           delay_reg
00CF   0010           00829                 djza
00D0   A000           00830                 goto            $-1
00D1   0000           00831                 nop
00D2   0000           00832                 nop
00D3   0000           00833                 nop
00D4   0000           00834                 nop
00D5   0000           00835                 nop
00D6   0000           00836                 nop
00D7   0000           00837                 nop
00D8   0000           00838                 nop
                      00839 
00D9   6A8A           00840                 DJZR            delay_reg1
00DA   A000           00841                 goto            delay2A
00DB   000C           00842                 return
                      00843 
                      00844 ;*************************************************
                      00845 ;晶振启动时丢弃不稳定的AD
                      00846 ;*************************************************
00DC                  00847 discard_ad:
00DC   C215           00848         bset            SysFlag1,AdcStartFlag
00DD   763C           00849         clrr            SampleTimes
00DE   D415           00850         bclr            SysFlag1,AdcOkFlag
00DF   000C           00851         return
                      00852 
                      00853 
                      00854 ;**************************************************
                      00855 ;取零点内码
                      00856 ;**************************************************
00E0                  00857 GetZeroPoint:
                      00858                 movff           ZeroH,H_DR
00E0   5816               M                 movar           f1
00E1   56CE               M                 movra           f2
                      00859                 movff           ZeroM,M_DR
00E2   5817               M                 movar           f1
00E3   56CF               M                 movra           f2
                      00860                 movff           ZeroL,L_DR
00E4   5818               M                 movar           f1
00E5   56D0               M                 movra           f2
00E6   000C           00861                 return
                      00862 
                      00863 ;**************************************************
                      00864 ;当前内码与零点内码之差的子程序
                      00865 ;**************************************************
00E7                  00866 CurAD_ZeroAD:
                      00867                 movff           TempRam1,H_DR
00E7   5816               M                 movar           f1
00E8   5607               M                 movra           f2
                      00868                 movff           TempRam2,M_DR
00E9   5817               M                 movar           f1
00EA   5608               M                 movra           f2
                      00869                 movff           TempRam3,L_DR
00EB   5818               M                 movar           f1
00EC   5609               M                 movra           f2
                      00870                 movff           TempRam4,ZeroH
00ED   58CE               M                 movar           f1
00EE   560A               M                 movra           f2
                      00871                 movff           TempRam5,ZeroM
00EF   58CF               M                 movar           f1
00F0   560B               M                 movra           f2
                      00872                 movff           TempRam6,ZeroL
00F1   58D0               M                 movar           f1
00F2   560C               M                 movra           f2
00F3   8000           00873                 call            _Sub3_3
00F4   000C           00874                 return
                      00875 ;**************************************************
                      00876 ;转换校磅流程
                      00877 ;**************************************************
00F5                  00878 Change_F1:
00F5   D187           00879                 bclr           PFALG, 0
00F6   5254           00880                 rlr             TF1
00F7   D615           00881                 bclr            SysFlag1,SteadyFlag
00F8   7646           00882                 clrr            StableCount
00F9   000C           00883         return
                      00884 
                      00885 ;**************************************************
                      00886 ;funtion: 实际要显示的分度(没有任何放大）
                      00887 ;input  : TempRam5 TempRam6
                      00888 ;output : TempRam5 TempRam6
                      00889 ;**************************************************
00FA                  00890 GetRealCount:
00FA   3C02           00891                 movai           2
00FB   4A0C           00892                 RSUBRA          TempRam6
00FC   3C00           00893                 movai           0
00FD   120B           00894                 ADCRA           TempRam5
                      00895 
00FE   D187           00896             bclr            PFALG, 0
00FF   4E0B           00897                 rrr             TempRam5
0100   4E0C           00898                 rrr             TempRam6
                      00899 
0101   D187           00900             bclr            PFALG, 0
0102   4E0B           00901                 rrr             TempRam5
0103   4E0C           00902                 rrr             TempRam6                           ;除以4
0104   000C           00903         return
                      00904 
                      00905 ;**************************************************
                      00906 ;实际数据与锁定数据的差值
                      00907 ;output : TempRam3 TempRam4
                      00908 ;**************************************************
0105                  00909 Real_LockCount:
                      00910                 movff           TempRam3,CountH
0105   5852               M                 movar           f1
0106   5609               M                 movra           f2
                      00911                 movff           TempRam4,CountL
0107   5853               M                 movar           f1
0108   560A               M                 movra           f2
                      00912                 movff           TempRam5,LockCountH
0109   5860               M                 movar           f1
010A   560B               M                 movra           f2
                      00913                 movff           TempRam6,LockCountL
010B   5861               M                 movar           f1
010C   560C               M                 movra           f2
010D   8000           00914                 CALL            _Sub2_2
                      00915                 ;CALL            _Neg2
010E   000C           00916                 return
                      00917 
010F                  00918 _GetAutoOnDC:
010F   760A           00919                 clrr            TempRam4
                      00920                 movff           TempRam5,CalDot1H
0110   584B               M                 movar           f1
0111   560B               M                 movra           f2
                      00921                 movff           TempRam6,CalDot1L
0112   584A               M                 movar           f1
0113   560C               M                 movra           f2
                      00922 
0114   760E           00923                 clrr            TempRam12
                      00924                 movfl           TempRam13, 40                           ;movff          TempRam13,AutoOnCount
0115   3C28               M                 movai           d1
0116   560F               M                 movra           f1
0117   8000           00925                 call            _Mul3_2
0118   760D           00926                 clrr            TempRam11
                      00927                 movff           TempRam12,CalCount1H
0119   5848               M                 movar           f1
011A   560E               M                 movra           f2
                      00928                 movff           TempRam13,CalCount1L            ;CalDot1H*40/CalCount1H（商456 余数123）
011B   5849               M                 movar           f1
011C   560F               M                 movra           f2
011D   8000           00929                 call            _Div6_3
011E   8000           00930                 call            _ProcAdd1
                      00931 
                      00932                 movfl           TempRam1, 3
011F   3C03               M                 movai           d1
0120   5607               M                 movra           f1
0121                  00933 _GetAutoOnDCLoop:
0121   D187           00934                 bclr            PFALG, 0
0122   4E0A           00935                 rrr             TempRam4
0123   4E0B           00936                 rrr             TempRam5
0124   4E0C           00937                 rrr             TempRam6                            ;商除以2
                      00938 
0125   6A07           00939                 DJZR            TempRam1
0126   A000           00940                 goto            _GetAutoOnDCLoop
                      00941 
                      00942                 movff           TempRam2,ZeroH
0127   58CE               M                 movar           f1
0128   5608               M                 movra           f2
                      00943                 movff           TempRam3,ZeroM
0129   58CF               M                 movar           f1
012A   5609               M                 movra           f2
                      00944                 movff           TempRam4,ZeroL
012B   58D0               M                 movar           f1
012C   560A               M                 movra           f2
                      00945 
                      00946                 movfl           TempRam1, 1
012D   3C01               M                 movai           d1
012E   5607               M                 movra           f1
012F                  00947 _GetAutoOnDCLoop1:
012F   D187           00948                 bclr            PFALG, 0
0130   4E08           00949                 rrr             TempRam2
0131   4E09           00950                 rrr             TempRam3
0132   4E0A           00951                 rrr             TempRam4
                      00952 
0133   6A07           00953                 DJZR            TempRam1
0134   A000           00954                 goto            _GetAutoOnDCLoop1
                      00955 
0135   8000           00956                 call            _Add2_2                 ; 因为看门狗唤醒时取的内码是正常工作时内码的1/8，因此，这里的内码也要除以8
                      00957 
                      00958                 movff           AutoOnADH,TempRam3
0136   5809               M                 movar           f1
0137   56D1               M                 movra           f2
                      00959                 movff           AutoOnADL,TempRam4
0138   580A               M                 movar           f1
0139   56D2               M                 movra           f2
                      00960                                 ;incr            AutoOnADH
                      00961                                 ;incr            AutoOnADH
                      00962 
013A   000C           00963        return
                      00964 
013B                  00965 option:
013B   3C04           00966             movai       0x04
013C   57AE           00967         movra   OSCM
013D   EBAE           00968        jbset    OSCM,5
013E   A000           00969         goto    $-1
013F   3CFC           00970         movai     0xfc
0140   56F7           00971             movra         0x0F7
                      00972 
0141   3C00           00973        movai    0x00
0142   57AE           00974        movra    OSCM
0143   E9AE           00975        jbset   OSCM,4
0144   A000           00976        goto    $-1
0145   0000           00977        nop
0146   000C           00978            return
                      00979 
0147                  00980 CLRR_LCD:
0147   77C2           00981       CLRR    LCDDS0
0148   77C3           00982           CLRR    LCDDS1
0149   3C00           00983                   movai   0x00
014A   57C2           00984                   movra   LCDDS0
014B   57C3           00985                   movra   LCDDS1
014C   77C4           00986           CLRR    LCDDS2
014D   77C5           00987           CLRR    LCDDS3
014E   77C6           00988           CLRR    LCDDS4
014F   77C7           00989           CLRR    LCDDS5
0150   77C8           00990           CLRR    LCDDS6
0151   77C9           00991           CLRR    LCDDS7
0152   77CA           00992           CLRR    LCDDS8
0153   77CB           00993           CLRR    LCDDS9
0154   77CC           00994           CLRR    LCDDS10
                      00995 
0155   000C           00996           RETURN
                      00997 
0156                  00998 Disp_To_Ram:
                      00999          movff   Display1,DisplayRam1
0156   5886               M                 movar           f1
0157   5610               M                 movra           f2
                      01000                  movff   Display2,DisplayRam2
0158   5887               M                 movar           f1
0159   5611               M                 movra           f2
                      01001                  movff   Display3,DisplayRam3
015A   5888               M                 movar           f1
015B   5612               M                 movra           f2
                      01002                  movff   Display4,DisplayRam4
015C   5889               M                 movar           f1
015D   5613               M                 movra           f2
015E   000C           01003                  RETURN
015F                  01004 Ram_To_Disp:
                      01005                 movff           DisplayRam1,Display1
015F   5810               M                 movar           f1
0160   5686               M                 movra           f2
                      01006                  movff   DisplayRam2,Display2
0161   5811               M                 movar           f1
0162   5687               M                 movra           f2
                      01007                  movff   DisplayRam3,Display3
0163   5812               M                 movar           f1
0164   5688               M                 movra           f2
                      01008                  movff   DisplayRam4,Display4
0165   5813               M                 movar           f1
0166   5689               M                 movra           f2
0167   000C           01009                  RETURN
                      01010 
0168                  01011 delay3:
                      01012 
0168   3CFF           01013         movai   0xff
0169   5634           01014         movra   delay_reg
016A   3CFF           01015         movai   0xff
016B   0010           01016         djza
016C   A000           01017         goto    $-1
016D   0000           01018         nop
016E   0000           01019         nop
016F   0000           01020         nop
0170   0000           01021         nop
0171   0000           01022         nop
0172   0000           01023         nop
0173   0000           01024         nop
0174   0000           01025         nop
0175   6A34           01026         djzr    delay_reg
0176   A000           01027         goto    $-12
0177   000C           01028         return
                      01029 
0178                  01030 delay4:
0178   5634           01031         movra   delay_reg
0179   0000           01032 dlylp4  nop
017A   0000           01033         nop
017B   0000           01034         nop
017C   0000           01035         nop
017D   0000           01036         nop
017E   0000           01037         nop
017F   0000           01038         nop
0180   0000           01039         nop
0181   6A34           01040         djzr    delay_reg
0182   A000           01041         goto    dlylp4
0183   000C           01042         return
                      01043 
                      01044                ;#include         "Computer.asm"
                      01045 ;************************************************
                      01046 ;Title  : Calculate Subroutine
                      01047 ;Author : Kevin Lee
                      01048 ;Date   : 2015/6/5 16:19
                      01049 ;**************************************************
                      01050 ;**************************************************
                      01051 ;input  :       TempRam3, TempRam4
                      01052 ;                   TempRam5, TempRam6
                      01053 ;output :
                      01054 ;                   TempRam3, TempRam4
                      01055 ;**************************************************
0184                  01056 _Add2_2:
0184   580C           01057                 movar           TempRam6
0185   7E0A           01058                 ADDRA           TempRam4
0186   580B           01059                 movar           TempRam5
0187   1209           01060                 ADCRA           TempRam3
0188   000C           01061                 return
                      01062 
                      01063 ;**************************************************
                      01064 ;input  :       (TempRam3,TempRam4) - (TempRam5,TempRam6)
                      01065 ;output :       (TempRam3,TempRam4)
                      01066 ;**************************************************
0189                  01067 _Sub2_2:
0189   580C           01068                 movar           TempRam6
018A   4A0A           01069                 rsubra          TempRam4
018B   580B           01070                 movar           TempRam5
018C   0E09           01071                 rsbcra          TempRam3
018D   F187           01072                 jbclr           C
018E   000C           01073                 return
                      01074 
018F   700A           01075                 comar           TempRam4
0190   3F01           01076                 addai           1
0191   560A           01077                 movra           TempRam4
0192   7009           01078                 comar           TempRam3
0193   7609           01079                 clrr            TempRam3
0194   1209           01080                 adcra           TempRam3
0195   D187           01081                 bclr            C
0196   000C           01082                 return
                      01083 
                      01084 ;**************************************************
                      01085 ;input  :       (TempRam1,TempRam2,TempRam3) - (TempRam4,TempRam5,TempRam6)
                      01086 ;output :       (TempRam1,TempRam2,TempRam3)
                      01087 ;**************************************************
0197                  01088 _Sub3_3:
0197   580C           01089                 movar           TempRam6
0198   4A09           01090                 rsubra          TempRam3
0199   580B           01091                 movar           TempRam5
019A   0E08           01092                 rsbcra          TempRam2
019B   580A           01093                 movar           TempRam4
019C   0E07           01094                 rsbcra          TempRam1
019D   F187           01095                 jbclr           C
019E   000C           01096                 return
                      01097 
019F   7009           01098                 comar           TempRam3
01A0   3F01           01099                 addai           1
01A1   5609           01100                 movra           TempRam3
01A2   7008           01101                 comar           TempRam2
01A3   7608           01102                 clrr            TempRam2
01A4   1208           01103                 adcra           TempRam2
01A5   7007           01104                 comar           TempRam1
01A6   7607           01105                 clrr            TempRam1
01A7   1207           01106                 adcra           TempRam1
01A8   D187           01107                 bclr            C
01A9   000C           01108                 return
                      01109 
                      01110 
                      01111 ;**************************************************
                      01112 ;input  :       TempRam2, TempRam3  TempRam4, TempRam5, TempRam6
                      01113 ;               TempRam11,TempRam12,TempRam13
                      01114 ;output :
                      01115 ;yushu  :       TempRam1, TempRam2, TempRam3
                      01116 ;shang  :       TempRam4, TempRam5, TempRam6
                      01117 ;temp   :       buffer0,buffer1,buffer2,buffer3
                      01118 ;**************************************************
01AA                  01119 _Div6_3:
01AA   7607           01120                 clrr            TempRam1
                      01121                 movfl           Buffer3, 24
01AB   3C18               M                 movai           d1
01AC   5603               M                 movra           f1
01AD                  01122 _Div6_3Loop:
01AD   D187           01123                 bclr            PFALG, 0
01AE   520C           01124                 rlr             TempRam6
01AF   520B           01125                 rlr             TempRam5
01B0   520A           01126                 rlr             TempRam4
01B1   5209           01127                 rlr             TempRam3
01B2   5208           01128                 rlr             TempRam2
01B3   5207           01129                 rlr             TempRam1
                      01130 
01B4   580F           01131                 movar           TempRam13
01B5   4809           01132                 rsubar          TempRam3
01B6   5602           01133                 movra           Buffer2
                      01134 
01B7   580E           01135                 movar           TempRam12
01B8   0C08           01136                 rsbcar          TempRam2
01B9   5601           01137                 movra           Buffer1
                      01138 
01BA   580D           01139                 movar           TempRam11
01BB   0C07           01140                 rsbcar          TempRam1
01BC   5600           01141                 movra           Buffer0
                      01142 
01BD   E187           01143                 jbset           PFALG, 0
01BE   A000           01144                 goto            _Div6_3Loop1
                      01145 
                      01146                 movff           TempRam1,Buffer0
01BF   5800               M                 movar           f1
01C0   5607               M                 movra           f2
                      01147                 movff           TempRam2,Buffer1
01C1   5801               M                 movar           f1
01C2   5608               M                 movra           f2
                      01148                 movff           TempRam3,Buffer2
01C3   5802               M                 movar           f1
01C4   5609               M                 movra           f2
                      01149 
01C5   660C           01150                 incr            TempRam6
01C6                  01151 _Div6_3Loop1:
01C6   6A03           01152                 djzr            Buffer3
01C7   A000           01153                 goto            _Div6_3Loop
01C8   000C           01154                 return
                      01155 
                      01156 ;**************************************************
01C9                  01157 _ProcAdd1:
01C9   D187           01158                 bclr            PFALG, 0
01CA   5209           01159                 rlr             TempRam3
01CB   5208           01160                 rlr             TempRam2
01CC   5207           01161                 rlr             TempRam1
                      01162 
01CD   580F           01163                 movar           TempRam13
01CE   4A09           01164                 rsubra          TempRam3
01CF   580E           01165                 movar           TempRam12
01D0   0E08           01166                 rsbcra          TempRam2
01D1   580D           01167                 movar           TempRam11
01D2   0E07           01168                 rsbcra          TempRam1
                      01169 
01D3   E187           01170                 jbset           PFALG, 0
01D4   000C           01171                 return
01D5                  01172 _ProcAdd1_A:
01D5   3C01           01173                 movai           1
01D6   7E0C           01174                 addra           TempRam6
01D7   3C00           01175                 movai           0
01D8   120B           01176                 adcra           TempRam5
01D9   3C00           01177                 movai           0
01DA   120A           01178                 adcra           TempRam4
01DB   000C           01179                 return
                      01180 
                      01181 ;**************************************************
                      01182 ;input  :       TempRam4,TempRam5, TempRam6
                      01183 ;               TempRam12,TempRam13
                      01184 ;output :       TempRam1,TempRam2,TempRam3,TempRam4,TempRam5,TempRam6
                      01185 ;need   :       buffer0 ,buffer1 ,buffer2,buffer3,buffer4,buffer5,Buffer6
                      01186 ;**************************************************
01DC                  01187 _Mul3_2:
01DC   7607           01188                 clrr            TempRam1
01DD   7608           01189                 clrr            TempRam2
01DE   7609           01190                 clrr            TempRam3
01DF   7600           01191                 clrr            Buffer0
01E0   7601           01192                 clrr            Buffer1
01E1   7602           01193                 clrr            Buffer2
                      01194 
                      01195                 movff           Buffer3,TempRam4
01E2   580A               M                 movar           f1
01E3   5603               M                 movra           f2
                      01196                 movff           Buffer4,TempRam5
01E4   580B               M                 movar           f1
01E5   5604               M                 movra           f2
                      01197                 movff           Buffer5,TempRam6
01E6   580C               M                 movar           f1
01E7   5605               M                 movra           f2
                      01198 
01E8   760A           01199                 clrr            TempRam4
01E9   760B           01200                 clrr            TempRam5
01EA   760C           01201                 clrr            TempRam6
                      01202 
                      01203                 movfl           Buffer6, 16
01EB   3C10               M                 movai           d1
01EC   5606               M                 movra           f1
01ED   D187           01204                 bclr            PFALG, 0
01EE                  01205 _Mul3_2Loop:
01EE   4E0E           01206                 rrr             TempRam12
01EF   4E0F           01207                 rrr             TempRam13
                      01208 
01F0   E187           01209                 jbset           PFALG, 0
01F1   A000           01210                 goto            _Mul3_2Loop1
                      01211 
01F2   5805           01212                 movar           Buffer5
01F3   7E0C           01213                 addra           TempRam6
                      01214 
01F4   5804           01215                 movar           Buffer4
01F5   120B           01216                 adcra           TempRam5
                      01217 
01F6   5803           01218                 movar           Buffer3
01F7   120A           01219                 adcra           TempRam4
                      01220 
01F8   5802           01221                 movar           Buffer2
01F9   1209           01222                 adcra           TempRam3
                      01223 
01FA   5801           01224                 movar           Buffer1
01FB   1208           01225                 adcra           TempRam2
                      01226 
01FC   5800           01227                 movar           Buffer0
01FD   1207           01228                 adcra           TempRam1
01FE                  01229 _Mul3_2Loop1:
01FE   D187           01230                 bclr            PFALG, 0
01FF   5205           01231                 rlr             Buffer5
0200   5204           01232                 rlr             Buffer4
0201   5203           01233                 rlr             Buffer3
0202   5202           01234                 rlr             Buffer2
0203   5201           01235                 rlr             Buffer1
0204   5200           01236                 rlr             Buffer0
                      01237 
0205   6A06           01238                 djzr            Buffer6
0206   A000           01239                 goto            _Mul3_2Loop
0207   000C           01240                 return
                      01241 
                      01242 ;**************************************************
                      01243 ;Title  :       change to BCD code
                      01244 ;input  :       TempRam12, TempRam13
                      01245 ;Output :       TempRam2, TempRam3 ,TempRam4 ,TempRam5 ,TempRam6
                      01246 ;need   :       Buffer0,Buffer1,Buffer2
                      01247 ;**************************************************
0208                  01248 _Ftob:
0208   7608           01249                 clrr            TempRam2
0209   7609           01250                 clrr            TempRam3
020A   760A           01251                 clrr            TempRam4
020B   760B           01252                 clrr            TempRam5
020C   760C           01253                 clrr            TempRam6
                      01254 
                      01255                 movfl           Buffer0, 27H
020D   3C27               M                 movai           d1
020E   5600               M                 movra           f1
                      01256                 movfl           Buffer1, 10H
020F   3C10               M                 movai           d1
0210   5601               M                 movra           f1
0211                  01257 Sub10kLoop:
0211   5801           01258                 movar           Buffer1
0212   480F           01259                 rsubar          TempRam13
0213   5602           01260                 movra           Buffer2
                      01261 
0214   5800           01262                 movar           Buffer0
0215   0C0E           01263                 rsbcar          TempRam12
                      01264 
0216   E187           01265                 jbset           PFALG, 0
0217   A000           01266                 goto            Sub1k
                      01267 
0218   560E           01268                 movra           TempRam12
                      01269                 movff           TempRam13,Buffer2
0219   5802               M                 movar           f1
021A   560F               M                 movra           f2
021B   6608           01270                 incr            TempRam2
021C   A000           01271                 goto            Sub10kLoop
021D                  01272 Sub1k:
                      01273                 movfl           Buffer0, 03H
021D   3C03               M                 movai           d1
021E   5600               M                 movra           f1
                      01274                 movfl           Buffer1, 0E8H
021F   3CE8               M                 movai           d1
0220   5601               M                 movra           f1
0221                  01275 Sub1kLoop:
0221   5801           01276                 movar           Buffer1
0222   480F           01277                 rsubar          TempRam13
0223   5602           01278                 movra           Buffer2
                      01279 
0224   5800           01280                 movar           Buffer0
0225   0C0E           01281                 rsbcar          TempRam12
                      01282 
0226   E187           01283                 jbset           PFALG, 0
0227   A000           01284                 goto            Sub100
0228   560E           01285                 movra           TempRam12
                      01286                 movff           TempRam13,Buffer2
0229   5802               M                 movar           f1
022A   560F               M                 movra           f2
022B   6609           01287                 incr            TempRam3
022C   A000           01288                 goto            Sub1kLoop
022D                  01289 Sub100:
022D   7600           01290                 clrr            Buffer0
                      01291                 movfl           Buffer1, 64H
022E   3C64               M                 movai           d1
022F   5601               M                 movra           f1
0230                  01292 Sub100Loop:
0230   5801           01293                 movar           Buffer1
0231   480F           01294                 rsubar          TempRam13
0232   5602           01295                 movra           Buffer2
                      01296 
0233   5800           01297                 movar           Buffer0
0234   0C0E           01298                 rsbcar          TempRam12
                      01299 
0235   E187           01300                 jbset           PFALG, 0
0236   A000           01301                 goto            Sub10
0237   560E           01302                 movra           TempRam12
                      01303                 movff           TempRam13,Buffer2
0238   5802               M                 movar           f1
0239   560F               M                 movra           f2
023A   660A           01304                 incr            TempRam4
023B   A000           01305                 goto            Sub100Loop
023C                  01306 Sub10:
                      01307                 movfl           Buffer1, 10
023C   3C0A               M                 movai           d1
023D   5601               M                 movra           f1
023E                  01308 sub10Loop:
023E   5801           01309                 movar           Buffer1
023F   480F           01310                 rsubar          TempRam13
                      01311 
0240   E187           01312                 jbset           PFALG, 0
0241   A000           01313                 goto            sub1
0242   560F           01314                 movra           TempRam13
0243   660B           01315                 incr            TempRam5
0244   A000           01316                 goto            sub10Loop
0245                  01317 sub1:
                      01318                 movff           TempRam6,TempRam13
0245   580F               M                 movar           f1
0246   560C               M                 movra           f2
0247   000C           01319                 return
                      01320 
                      01321 
                      01322                 ;#include         "e2prom.asm"
                      01323 
                      01324 ;**************************************************
                      01325 ;读内部数据
                      01326 ;**************************************************
0248                  01327 ReadBie:
0248   8000           01328           call       delay1
0249   0000           01329           nop
024A   0000           01330                   nop
024B   000E           01331                                   CLRWDT
024C   5989           01332           movar    INDF3
024D   567E           01333          movra    tempcal1
024E   5983           01334          movar    HIBYTE
024F   567F           01335          movra    tempcal2
0250   8000           01336          call       delay1
0251   000E           01337            CLRWDT
                      01338 
0252   0000           01339                  nop
0253   0000           01340                  nop
0254   6784           01341          incr      FSR0
0255   5989           01342          movar     INDF3
0256   5680           01343          movra     tempcal3
0257   5983           01344          movar     HIBYTE
0258   5681           01345          movra     tempcal4
0259   6F84           01346                  DECR      FSR0
                      01347 
                      01348 
                      01349 
025A   787E           01350                  ANDAR     tempcal1
025B   787F           01351                 ANDAR     tempcal2
025C   7880           01352                  ANDAR     tempcal3
025D   7881           01353                                  ANDAR     tempcal4
025E   39FF           01354                  XORAI     0FFH
                      01355                                 ; XORAI     000H        ;test
025F   000C           01356                  return
                      01357 ;*************************************************
                      01358 ;写内部数据
                      01359 ;*************************************************
0260                  01360 WriteBie:
0260   EFAD           01361                 jbset           PUMP,7                  ;4个TEST
0261   A000           01362                 goto            WriteBie
0262   000E           01363                 CLRWDT
0263   8000           01364                 call            delay1
0264   000E           01365                 CLRWDT
0265   EFAD           01366                 jbset           PUMP,7
0266   A000           01367                 goto            CalErr3
0267   0000           01368                 nop
0268   0000           01369                 nop
0269   0000           01370                 nop
026A   584B           01371                 movar           CalDot1H
026B   5783           01372                 movra           HIBYTE
026C   584A           01373                 movar           CalDot1L
026D   5789           01374                 movra           INDF3
026E   8000           01375                 call            delay1
026F   000E           01376                 CLRWDT
0270   EFAD           01377                 jbset           PUMP,7
0271   A000           01378                 goto            CalErr3
                      01379 
0272   0000           01380                 nop
0273   0000           01381                 nop
0274   6784           01382                 incr            FSR0
0275   584D           01383                 movar           CalDot2H
0276   5783           01384                 movra           HIBYTE
0277   584C           01385                 movar           CalDot2L
0278   5789           01386                 movra           INDF3
0279   8000           01387                 call            delay1
027A   000E           01388                 CLRWDT
027B   EFAD           01389                 jbset           PUMP,7
027C   A000           01390                 goto            CalErr3
027D   0000           01391                 nop
027E   0000           01392                 nop
027F   6784           01393                 incr            FSR0
0280   584F           01394                 movar           CalDot3H
0281   5783           01395                 movra           HIBYTE
0282   584E           01396                 movar           CalDot3L
0283   5789           01397                 movra           INDF3
                      01398 
0284   000C           01399                 return
                      01400 
                      01401                 ;#include         "GetCount.asm"
                      01402 ;**************************************************
                      01403 ;Title  : Proc from AD to Count
                      01404 ;Author : Kevin Lee
                      01405 ;Input  : TempRam3,TempRam4
                      01406 ;         CalDot1H,CalDot1L; CalDot2H,CalDot2L; CalDot3H,CalDot3L;CalCount1H,CalCount1L
                      01407 ;OutPut : CountH,CountL (0.25d)  TempRam3,TempRam4
                      01408 ;Date   : 2012/5/31 9:36
                      01409 ;**************************************************
0285                  01410 _GetCount:
                      01411 ;               JBSET           IOP0,0
                      01412 ;               call            GetZeroPoint
0285   8000           01413                 call            CurAD_ZeroAD            ;HML_DR - ZeroHML
0286   DC15           01414                 bclr            SysFlag1,NegFlag
0287   F187           01415                 jbclr           PFALG, 0
0288   A000           01416                 goto            _GetCount123
0289   CC15           01417                 bset            SysFlag1,NegFlag
028A   7652           01418                 clrr            CountH
028B   7653           01419                 clrr            CountL
028C   000C           01420                 return
028D                  01421 _GetCount123:                                           ;HML_DR >= ZeroHML
                      01422                 movff           Reg1,CalCount1H
028D   5848               M                 movar           f1
028E   5636               M                 movra           f2
                      01423                 movff           Reg2,CalCount1L
028F   5849               M                 movar           f1
0290   5637               M                 movra           f2
                      01424 
                      01425                 movff           TempRam1,TempRam2
0291   5808               M                 movar           f1
0292   5607               M                 movra           f2
                      01426                 movff           TempRam2,TempRam3
0293   5809               M                 movar           f1
0294   5608               M                 movra           f2
                      01427 
                      01428                 movff           TempRam3,TempRam1
0295   5807               M                 movar           f1
0296   5609               M                 movra           f2
                      01429                 movff           TempRam4,TempRam2
0297   5808               M                 movar           f1
0298   560A               M                 movra           f2
                      01430 
                      01431                 movff           TempRam5,CalDot1H
0299   584B               M                 movar           f1
029A   560B               M                 movra           f2
                      01432                 movff           TempRam6,CalDot1L
029B   584A               M                 movar           f1
029C   560C               M                 movra           f2
029D   8000           01433                 CALL            _Sub2_2
029E   E187           01434                 jbset           PFALG, 0
029F   A000           01435                 GOTO            GetCount1
02A0   0000           01436                 nop
                      01437                 movff           TempRam3,TempRam1
02A1   5807               M                 movar           f1
02A2   5609               M                 movra           f2
                      01438                 movff           TempRam4,TempRam2
02A3   5808               M                 movar           f1
02A4   560A               M                 movra           f2
                      01439                 movff           TempRam5,CalDot2H
02A5   584D               M                 movar           f1
02A6   560B               M                 movra           f2
                      01440                 movff           TempRam6,CalDot2L
02A7   584C               M                 movar           f1
02A8   560C               M                 movra           f2
02A9   8000           01441                 CALL            _Sub2_2
02AA   E187           01442                 jbset           PFALG, 0
02AB   A000           01443                 GOTO            GetCount2
                      01444 
02AC   D187           01445                 bclr            PFALG, 0
02AD   5237           01446                 RLR             Reg2
02AE   5236           01447                 RLR             Reg1
02AF   584C           01448                 movar           CalDot2L
02B0   484E           01449                 RSUBAR          CalDot3L
02B1   5650           01450                 movra           CalConstL
                      01451 
02B2   584D           01452                 movar           CalDot2H
02B3   0C4F           01453                 RSBCAR          CalDot3H
02B4   5651           01454                 movra           CalConstH
                      01455 
02B5   584C           01456                 movar           CalDot2L
02B6   4808           01457                 RSUBAR          TempRam2
02B7   560C           01458                 movra           TempRam6
                      01459 
02B8   584D           01460                 movar           CalDot2H
02B9   0C07           01461                 RSBCAR          TempRam1
02BA   560B           01462                 movra           TempRam5
02BB   A000           01463                 goto            GetCount3
02BC                  01464 GetCount1:
02BC   7636           01465                 clrr            Reg1
02BD   7637           01466                 clrr            Reg2
                      01467                 movff           CalConstH,CalDot1H
02BE   584B               M                 movar           f1
02BF   5651               M                 movra           f2
                      01468                 movff           CalConstL,CalDot1L
02C0   584A               M                 movar           f1
02C1   5650               M                 movra           f2
                      01469                 movff           TempRam5,TempRam1
02C2   5807               M                 movar           f1
02C3   560B               M                 movra           f2
                      01470                 movff           TempRam6,TempRam2
02C4   5808               M                 movar           f1
02C5   560C               M                 movra           f2
02C6   A000           01471                 goto            GetCount3
02C7                  01472 GetCount2:
02C7   584A           01473                 movar           CalDot1L
02C8   484C           01474                 RSUBAR           CalDot2L
02C9   5650           01475                 movra           CalConstL
                      01476 
02CA   584B           01477                 movar           CalDot1H
02CB   0C4D           01478                 RSBCAR          CalDot2H
02CC   5651           01479                 movra           CalConstH
                      01480 
02CD   584A           01481                 movar           CalDot1L
02CE   4808           01482                 RSUBAR           TempRam2
02CF   560C           01483                 movra           TempRam6
                      01484 
02D0   584B           01485                 movar           CalDot1H
02D1   0C07           01486                 RSBCAR          TempRam1
02D2   560B           01487                 movra           TempRam5
                      01488 ;...............
02D3                  01489 GetCount3:
02D3   760D           01490                 clrr            TempRam11
                      01491                 movff           TempRam12,CalCount1H
02D4   5848               M                 movar           f1
02D5   560E               M                 movra           f2
                      01492                 movff           TempRam13,CalCount1L
02D6   5849               M                 movar           f1
02D7   560F               M                 movra           f2
                      01493 
02D8   760A           01494                 clrr            TempRam4
                      01495 
02D9   D187           01496                 bclr            PFALG, 0
02DA   520C           01497                 RLR             TempRam6
02DB   520B           01498                 RLR             TempRam5
02DC   520A           01499                 RLR             TempRam4
                      01500 
02DD   D187           01501                 bclr            PFALG, 0
02DE   520C           01502                 RLR             TempRam6
02DF   520B           01503                 RLR             TempRam5
02E0   520A           01504                 RLR             TempRam4
                      01505 
02E1   8000           01506                 call            _Mul3_2
                      01507 
02E2   760D           01508                 clrr            TempRam11
                      01509                 movff           TempRam12,CalConstH
02E3   5851               M                 movar           f1
02E4   560E               M                 movra           f2
                      01510                 movff           TempRam13,CalConstL
02E5   5850               M                 movar           f1
02E6   560F               M                 movra           f2
02E7   8000           01511                 call            _Div6_3
02E8   8000           01512                 call            _ProcAdd1
                      01513 
                      01514                 movff           TempRam3,Reg1
02E9   5836               M                 movar           f1
02EA   5609               M                 movra           f2
                      01515                 movff           TempRam4,Reg2
02EB   5837               M                 movar           f1
02EC   560A               M                 movra           f2
                      01516 
02ED   D187           01517                 bclr            PFALG, 0
02EE   520A           01518                 RLR             TempRam4
02EF   5209           01519                 RLR             TempRam3
                      01520 
02F0   D187           01521                 bclr            PFALG, 0
02F1   520A           01522                 RLR             TempRam4
02F2   5209           01523                RLR             TempRam3
                      01524 
02F3   8000           01525                 call            _Add2_2
                      01526 
                      01527                 movff           CountH,TempRam3
02F4   5809               M                 movar           f1
02F5   5652               M                 movra           f2
                      01528                 movff           CountL,TempRam4
02F6   580A               M                 movar           f1
02F7   5653               M                 movra           f2
                      01529 
02F8   000C           01530                 return
                      01531 
                      01532 
                      01533                 ;#include         "Display_Weight.asm"
                      01534 ;************************************************
                      01535 ;Title  : Proc Display Weight
                      01536 ;Author : Kevin Lee
                      01537 ;Input  : TempRam12,TempRam13
                      01538 ;Date   : 2008-7-10 23:50
                      01539 ;*************************************************
02F9                  01540 Display_Weight:
02F9   E466           01541                 jbset           SysFlag4,LockFlag
02FA   A000           01542                 goto            Dsp_Weight_B
                      01543 
                      01544                 ; movff           TempRam12,LockCountH                  ;重量锁定
                      01545                 ; movff           TempRam13,LockCountL
                      01546                 movff           TempRam5,LockCountH                  ;重量锁定
02FB   5860               M                 movar           f1
02FC   560B               M                 movra           f2
                      01547                 movff           TempRam6,LockCountL
02FD   5861               M                 movar           f1
02FE   560C               M                 movra           f2
02FF   A000           01548                 goto            Dsp_Weight_C
                      01549 
                      01550                  ;jbset           SysFlag2,GlintFlag                   ;中断闪烁亮
                      01551                  ;goto            Dsp_Weight_B
                      01552                 ; nop
                      01553                 ; return
                      01554 ;................................................
0300                  01555 Dsp_Weight_B:
                      01556                 movff           TempRam5,CountH     ;称重显示
0300   5852               M                 movar           f1
0301   560B               M                 movra           f2
                      01557                 movff           TempRam6,CountL
0302   5853               M                 movar           f1
0303   560C               M                 movra           f2
                      01558                ; call            GetRealCount      ;为啥加2
                      01559 
                      01560 ;....................................................
0304                  01561 Dsp_Weight_C:
0304   F0CD           01562                 jbclr           UnitFlag,KgFlag
0305   A000           01563                 goto            Dsp_Weight_C1
                      01564 
0306   760A           01565                 clrr            TempRam4                               ;kg换算lb
                      01566                 movfl           TempRam12, 2BH
0307   3C2B               M                 movai           d1
0308   560E               M                 movra           f1
                      01567                 movfl           TempRam13, 0FH                         ;11023
0309   3C0F               M                 movai           d1
030A   560F               M                 movra           f1
030B   8000           01568                 call            _Mul3_2
030C   760D           01569                 clrr            TempRam11
                      01570                 movfl           TempRam12, 27H
030D   3C27               M                 movai           d1
030E   560E               M                 movra           f1
                      01571                 movfl           TempRam13, 10H                         ;10000
030F   3C10               M                 movai           d1
0310   560F               M                 movra           f1
0311   8000           01572                 call            _Div6_3
0312   8000           01573                 call            _ProcAdd1
                      01574 
0313   D187           01575                 bclr            C
0314   520C           01576                 RLR             TempRam6
0315   520B           01577                 RLR             TempRam5                               ;乘以2，精度为2g
0316                  01578 Dsp_Weight_C1:
                      01579                 movff           TempRam12,TempRam5
0316   580B               M                 movar           f1
0317   560E               M                 movra           f2
                      01580                 movff           TempRam13,TempRam6
0318   580C               M                 movar           f1
0319   560F               M                 movra           f2
                      01581 ;................................................
031A                  01582 Dsp_Weight_B1:
031A   F4CD           01583                 jbclr           UnitFlag,StFlag                   ;ST标志位的到来
031B   A000           01584                 goto            Dsp_Weight_St
                      01585 
031C   8000           01586                 call            _Ftob                             ;查找BCD码
031D   8000           01587                 call            Display_Num
031E   8000           01588                 call            Ram_To_Disp
                      01589 
031F   C5C2           01590                 bset            LCDDS0,2
                      01591 
0320   C1C2           01592                                 bset            LCDDS0,0
                      01593 
0321   E2CD           01594                                 jbset           UnitFlag,LbFlag
0322   000C           01595                         return
0323   D1C2           01596                                 bclr            LCDDS0,0
0324   C1C5           01597                                 bset            LCDDS3,0
0325   000C           01598                  return
                      01599 ;..................................................
0326                  01600 Dsp_Weight_St:
0326   7608           01601                 clrr            TempRam2
0327   7609           01602                 clrr            TempRam3
0328   760A           01603                 clrr            TempRam4
                      01604 
0329   3C04           01605                 movai           4
032A   7E0C           01606                 ADDRA           TempRam6
032B   3C00           01607                 movai           0                                   ;四舍五入
032C   120B           01608                 ADCRA          TempRam5
                      01609 
032D   760D           01610                 clrr            TempRam11
032E   760E           01611                 clrr            TempRam12
                      01612                 movfl           TempRam13, 140                      ;lb换算st
032F   3C8C               M                 movai           d1
0330   560F               M                 movra           f1
0331   8000           01613                 call            _Div6_3
                      01614 
                      01615                 movff           Reg1,TempRam2
0332   5808               M                 movar           f1
0333   5636               M                 movra           f2
                      01616                 movff           Reg2,TempRam3                       ;存放余数
0334   5809               M                 movar           f1
0335   5637               M                 movra           f2
                      01617 
                      01618                 movff           TempRam12,TempRam5
0336   580B               M                 movar           f1
0337   560E               M                 movra           f2
                      01619                 movff           TempRam13,TempRam6                  ;存放商
0338   580C               M                 movar           f1
0339   560F               M                 movra           f2
                      01620 
                      01621 
033A   8000           01622                 call            _Ftob                               ;转换成BCD码
                      01623 
                      01624                 movff           Display4,TempRam6
033B   580C               M                 movar           f1
033C   5613               M                 movra           f2
                      01625                 movff           Display3,TempRam5
033D   580B               M                 movar           f1
033E   5612               M                 movra           f2
                      01626 
                      01627                 movff           TempRam12,Reg1
033F   5836               M                 movar           f1
0340   560E               M                 movra           f2
                      01628                 movff           TempRam13,Reg2
0341   5837               M                 movar           f1
0342   560F               M                 movra           f2
                      01629 
0343   8000           01630                 call            _Ftob                               ;转换成BCD码
                      01631 
                      01632                 movff           TempRam6,TempRam5
0344   580B               M                 movar           f1
0345   560C               M                 movra           f2
                      01633                 movff           TempRam5,TempRam4
0346   580A               M                 movar           f1
0347   560B               M                 movra           f2
                      01634 
                      01635                 movff           TempRam3,Display3
0348   5812               M                 movar           f1
0349   5609               M                 movra           f2
                      01636                 movff           TempRam4,Display4
034A   5813               M                 movar           f1
034B   560A               M                 movra           f2
                      01637 
034C   7612           01638                 clrr            Display3                             ;可不要
034D   7613           01639                 clrr            Display4
                      01640 
034E   3C00           01641                 movai           0
034F   4009           01642                 XORAR           TempRam3
0350   E587           01643                 jbset           Z
0351   A000           01644                 goto            Dsp_Weight_St1
                      01645                 movfl           TempRam3,0x0a           ;清除没有的零
0352   3C0A               M                 movai           d1
0353   5609               M                 movra           f1
0354                  01646 Dsp_Weight_St1:
0354   3C00           01647                 movai           0
0355   400B           01648                 XORAR           TempRam5
0356   E587           01649                 jbset           Z
0357   A000           01650                 goto            Dsp_Weight_St2
                      01651                 movfl           TempRam5,0x0a
0358   3C0A               M                 movai           d1
0359   560B               M                 movra           f1
035A                  01652 Dsp_Weight_St2:
035A   8000           01653                 call            Display_Num
035B   8000           01654                 call            Ram_To_Disp
035C   C1C8           01655                                 bset            LCDDS6,0
035D   C5C5           01656                                 bset            LCDDS3,2
035E   000C           01657                 return
                      01658 
                      01659                 ;#include         "Display_ADC.asm"
                      01660 ;**************************************************
                      01661 ;Title  : Display ADC
                      01662 ;Author : Kevin Lee
                      01663 ;Date   : 2008-7-13 10:20
                      01664 ;**************************************************
035F                  01665 Display_ADC:
035F   E256           01666                 jbset           SysFlag3,DspCalFlag
0360   A000           01667                 goto            Display_ADC0
                      01668 
0361                  01669 Display_ADCCAL:
                      01670                 ;movfl           Display4,LcdchC
                      01671                 ;movfl           Display3,LcdchA
                      01672                 ;movfl           Display2,LcdchL
                      01673                 movfl           Display4,05H
0361   3C05               M                 movai           d1
0362   5613               M                 movra           f1
                      01674                 movfl           Display3,05H
0363   3C05               M                 movai           d1
0364   5612               M                 movra           f1
                      01675                 movfl           Display2,05H
0365   3C05               M                 movai           d1
0366   5611               M                 movra           f1
0367   F054           01676                 jbclr           TF1, 0
0368   000C           01677                 return
0369   F454           01678                 jbclr           TF1, 2
036A   3C03           01679                 movai           3
036B   F654           01680                 jbclr           TF1, 3
036C   3C04           01681                 movai           4
036D   F854           01682                 jbclr           TF1, 4
036E   3C05           01683                 movai           5
036F   5610           01684                 movra           Display1
0370   000C           01685                 return
                      01686 
                      01687 ;**************************************************
0371                  01688 Display_ADC0:
0371   F054           01689                 jbclr           TF1, 0
0372   A000           01690                 goto            Display_ADCCAL
                      01691 
0373   E254           01692                 jbset           TF1, 1
0374   A000           01693                 goto            Display_ADC1
                      01694 
                      01695                 movff           TempRam1,H_DR
0375   5816               M                 movar           f1
0376   5607               M                 movra           f2
                      01696                 movff           TempRam2,M_DR
0377   5817               M                 movar           f1
0378   5608               M                 movra           f2
                      01697                 movff           TempRam3,L_DR
0379   5818               M                 movar           f1
037A   5609               M                 movra           f2
                      01698                 movff           TempRam4,AmendZeroH
037B   585C               M                 movar           f1
037C   560A               M                 movra           f2
                      01699                 movff           TempRam5,AmendZeroM
037D   5871               M                 movar           f1
037E   560B               M                 movra           f2
                      01700                 movff           TempRam6,AmendZeroL
037F   585B               M                 movar           f1
0380   560C               M                 movra           f2
0381   8000           01701                 call            _Sub3_3
                      01702                 ;call            _Neg3
                      01703 
0382   D187           01704                 bclr            PFALG, 0
0383   4E07           01705                 rrr             TempRam1
0384   4E08           01706                 rrr             TempRam2
0385   4E09           01707                 rrr             TempRam3
                      01708 
                      01709                 movff           TempRam11,TempRam1
0386   5807               M                 movar           f1
0387   560D               M                 movra           f2
                      01710                 movff           TempRam12,TempRam2
0388   5808               M                 movar           f1
0389   560E               M                 movra           f2
                      01711                 movff           TempRam13,TempRam3
038A   5809               M                 movar           f1
038B   560F               M                 movra           f2
                      01712 
038C   8000           01713                 call            _Ftob
038D   8000           01714                 call            Display_Num
038E   000C           01715                 return
                      01716 
                      01717 ;*************************************************
038F                  01718 Display_ADC1:
038F   F454           01719                 jbclr           TF1, 2
0390   A000           01720                 goto            Display_ADCCAL
                      01721 
                      01722 ;**************************************************
0391                  01723 Display_ADC2:
0391   8000           01724                 call            CurAD_ZeroAD
                      01725                ; call            _Neg3
                      01726 
0392   D187           01727                 bclr              PFALG, 0
0393   4E08           01728                 rrr             TempRam2                ; 校磅内码数/2
0394   4E09           01729                 rrr             TempRam3
                      01730 
                      01731                 movff           FtobH,TempRam2
0395   5808               M                 movar           f1
0396   5672               M                 movra           f2
                      01732                 movff           FtobL,TempRam3
0397   5809               M                 movar           f1
0398   5673               M                 movra           f2
0399   8000           01733                 call            _Ftob
                      01734 
039A   8000           01735                 call            Display_Num
039B   000C           01736                 return
                      01737 
039C                  01738 Lcd_Dis_Cal:
039C   3C02           01739                 movai           0x02
039D   5635           01740                 movra           Reg0
039E   3CC0           01741                 movai           0xc0
039F   5607           01742                 movra           TempRam1
                      01743 
03A0                  01744 Lcd_Dis_Cal1:
03A0   5807           01745                 movar           TempRam1
03A1   5785           01746                 movra           FSR1
03A2   5813           01747                 movar           Display4
03A3   5781           01748                 movra           INDF1                   ;[D42:D40]->0X1C0
                      01749 
03A4   6607           01750                 incr            TempRam1
03A5   4613           01751                 swapr           Display4
03A6   5807           01752                 movar           TempRam1
03A7   5785           01753                 movra           FSR1
03A8   3C07           01754                 movai           0x07
03A9   7813           01755                 ANDAR           Display4
03AA   5781           01756                 movra           INDF1                   ;[D46:D44]->0X1C1
                      01757 
03AB   6607           01758                 incr            TempRam1
03AC   D187           01759                 bclr            C
03AD   4E13           01760                 rrr             Display4
03AE   4E13           01761                 rrr             Display4
03AF   5807           01762                 movar           TempRam1
03B0   5785           01763                 movra           FSR1
03B1   3C02           01764                 movai           0x02
03B2   7813           01765                 ANDAR           Display4
03B3   5781           01766                 movra           INDF1                   ;[0,D47,0]->0X1C2
                      01767 
03B4                  01768 Lcd_Dis_Cal2:
03B4   3C02           01769                 movai           0x02
03B5   5635           01770                 movra           Reg0
03B6   3CC3           01771                 movai           0xc3
03B7   5607           01772                 movra           TempRam1
                      01773 
03B8                  01774 Lcd_Dis_Cal3:
03B8   5807           01775                 movar           TempRam1
03B9   5785           01776                 movra           FSR1
03BA   5812           01777                 movar           Display3
03BB   5781           01778                 movra           INDF1                   ;[D32:D30]->0X1C3
                      01779 
03BC   6607           01780                 incr            TempRam1
03BD   4612           01781                 swapr           Display3
03BE   5807           01782                 movar           TempRam1
03BF   5785           01783                 movra           FSR1
03C0   3C07           01784                 movai           0x07
03C1   7812           01785                 ANDAR           Display3
03C2   5781           01786                 movra           INDF1                   ;[D36:D34]->0X1C4
                      01787 
03C3   6607           01788                 incr            TempRam1
03C4   D187           01789                 bclr            C
03C5   4E12           01790                 rrr             Display3
03C6   4E12           01791                 rrr             Display3
03C7   5807           01792                 movar           TempRam1
03C8   5785           01793                 movra           FSR1
03C9   3C02           01794                 movai           0x02
03CA   7812           01795                 ANDAR           Display3
03CB   5781           01796                 movra           INDF1                   ;[0,D37,0]->0X1C5
                      01797 
03CC                  01798 Lcd_Dis_Cal4:
03CC   3C02           01799                 movai           0x02
03CD   5635           01800                 movra           Reg0
03CE   3CC6           01801                 movai           0xc6
03CF   5607           01802                 movra           TempRam1
03D0                  01803 Lcd_Dis_Cal5:
03D0   5807           01804                 movar           TempRam1
03D1   5785           01805                 movra           FSR1
03D2   5811           01806                 movar           Display2
03D3   5781           01807                 movra           INDF1
                      01808 
03D4   6607           01809                 incr            TempRam1
03D5   4611           01810                 swapr           Display2
03D6   5807           01811                 movar           TempRam1
03D7   5785           01812                 movra           FSR1
03D8   3C07           01813                 movai           0x07
03D9   7811           01814                 ANDAR           Display2
03DA   5781           01815                 movra           INDF1
                      01816 
03DB   6607           01817                 incr            TempRam1
03DC   D187           01818                 bclr            C
03DD   4E11           01819                 rrr             Display2
03DE   4E11           01820                 rrr             Display2
03DF   5807           01821                 movar           TempRam1
03E0   5785           01822                 movra           FSR1
03E1   3C02           01823                 movai           0x02
03E2   7811           01824                 ANDAR           Display2
03E3   5781           01825                 movra           INDF1
                      01826 
03E4                  01827 Lcd_Dis_Cal6:
03E4   3C02           01828                 movai           0x02
03E5   5635           01829                 movra           Reg0
03E6   3CC9           01830                 movai           0xc9
03E7   5607           01831                 movra           TempRam1
03E8                  01832 Lcd_Dis_Cal7:
03E8   5807           01833                 movar           TempRam1
03E9   5785           01834                 movra           FSR1
03EA   5810           01835                 movar           Display1
03EB   5781           01836                 movra           INDF1
                      01837 
03EC   6607           01838                 incr            TempRam1
03ED   4610           01839                 swapr           Display1
03EE   5807           01840                 movar           TempRam1
03EF   5785           01841                 movra           FSR1
03F0   3C07           01842                 movai           0x07
03F1   7810           01843                 ANDAR           Display1
03F2   5781           01844                 movra           INDF1
                      01845 
03F3   6607           01846                 incr            TempRam1
03F4   D187           01847                 bclr            C
03F5   4E10           01848                 rrr             Display1
03F6   4E10           01849                 rrr             Display1
03F7   5807           01850                 movar           TempRam1
03F8   5785           01851                 movra           FSR1
03F9   3C02           01852                 movai           0x02
03FA   7810           01853                 ANDAR           Display1
03FB   5781           01854                 movra           INDF1
                      01855 
03FC   000C           01856                 return
                      01857 
                      01858 
03FD                  01859 Lcd_Dis_Sys:
03FD   3C02           01860                 movai           0x02
03FE   5635           01861                 movra           Reg0
03FF   3CC0           01862                 movai           0xc0
0400   5607           01863                 movra           TempRam1
0401                  01864 Lcd_Dis_Sys1:
                      01865 
0401   5807           01866                 movar           TempRam1
0402   5785           01867                 movra           FSR1
0403   5813           01868                 movar           Display4
0404   5781           01869                 movra           INDF1
                      01870 
0405   6607           01871                 incr            TempRam1
0406   4613           01872                 swapr           Display4
0407   5807           01873                 movar           TempRam1
0408   5785           01874                 movra           FSR1
0409   3C07           01875                 movai          0x07
040A   7813           01876                 ANDAR          Display4
040B   5781           01877                 movra          INDF1
                      01878 
040C   6607           01879                 incr            TempRam1
040D   D187           01880                 bclr            C
040E   4E13           01881                 rrr             Display4
040F   4E13           01882                 rrr             Display4
0410   5807           01883                 movar           TempRam1
0411   5785           01884                 movra           FSR1
0412   3C02           01885                 movai           0x02
0413   7813           01886                 ANDAR           Display4
0414   5781           01887                 movra           INDF1
0415   000C           01888                 return
                      01889 
                      01890                 ;#include         "Display.asm"
                      01891 ;**************************************************
                      01892 ;确定要显示的是哪个数！
                      01893 ;**************************************************
0416                  01894 Lcd_Num:
                      01895 
0416   5640           01896        movra    DspData1
0417   3A00           01897        isubai   0x00
0418   F587           01898        jbclr    Z
0419   8000           01899        call     lcd_disp0
                      01900 
041A   5840           01901        movar    DspData1
041B   3A01           01902        isubai   0x01
041C   F587           01903        jbclr    Z
041D   8000           01904        call     lcd_disp1
                      01905 
041E   5840           01906        movar    DspData1
041F   3A02           01907        isubai   0x02
0420   F587           01908        jbclr    Z
0421   8000           01909        call     lcd_disp2
                      01910 
0422   5840           01911        movar    DspData1
0423   3A03           01912        isubai   0x03
0424   F587           01913        jbclr    Z
0425   8000           01914        call     lcd_disp3
                      01915 
0426   5840           01916        movar    DspData1
0427   3A04           01917        isubai   0x04
0428   F587           01918        jbclr    Z
0429   8000           01919        call     lcd_disp4
                      01920 
042A   5840           01921        movar    DspData1
042B   3A05           01922        isubai   0x05
042C   F587           01923        jbclr    Z
042D   8000           01924        call     lcd_disp5
                      01925 
042E   5840           01926        movar    DspData1
042F   3A06           01927        isubai   0x06
0430   F587           01928        jbclr    Z
0431   8000           01929        call     lcd_disp6
                      01930 
0432   5840           01931        movar    DspData1
0433   3A07           01932        isubai   0x07
0434   F587           01933        jbclr    Z
0435   8000           01934        call     lcd_disp7
                      01935 
0436   5840           01936        movar    DspData1
0437   3A08           01937        isubai   0x08
0438   F587           01938        jbclr    Z
0439   8000           01939        call     lcd_disp8
                      01940 
043A   5840           01941        movar    DspData1
043B   3A09           01942        isubai   0x09
043C   F587           01943        jbclr    Z
043D   8000           01944        call     lcd_disp9
                      01945 
043E   5840           01946        movar    DspData1
043F   3A0A           01947        isubai   0x0a
0440   F587           01948        jbclr    Z
0441   8000           01949        call     lcd_disp_null
                      01950 
0442   000C           01951        return
                      01952 
                      01953 ;=========================================================
                      01954 
                      01955 
0443                  01956 lcd_disp0:
                      01957 
0443   3CD7           01958         movai   11010111b
0444   563F           01959         movra   DspData
0445   000C           01960         return
0446                  01961 lcd_disp1:
                      01962 
0446   3C03           01963         movai   00000011b
0447   563F           01964         movra   DspData
0448   000C           01965         return
0449                  01966 lcd_disp2:
                      01967 
0449   3C75           01968         movai   01110101b
044A   563F           01969         movra   DspData
044B   000C           01970         return
044C                  01971 lcd_disp3:
                      01972 
044C   3C37           01973         movai   00110111b
044D   563F           01974         movra   DspData
044E   000C           01975         return
044F                  01976 lcd_disp4:
044F   3CA3           01977         movai   10100011b
0450   563F           01978         movra   DspData
0451   000C           01979         return
0452                  01980 lcd_disp5:
0452   3CB6           01981         movai   10110110b
0453   563F           01982         movra   DspData
0454   000C           01983         return
0455                  01984 lcd_disp6:
0455   3CF6           01985         movai   11110110b
0456   563F           01986         movra   DspData
0457   000C           01987         return
0458                  01988 lcd_disp7:
0458   3C13           01989         movai   00010011b
0459   563F           01990         movra   DspData
045A   000C           01991         return
045B                  01992 lcd_disp8:
045B   3CF7           01993         movai   11110111b
045C   563F           01994         movra   DspData
045D   000C           01995         return
045E                  01996 lcd_disp9:
045E   3CB7           01997         movai   10110111b
045F   563F           01998         movra   DspData
0460   000C           01999         return
0461                  02000 lcd_disp_null:
0461   3C00           02001         movai   00000000b
0462   563F           02002         movra   DspData
0463   000C           02003         return
                      02004 
                      02005 ;**************************************************
                      02006 ;十六进制转十进制时的显示
                      02007 ;**************************************************
0464                  02008 Display_Num:
0464   3C00           02009                 movai           0x00
0465   4009           02010                 xorar           TempRam3
0466   E587           02011                 jbset           Z
0467   A000           02012                 goto            Display_Num1
0468   3C0A           02013                 movai           0x0a
0469   5609           02014                 movra           TempRam3
                      02015 
                      02016 
046A   3C00           02017                 movai           0x00
046B   400A           02018                 xorar           TempRam4
046C   E587           02019                 jbset           Z
046D   A000           02020                 goto            Display_Num1
046E   3C0A           02021                 movai           0x0a
046F   560A           02022                 movra           TempRam4
                      02023 
                      02024              ;   movai           0x00
                      02025              ;   xorar           TempRam5
                      02026              ;   jbset           Z
                      02027              ;   goto            Display_Num1
                      02028              ;   movai           10
                      02029              ;   movra           TempRam5
                      02030 
0470                  02031 Display_Num1:
0470   5809           02032                 movar           TempRam3
0471   8000           02033                 call            Lcd_Num
0472   583F           02034                 movar           DspData
0473   5610           02035                 movra           Display1
                      02036 
                      02037 
0474   580A           02038                 movar           TempRam4
0475   8000           02039                 call            Lcd_Num
0476   583F           02040                 movar           DspData
0477   5611           02041                 movra           Display2
                      02042 
0478   580B           02043                 movar           TempRam5
0479   8000           02044                 call            Lcd_Num
047A   583F           02045                 movar           DspData
047B   5612           02046                 movra           Display3
                      02047 
047C   580C           02048                 movar           TempRam6
047D   8000           02049                 call            Lcd_Num
047E   583F           02050                 movar           DspData
047F   5613           02051                 movra           Display4
                      02052 
0480   000C           02053                 return
                      02054 ;*************************************************
                      02055 ;清显示缓冲
                      02056 ;*************************************************
0481                  02057 ClrLCDBuffer:
0481   3C00           02058                 movai           0x00
0482   A000           02059                 goto            DisplayCom
0483                  02060 FullDspBuffer:
0483   3CFF           02061                 movai           0xff
0484                  02062 DisplayCom:
0484   5614           02063                 movra           DisplayFs1
0485                  02064 DisplayCom1:
0485   5610           02065                 movra           Display1
0486   5611           02066                 movra           Display2
0487   5612           02067                 movra           Display3
0488   5613           02068                 movra           Display4
                      02069 
0489   000C           02070                 return
                      02071 ;**************************************************
                      02072 ;装载显示，display-->tempram,tempram-->lcd1&lcd0-->显示，，，
                      02073 ;**************************************************
048A                  02074 LoadDspData:                                    ;Display1-4 -> LCDDS2-9
048A   3C07           02075                 movai           0x07
048B   5635           02076                 movra           Reg0
048C   3CC0           02077                 movai           0xc0            ;LCDDS4;
048D   5607           02078                 movra           TempRam1
                      02079 
048E   3C10           02080                 movai           Display1
048F   5608           02081                 movra           TempRam2
0490   5784           02082                 movra           FSR0
                      02083 ;======================
0491                  02084 LoadDspDataLoop1:
0491   5980           02085                 movar           INDF0
0492   5609           02086                 movra           TempRam3
0493   5807           02087                 movar           TempRam1
0494   5785           02088                 movra           FSR1
0495   5809           02089                 movar           TempRam3
0496   5781           02090                 movra           INDF1
                      02091 
0497   6607           02092                 incr            TempRam1
0498   4609           02093                 swapr           TempRam3
0499   5807           02094                 movar           TempRam1
049A   5785           02095                 movra           FSR1
049B   5809           02096                 movar           TempRam3
049C   5781           02097                 movra           INDF1
                      02098 
049D   6607           02099                 incr            TempRam1
049E   6608           02100                 incr            TempRam2
049F   5808           02101                 movar           TempRam2
04A0   5784           02102                 movra           FSR0
                      02103 
04A1   6A35           02104                 djzr            Reg0
04A2   A000           02105                 goto            LoadDspDataLoop1
04A3   000C           02106                 return
                      02107 
                      02108 ;*************************
04A4                  02109 Lcd_Dis:
04A4   3C02           02110                 movai           0x02
04A5   5635           02111                 movra           Reg0
04A6   3CC0           02112                 movai           0xc0
04A7   5607           02113                 movra           TempRam1
04A8                  02114 Lcd_Dis1:
04A8   5807           02115                 movar           TempRam1
04A9   5785           02116                 movra           FSR1
04AA   5813           02117                 movar           Display4
04AB   5781           02118                 movra           INDF1
                      02119 
04AC   6607           02120                 incr            TempRam1
04AD   4613           02121                 swapr           Display4
04AE   5807           02122                 movar           TempRam1
04AF   5785           02123                 movra           FSR1
04B0   3C07           02124                 movai          0x07
04B1   7813           02125                 ANDAR          Display4
04B2   5781           02126                 movra          INDF1
                      02127 
04B3   6607           02128                 incr            TempRam1
04B4   D187           02129                 bclr            C
04B5   4E13           02130                 rrr             Display4
04B6   4E13           02131                 rrr             Display4
04B7   5807           02132                 movar           TempRam1
04B8   5785           02133                 movra           FSR1
04B9   3C02           02134                 movai          0x02
04BA   7813           02135                 ANDAR          Display4
04BB   5F81           02136                 ORRA           INDF1
                      02137 
04BC                  02138 Lcd_Dis2:
04BC   3C02           02139                 movai           0x02
04BD   5635           02140                 movra           Reg0
04BE   3CC3           02141                 movai           0xc3
04BF   5607           02142                 movra           TempRam1
04C0                  02143 Lcd_Dis3:
04C0   5807           02144                 movar           TempRam1
04C1   5785           02145                 movra           FSR1
04C2   5812           02146                 movar           Display3
04C3   5781           02147                 movra           INDF1
                      02148 
04C4   6607           02149                 incr            TempRam1
04C5   4612           02150                 swapr           Display3
04C6   5807           02151                 movar           TempRam1
04C7   5785           02152                 movra           FSR1
04C8   3C07           02153                 movai          0x07
04C9   7812           02154                 ANDAR          Display3
04CA   5781           02155                 movra          INDF1
                      02156 
04CB   6607           02157                 incr            TempRam1
04CC   D187           02158                 bclr            C
04CD   4E12           02159                 rrr             Display3
04CE   4E12           02160                 rrr             Display3
04CF   5807           02161                 movar           TempRam1
04D0   5785           02162                 movra           FSR1
04D1   3C02           02163                 movai          0x02
04D2   7812           02164                 ANDAR          Display3
04D3   5F81           02165                 ORRA           INDF1
                      02166 
04D4                  02167 Lcd_Dis4:
04D4   3C02           02168                 movai           0x02
04D5   5635           02169                 movra           Reg0
04D6   3CC6           02170                 movai           0xc6
04D7   5607           02171                 movra           TempRam1
04D8                  02172 Lcd_Dis5:
04D8   5807           02173                 movar           TempRam1
04D9   5785           02174                 movra           FSR1
04DA   5811           02175                 movar           Display2
04DB   5781           02176                 movra           INDF1
04DC   6607           02177                 incr            TempRam1
04DD   4611           02178                 swapr           Display2
04DE   5807           02179                 movar           TempRam1
04DF   5785           02180                 movra           FSR1
                      02181 
04E0   3C07           02182                 movai          0x07
04E1   7811           02183                 ANDAR          Display2
04E2   5781           02184                 movra          INDF1
                      02185 
04E3   6607           02186                 incr            TempRam1
04E4   D187           02187                 bclr            C
04E5   4E11           02188                 rrr             Display2
04E6   4E11           02189                 rrr             Display2
04E7   5807           02190                 movar           TempRam1
04E8   5785           02191                 movra           FSR1
                      02192 
04E9   3C02           02193                 movai          0x02
04EA   7811           02194                 ANDAR          Display2
04EB   5F81           02195                 ORRA           INDF1
                      02196 
04EC                  02197 Lcd_Dis6:
04EC   3C02           02198                 movai           0x02
04ED   5635           02199                 movra           Reg0
04EE   3CC9           02200                 movai           0xc9
04EF   5607           02201                 movra           TempRam1
04F0                  02202 Lcd_Dis7:
04F0   5807           02203                 movar           TempRam1
04F1   5785           02204                 movra           FSR1
04F2   5810           02205                 movar           Display1
04F3   5781           02206                 movra           INDF1
                      02207 
04F4   6607           02208                 incr            TempRam1
04F5   4610           02209                 swapr           Display1
04F6   5807           02210                 movar           TempRam1
04F7   5785           02211                 movra           FSR1
04F8   3C07           02212                 movai          0x07
04F9   7810           02213                 ANDAR          Display1
04FA   5781           02214                 movra          INDF1
                      02215 
04FB   6607           02216                 incr            TempRam1
04FC   D187           02217                 bclr            C
04FD   4E10           02218                 rrr             Display1
04FE   4E10           02219                 rrr             Display1
04FF   5807           02220                 movar           TempRam1
0500   5785           02221                 movra           FSR1
0501   3C02           02222                 movai          0x02
0502   7810           02223                 ANDAR          Display1
0503   5F81           02224                 ORRA           INDF1
                      02225 
0504                  02226 Unit_Dis:
0504   F0CD           02227                 jbclr           UnitFlag,KgFlag
0505   A000           02228                 goto            Unit_DisKG
0506   F4CD           02229                 jbclr           UnitFlag,StFlag
0507   A000           02230                 goto            Unit_DisST
0508   F2CD           02231                 jbclr           UnitFlag,LbFlag
0509   A000           02232                 goto            Unit_DisLB
                      02233 
050A                  02234 Unit_DisKG:
050A   C5C2           02235                 bset            LCDDS0,2
050B   C1C2           02236                 bset            LCDDS0,0
050C   000C           02237                 return
                      02238 
050D                  02239 Unit_DisLB:
050D   D1C2           02240                 bclr            LCDDS0,0
050E   C5C2           02241                 bset            LCDDS0,2
050F   C1C5           02242                 bset            LCDDS3,0
0510   000C           02243                 return
                      02244 
0511                  02245 Unit_DisST:
0511   C1C8           02246                 bset            LCDDS6,0
0512   C5C5           02247                 bset            LCDDS3,2
0513   000C           02248                 return
                      02249 
                      02250 
                      02251 ;..................................................
                      02252 ;看门狗唤醒处理
                      02253 ;..................................................
0514                  02254 WDTWankenUp:
                      02255                 ;#include       "WDTWakenUp.asm"
                      02256 ;************************************************
                      02257 ;Title  : 看门狗唤醒处理
                      02258 ;Author : Kevin Lee
                      02259 ;Date   : 2009-9-9 14:18
                      02260 ;************************************************
0514   EB88           02261                 jbset           MCR, 5
0515   A000           02262                 goto            goto_allstop
0516   DB88           02263                 bclr            MCR, 5
0517   000E           02264                 clrwdt
                      02265 
0518                  02266 TestWdtIn:
0518   DB88           02267                 bclr            MCR, 5
0519   C2CC           02268                 bset            AutoOn_Flags,WdtWaken_Flag
                      02269 
                      02270 ;..................................................
051A                  02271 WDTClock:
051A   C215           02272                 bset            SysFlag1,AdcStartFlag
051B   763C           02273                 clrr            SampleTimes
                      02274 
051C   DC6F           02275                 bclr            SysFlag5,WdtTrackSFlag
051D   DE6F           02276                 bclr            SysFlag5,WdtTrackBFlag
                      02277                 movfl           WakenUpCount,43
051E   3C2B               M                 movai           d1
051F   5670               M                 movra           f1
                      02278                 movfl           TF1, 10
0520   3C0A               M                 movai           d1
0521   5654               M                 movra           f1
                      02279 
                      02280 ;************************************************
0522                  02281 WDTWakenUpLoop:
0522   D015           02282                 bclr            SysFlag1,WdtProcADFlag
                      02283 
                      02284 ;......
0523                  02285 WDTWakenUpLoop1:
0523   DFA0           02286                 bclr            T0CR,7                  ;关T0
0524   CBB0           02287                 bset            ADCR0,5                 ;开PGA
0525   CFB0           02288                 bset            ADCR0,7                 ;开ADC
0526   CF88           02289                 bset            MCR,7                   ;GIE=1
0527   CDAD           02290                 bset            PUMP,6                  ;开PUMP
                      02291 
0528   3C40           02292                 movai           40H
0529   578A           02293                 movra           INTE                    ;ADIE=1
052A   3C00           02294                 movai           0x00
052B   578B           02295                 movra           INTF
052C   CFA0           02296                 bset            T0CR,7                  ;开T0
052D   3C07           02297                 movai           0x07
052E   57B1           02298                 movra           ADCR1           ;77=65536,128  57=16384,128  37=4096,128 采样时间16ms@2M?
052F   3CC0           02299                 movai           0xc0
0530   57B2           02300                 movra           ADCR2
0531   3CC0           02301                 movai           0xc0
0532   57B2           02302                 movra           ADCR2                   ;?
                      02303 
0533   C1AE           02304                 bset            OSCM,0                  ;高频一直开
0534   D3AE           02305                 BCLR            OSCM,1                  ;低频休眠停振
0535   D5AE           02306                 BCLR            OSCM,2                  ;系统高频工作
0536   3C58           02307                 movai           0x58
0537   57B3           02308                 movra           TPSC                    ;LDO开 2.5V,基准电压开
                      02309 ;*******************************
0538                  02310 WDT_WAIT:
                      02311 
0538                  02312 WDT_STOP:
0538   C1AE           02313                 bset            OSCM,0                  ;高频一直开
0539   D3AE           02314                 bclr            OSCM,1                  ;低频休眠停振
053A   D5AE           02315                 bclr            OSCM,2                  ;系统高频工作
053B   3C00           02316                 movai           0x00
053C   578B           02317                 movra           INTF
053D   000E           02318                 CLRWDT
053E   0000           02319                 NOP
053F   000B           02320                 stop                                    ;ADC能唤醒进中断
0540   0000           02321                 nop
0541   0000           02322                 nop
0542   0000           02323                 nop                                     ;唤醒后系统高频工作
0543   000E           02324                 CLRWDT
0544   CF88           02325                 bset            MCR,7                   ;GIE=1
0545                  02326 wait_adifE:
0545   E415           02327                 jbset           SysFlag1,AdcOkFlag
0546   A000           02328                 goto            WDT_WAIT
                      02329 
0547   C015           02330                 bset            SysFlag1,WdtProcADFlag
0548   D415           02331                 bclr            SysFlag1,AdcOkFlag
                      02332 
0549   58D2           02333                 movar           AutoOnADL
054A   4829           02334                 RSUBAR          ADRamM
054B   58D1           02335                 movar           AutoOnADH
054C   0C28           02336                 RSBCAR          ADRamH
                      02337 
054D   F187           02338                 jbclr           C
054E   A000           02339                 goto            WDTWakenUp0
                      02340 
054F   A000           02341                 goto            goto_allstop            ;AD值小于开机显示门限
                      02342 
                      02343 ;................................................
0550                  02344 WDTWakenUp0:                                            ;AD值超过开机显示门限
0550   FC6F           02345                 jbclr           SysFlag5,WdtTrackSFlag
0551   A000           02346                 goto            goto_allstop
                      02347 
0552   CE6F           02348                 bset            SysFlag5,WdtTrackBFlag
0553   6A70           02349                 DJZR            WakenUpCount            ; 连续50次AD都大于开机重量的AD才开机
0554   A000           02350                 goto            WDTWakenUpLoop
0555   A000           02351                 goto            WDTWakenUp1
                      02352 
                      02353 ;................................................
0556                  02354 WDTWakenUp1:
0556   C0CC           02355                 bset            AutoOn_Flags,WakenOn_Flag       ; 重力开机标志
                      02356 
                      02357 ;................................................
0557                  02358 WDTWakenUp2:
0557   000E           02359                 clrwdt
0558   D2CC           02360                 bclr            AutoOn_Flags,WdtWaken_Flag
0559   D866           02361                 bclr            SysFlag4,LowBatFlag
055A   D015           02362                 bclr            SysFlag1,WdtProcADFlag
                      02363 
                      02364 ;************************************************
055B                  02365 WDTWakenUpEnd:
055B   A000           02366                 goto            SysInit1
                      02367 
                      02368 ;************************************************
                      02369 ;上电复位处理
                      02370 ;************************************************
055C                  02371 SysInit:
055C   3C95           02372                 movai           0x95
055D   5784           02373                 movra           FSR0
055E   7780           02374 rst_clr         clrr            INDF0                   ;clr 0x95-0xd4
055F   6784           02375                 incr            FSR0
0560   3CD5           02376                 movai           0xd5
0561   4984           02377                 rsubar          FSR0
0562   E187           02378                 jbset           C
0563   A000           02379                 goto            rst_clr
                      02380 
0564   3C01           02381                 movai           0x01
0565   56CD           02382                 movra           UnitFlag
                      02383 
                      02384 ;************************************************
0566                  02385 SysInit1:
                      02386                 ;#include         "sys_init.asm"
0566                  02387 sys_init:
0566   3C30           02388                 movai           0x30
0567   57AE           02389                 movra           OSCM                    ;系统高频工作,高/低频休眠停振
0568   8000           02390                 call            delay1
0569   3C63           02391                 movai           0x63
056A   57AD           02392                 movra           PUMP                    ;开PUMP,选择高频时钟,烧录电压7.5V,电压受VLCDX控制,LCD电压3.0V
056B   8000           02393                 call            delay1
056C   3C58           02394                 movai           0x58
056D   57B3           02395                 movra           TPSC                    ;开LDO 2.5V,开基准电压          ;0x78=2.3V,0x58=2.5V,0x38=2.8V,0x18=3.0V
056E   8000           02396                 call            delay1
                      02397 
                      02398 ;***********************************************
                      02399 ;IO设置
                      02400 ;***********************************************
056F                  02401 Io_init:
056F   3CFF           02402                 movai           0xff
0570   57BA           02403                 movra           LCDIOS1
0571   57BB           02404                 movra           LCDIOS2                 ;设置LCD驱动引脚,IO设为SEG2-SEG13
                      02405 
0572   3CF0           02406                 movai           0xf0
0573   5791           02407                 movra           OEP0                    ;P00-P03输入,P04-P07输出
0574   3CEF           02408                 movai           0xef
0575   5790           02409                 movra           IOP0                    ;P04输出低,P05-P07输出高
0576   3CEB           02410                 movai           0xeb
0577   5792           02411                 movra           PUP0                    ;P00,P01,P03上拉
0578   3CFF           02412                 movai           0xff
0579   5795           02413                 movra           OEP1                    ;P1全输出
                      02414 
057A   3C00           02415                 movai           0x00
057B   5796           02416                 movra           PUP1
057C   579A           02417                 movra           PUP2
057D   579E           02418                 movra           PUP3
                      02419 
057E   5794           02420                 movra           IOP1                    ;P1输出低
057F   5798           02421                 movra           OEP2                    ;P2全输入
0580   579C           02422                 movra           OEP3                    ;P3全输入
0581   5799           02423                 movra           IOP2
0582   579D           02424                 movra           IOP3
                      02425 
                      02426 ;************************************************
0583                  02427 inte_init:
0583   3C00           02428                 movai           0x00
0584   5788           02429                 movra           MCR                     ;下降沿触发,GIE=0
0585   3C84           02430                 movai           0x84
0586   57AF           02431                 movra           LVDCR                   ;LVDEN=1,VBGSEL=1,比较电压LVDI输入
0587   3C45           02432                 movai           0x45
0588   578A           02433                 movra           INTE                    ;INT0IE=1,T0IE=1,ADIE=1
                      02434 
0589   778B           02435                 clrr            INTF
                      02436 
058A   3C17           02437                 movai           0x17
058B   57A0           02438                 movra           T0CR                    ;T0未使能,选择低频时钟,128分频
                      02439 
058C   3C55           02440                 movai           0x55
058D   57A2           02441                 movra           T0LOAD
058E   57A1           02442                 movra           T0CNT                   ;T=(0X55+1)*128/32K=344ms
                      02443 
                      02444 ;***********************************************
                      02445 ;AD初始化
                      02446 ;***********************************************
058F                  02447 ad_init:
058F   3CEC           02448                 movai           0xec
0590   57B0           02449                 movra           ADCR0                   ;CHOP打开,PGA打开,高频时钟64分频,使能ADC
0591   3C77           02450                 movai           0x77            ; AD速率//改37-77，降采样选择最高
0592   57B1           02451                 movra           ADCR1           ; 77=65536,128  57=16384,128  37=4096,128 采样一次32.768ms@8M?
0593   3CC0           02452                 movai           0xc0
0594   57B2           02453                 movra           ADCR2                   ;TADCINEN=1 ? TPGAOUTEN=1 ?
                      02454 
0595   3C82           02455                 movai           0x82
0596   57B8           02456                 movra           LCDCR0                  ;开LCD
                      02457 
0597   3C2F           02458                 movai           0x2f
0598   57B9           02459                 movra           LCDCR1                  ;1/3DUTY,低频时钟
                      02460 
                      02461        ;                movai           0x60
                      02462        ;                movra           HIRCCR1                 ;高频时钟2M,8分频 似乎无效//改_删掉
0599   000E           02463                 CLRWDT
                      02464 
059A   D2CC           02465                 bclr            AutoOn_Flags,WdtWaken_Flag
                      02466 
                      02467 ;..............................................
                      02468 ;清空RAM
                      02469 ;..............................................
059B   3C00           02470                 movai           Buffer0
059C   5784           02471                 movra           FSR0
059D                  02472 ClrRam:                                                 ;清零0X00-0X98
059D   7780           02473                 clrr            INDF0
059E   6784           02474                 incr            FSR0
059F   3C99           02475                 movai           0X99
05A0   4984           02476                 rsubar          FSR0
05A1   E187           02477                 jbset           C
05A2   A000           02478                 goto            ClrRam
05A3   7684           02479                 clrr            second
                      02480 
                      02481 ;************************************************
                      02482 ;默认数据
                      02483 ;************************************************
                      02484                 movfl           CalCount1H, 01H
05A4   3C01               M                 movai           d1
05A5   5648               M                 movra           f1
                      02485                 movfl           CalCount1L, 0F4H
05A6   3CF4               M                 movai           d1
05A7   5649               M                 movra           f1
                      02486 
                      02487 ;*************************************************
                      02488 ;读取BIE
                      02489 ;*************************************************
05A8                  02490 IntReadBie:
05A8   3C00           02491                 movai           0X00
05A9   5788           02492                 movra           MCR                     ;GIE=0
05AA   3C00           02493                 movai           0x00
05AB   57AE           02494                 movra           OSCM                    ;系统高频工作,高/低频休眠停振
05AC   3C78           02495                 MOVAI           0x78
05AD   57B3           02496                 movra           TPSC                    ;2.3V LDO打开,基准电压打开
05AE   3C64           02497                 movai           0x64
05AF   57AD           02498                 movra           PUMP                    ;开PUMP,选择高频时钟,烧录电压7.5V,电压受VCP_CAL控制,LCD电压2.6V
                      02499 
05B0   3C0F           02500                 movai           0x0F
05B1   5695           02501                 movra           REG3
05B2   3C00           02502                 movai           0x00
05B3   5784           02503                 movra           FSR0
05B4   3C0F           02504                 movai           0x0F
05B5   5785           02505                 movra           FSR1
05B6                  02506 IntReadBie1:
05B6   0000           02507                 nop
05B7   0000           02508                 nop
05B8   5989           02509                 movar           INDF3                   ;起始地址0x0F00
05B9   568E           02510                 movra           CheckRam1
05BA   5983           02511                 movar           HIBYTE
05BB   568F           02512                 movra           CheckRam2
05BC   0000           02513                 nop
05BD   0000           02514                 nop
05BE   6784           02515                 incr            FSR0
05BF   5989           02516                 movar           INDF3
05C0   5690           02517                 movra           CheckRam3
05C1   5983           02518                 movar           HIBYTE
05C2   5691           02519                 movra           CheckRam4
05C3   0000           02520                 nop
05C4   0000           02521                 nop
05C5   6784           02522                 incr            FSR0
05C6   5989           02523                 movar           INDF3
05C7   5692           02524                 movra           CheckRam5
05C8   5983           02525                 movar           HIBYTE
05C9   5693           02526                 movra           CheckRam6
                      02527 
05CA   3CFF           02528                 movai           0FFH
05CB   788E           02529                 ANDAR           CheckRam1
05CC   788F           02530                 ANDAR           CheckRam2
05CD   7890           02531                 ANDAR           CheckRam3
05CE   7891           02532                 ANDAR           CheckRam4
05CF   39FF           02533                 XORAI           0FFH
05D0   F587           02534                 jbclr           Z
05D1   A000           02535                 goto            IntReadBie2             ;读出数据全FF
05D2   0000           02536                 nop
                      02537                 movff           CalDot1L,CheckRam1
05D3   588E               M                 movar           f1
05D4   564A               M                 movra           f2
                      02538                 movff           CalDot1H,CheckRam2
05D5   588F               M                 movar           f1
05D6   564B               M                 movra           f2
                      02539                 movff           CalDot2L,CheckRam3
05D7   5890               M                 movar           f1
05D8   564C               M                 movra           f2
                      02540                 movff           CalDot2H,CheckRam4
05D9   5891               M                 movar           f1
05DA   564D               M                 movra           f2
                      02541                 movff           CalDot3L,CheckRam5
05DB   5892               M                 movar           f1
05DC   564E               M                 movra           f2
                      02542                 movff           CalDot3H,CheckRam6
05DD   5893               M                 movar           f1
05DE   564F               M                 movra           f2
05DF   3C02           02543                 movai           0x02
05E0   7F84           02544                 ADDRA           FSR0
05E1   6A95           02545                 DJZR            REG3
05E2   A000           02546                 goto            IntReadBie1
05E3   A000           02547                 goto            IntReadBie4             ;15次全有数据
05E4                  02548 IntReadBie2:
05E4   5C4B           02549                 ORAR            CalDot1H
05E5   5C4E           02550                 ORAR            CalDot3L
05E6   5C4F           02551                 ORAR            CalDot3H
05E7   3900           02552                 XORAI           00H
05E8   F587           02553                 jbclr           Z
05E9   A000           02554                 goto            IntReadBie3             ;1H\3L\3H数据为0
05EA   A000           02555                 goto            IntReadBie4             ;
05EB                  02556 IntReadBie3:
                      02557                 movfl           CalDot1L,2BH
05EB   3C2B               M                 movai           d1
05EC   564A               M                 movra           f1
                      02558                 movfl           CalDot1H,17H
05ED   3C17               M                 movai           d1
05EE   564B               M                 movra           f1
                      02559                 movfl           CalDot2L,2BH
05EF   3C2B               M                 movai           d1
05F0   564C               M                 movra           f1
                      02560                 movfl           CalDot2H,2EH
05F1   3C2E               M                 movai           d1
05F2   564D               M                 movra           f1
                      02561                 movfl           CalDot3L,2BH
05F3   3C2B               M                 movai           d1
05F4   564E               M                 movra           f1
                      02562                 movfl           CalDot3H,46H
05F5   3C46               M                 movai           d1
05F6   564F               M                 movra           f1
05F7                  02563 IntReadBie4:
05F7   0000           02564                 nop
05F8   0000           02565                 nop
05F9   3C30           02566                 movai           0x30
05FA   57AE           02567                 movra           OSCM                    ;系统高频工作,高/低频休眠停振
05FB   3C61           02568                 movai           0x61
05FC   57AD           02569                 movra           PUMP                    ;开PUMP,选择高频时钟,烧录电压7.5V,电压受VLCDX控制,LCD电压3.2V
05FD   3C81           02570                 movai           0x81
05FE   5788           02571                 movra           MCR                     ;INT0下降沿触发,GIE=1
05FF   3C58           02572                 MOVAI           0x58
0600   57B3           02573                 movra           TPSC                    ;打开LDO 2.5V,打开基准电压
0601   000E           02574                 CLRWDT
0602   C990           02575                 bset            IOP0,4                  ;P04输出高
0603   3CFF           02576                 MOVAI           0XFF
0604   000E           02577                 CLRWDT
0605   8000           02578                 CALL            FullDspBuffer
0606   000E           02579                 CLRWDT
0607   8000           02580                 CALL            LoadDspData
0608   000E           02581                 CLRWDT
0609   3CFF           02582                 MOVAI           0XFF
060A   57CA           02583                 movra           LCDDS8
060B   57CB           02584                 movra           LCDDS9
060C   C1CA           02585                 bset            LCDDS8,0
060D   C7C7           02586                 bset            LCDDS5,3
060E   C683           02587                 BSET            SysFlag6,3
                      02588 
                      02589 ;**************************************************
                      02590 ;  BIE 读取数据
                      02591 ;**************************************************
060F                  02592 LoadBIEdata:
                      02593                 movfl           CalCount1H, 00H
060F   3C00               M                 movai           d1
0610   5648               M                 movra           f1
                      02594                 movfl           CalCount1L, 07DH        ; 50kg
0611   3C7D               M                 movai           d1
0612   5649               M                 movra           f1
                      02595 
                      02596                 movfl           MaxCountH, 0X07
0613   3C07               M                 movai           d1
0614   5668               M                 movra           f1
                      02597                 movfl           MaxCountL, 0X08         ; 152.0 kg 超重
0615   3C08               M                 movai           d1
0616   5669               M                 movra           f1
                      02598 
0617   F0CC           02599                 jbclr           AutoOn_Flags,WakenOn_Flag
0618   A000           02600                 goto            Start
                      02601                 movfl           UnitFlag, 00000001b     ;复位初始化,重量单位需恢复默认kg
0619   3C01               M                 movai           d1
061A   56CD               M                 movra           f1
                      02602 ;************************************************
                      02603 ;
                      02604 ;************************************************
061B                  02605 Start:
061B   C215           02606                 bset            SysFlag1,AdcStartFlag
061C   763C           02607                 clrr            SampleTimes
061D   D415           02608                 bclr            SysFlag1,AdcOkFlag
                      02609 
061E   E0CC           02610                 jbset           AutoOn_Flags,WakenOn_Flag
061F   A000           02611                 goto            Init_Power
0620   D0CC           02612                 bclr            AutoOn_Flags,WakenOn_Flag
                      02613                 movfl           Prog_Flow, 00001000B    ;开机显示中
0621   3C08               M                 movai           d1
0622   565F               M                 movra           f1
                      02614                 movfl           T_Auto_Off, 12          ;movff     T_Auto_Off,T_WeightMode      ; 8秒关机时间
0623   3C0C               M                 movai           d1
0624   565E               M                 movra           f1
                      02615 
                      02616 ;**************************************************
                      02617 ;initialize some ram
                      02618 ;**************************************************
0625                  02619 Init_Power:
0625   763D           02620                 clrr            TBASE01S
0626   763E           02621                 clrr            TBASE05S
0627   000E           02622                 CLRWDT
                      02623 ;................................................
                      02624 
0628   D415           02625                 bclr            SysFlag1,AdcOkFlag
0629   D615           02626                 bclr            SysFlag1,DataOkFlag
062A   D615           02627                 bclr            SysFlag1,SteadyFlag
                      02628 
062B   7666           02629                 clrr            SysFlag4
062C   766F           02630                 clrr            SysFlag5
                      02631 
062D   7652           02632                 clrr            CountH
062E   7653           02633                 clrr            CountL
062F   7646           02634                 clrr            StableCount
                      02635 
0630   F65F           02636                 jbclr           Prog_Flow, 3
0631   A000           02637                 goto            MainLoop                ;开机显示中
                      02638 
0632   EE5A           02639                 jbset           Power_Flags,FlashZFlag
0633   0000           02640                 nop
0634   0000           02641                 nop
                      02642                 movfl           Prog_Flow, 00000010b    ;复位处理中
0635   3C02               M                 movai           d1
0636   565F               M                 movra           f1
                      02643                 movfl           T_Auto_Off, 10          ; 最长5秒钟的刷新零点的时间
0637   3C0A               M                 movai           d1
0638   565E               M                 movra           f1
0639                  02644 Init_Power1:
                      02645 
                      02646 ;**************************************************
                      02647 ;开机归零程序
                      02648 ;**************************************************
0639                  02649 MainLoop1:
0639   E25F           02650                 jbset           Prog_Flow, 1
063A   A000           02651                 goto            MainLoop
                      02652 
063B   E615           02653                 jbset           SysFlag1,SteadyFlag
063C   A000           02654                 goto            MainLoop1End
                      02655 
063D   8000           02656                 call            GetZeroPoint            ; 刷新零点
063E   8000           02657                 call            _GetAutoOnDC
                      02658                 movfl           Prog_Flow, 00001000B
063F   3C08               M                 movai           d1
0640   565F               M                 movra           f1
0641   A000           02659                 goto            MainLoop
                      02660 
0642   7652           02661                 clrr            CountH
0643   7653           02662                 clrr            CountL
0644                  02663 MainLoop1End:
                      02664 
0644                  02665 MainLoop:
0644   F25F           02666                 jbclr           Prog_Flow, 1
0645   A000           02667                 goto            Scankey_In
0646   E683           02668                 jbset           SysFlag6,3
0647   A000           02669                 goto            Scankey_In
0648   D683           02670                 bclr            SysFlag6,3
0649   0000           02671                 nop
064A                  02672 Test_LowBat
064A   3C32           02673                 movai           0x32
064B   5694           02674                 movra           Lo_Counter
064C                  02675 Test_LowBat01
064C   E1AF           02676                 jbset           LVDCR,0
064D   A000           02677                 goto            Scankey_In      ;0x066b
064E   0000           02678                 nop
064F   0000           02679                 nop
0650   0000           02680                 nop
0651   6A94           02681                 djzr            Lo_Counter
0652   A000           02682                 goto            Test_LowBat01   ;0x64f
0653   7611           02683                 clrr            Display2
0654   7610           02684                 clrr            Display1
0655   3C66           02685                 movai           01100110b               ;'o'
0656   5613           02686                 movra           Display4
0657   3C44           02687                 movai           01000100b               ;'L'
0658   5612           02688                 movra           Display3
0659   C990           02689                 bset            IOP0,4
065A   8000           02690                 call            Lcd_Dis_Cal
065B   3C02           02691                 movai           0x02
065C   57C5           02692                 movra           LCDDS3
065D   8000           02693                 call            delay1
065E   8000           02694                 call            delay1
065F   8000           02695                 call            delay1
0660   8000           02696                 call            delay1
0661   8000           02697                 call            delay1
0662   8000           02698                 call            delay1
0663   8000           02699                 call            delay1
0664   8000           02700                 call            delay1
0665   8000           02701                 call            delay1
0666   8000           02702                 call            delay1
0667   A000           02703                 goto            Sleep_In
                      02704 
                      02705                 ;#include       "scankey.asm"
0668                  02706 Scankey_In:
0668   F190           02707                 jbclr           IOP0,0
0669   A000           02708                 goto            Main_Key
066A   768D           02709                 clrr            second3                 ;P00输入低
066B   C082           02710                 bset            keycode,0
066C   A000           02711                 goto            Key_Exit
                      02712 
066D                  02713 Main_Key:
066D   768C           02714                 clrr            second2                 ;P00输入高(上拉)
066E   E082           02715                 jbset           keycode,0
066F   A000           02716                 goto            Key_Exit
0670                  02717 Unit_key:                                               ;按键弹起
0670   7682           02718                 clrr            keycode
0671   C055           02719                 bset            Key_Up, UnitKey
0672   668B           02720                 incr            Key_Times
                      02721 
0673                  02722 Key_Exit:
                      02723                 ;#include       "change.asm"
                      02724 ;**************************************************
                      02725 ;Function    :Get the unit
                      02726 ;Create Date :2012/5/17 16:03
                      02727 ;Create By   :Kevin Lee
                      02728 ;**************************************************
0673                  02729 _GetUnitAux:
0673   FE5F           02730                 jbclr           Prog_Flow, 7            ; 7 校正   单位换算标志位的到来
0674   A000           02731                 goto            _GetUnitAuxEnd
                      02732 
0675                  02733 _GetUnitAuxKey:
0675   D06C           02734                 bclr            Status_Flags,SWUnitFlag
0676   E055           02735                 jbset           Key_Up, UnitKey
0677   A000           02736                 goto            _GetUnitAuxEnd          ;无按键弹起动作
                      02737 
0678   7684           02738                 clrr            second
                      02739                 movfl           T_Auto_Off, 12          ;movff  T_Auto_Off,T_WeightMode
0679   3C0C               M                 movai           d1
067A   565E               M                 movra           f1
067B   D055           02740                 bclr            Key_Up, UnitKey
067C   D187           02741                 bclr            PFALG, 0
067D   52CD           02742                 rlr             UnitFlag
067E   3C01           02743                 movai           00000001B
067F   F6CD           02744                 jbclr           UnitFlag, 3
0680   56CD           02745                 movra           UnitFlag                ;0X01->0X02->0X04->0X08->0X01
0681   A000           02746                 goto            _GetUnitAuxEnd
                      02747 
                      02748 ;暂时不用
0682                  02749 _GetUnitAuxKey1:
0682   3C01           02750                 movai           00000001B
0683   F4CD           02751                 jbclr           UnitFlag, 2
0684   56CD           02752                 movra           UnitFlag
0685   A000           02753                 goto            _GetUnitAuxEnd
                      02754 
0686                  02755 Load_LB:
0686   3C02           02756                 movai           00000010B
0687   A000           02757                 goto            Load_Unit
0688                  02758 Load_ST:
0688   3C04           02759                 movai           00000100b
0689                  02760 Load_Unit:
0689   56CD           02761                 movra           UnitFlag
068A   C06C           02762                 bset            Status_Flags,SWUnitFlag
068B                  02763 _GetUnitAuxEnd:
                      02764                 ;#include       "procadc.asm"
                      02765 ;************************************************
                      02766 ;Title  : Proc AD Sub 滑动平均
                      02767 ;Author : Kevin Lee
                      02768 ;Date   : 2008-6-26 20:22
                      02769 ;************************************************
068B                  02770 _ProcAdc:
068B   E415           02771                 jbset           SysFlag1,AdcOkFlag
068C   A000           02772                 goto            ProcAdc_End
068D   D415           02773                 bclr            SysFlag1,AdcOkFlag
                      02774 
                      02775                 movff           TempRam1,H_DR
068E   5816               M                 movar           f1
068F   5607               M                 movra           f2
                      02776                 movff           TempRam2,M_DR
0690   5817               M                 movar           f1
0691   5608               M                 movra           f2
                      02777                 movff           TempRam3,L_DR
0692   5818               M                 movar           f1
0693   5609               M                 movra           f2
                      02778                 movff           TempRam4,H_DATA
0694   581C               M                 movar           f1
0695   560A               M                 movra           f2
                      02779                 movff           TempRam5,M_DATA
0696   581D               M                 movar           f1
0697   560B               M                 movra           f2
                      02780                 movff           TempRam6,L_DATA
0698   581E               M                 movar           f1
0699   560C               M                 movra           f2
069A   8000           02781                 CALL            _Sub3_3
                      02782 
069B   760A           02783                 CLRR            TempRam4
069C   760B           02784                 CLRR            TempRam5
                      02785                 movfl           TempRam6, 80    ; 波动范围
069D   3C50               M                 movai           d1
069E   560C               M                 movra           f1
069F   8000           02786                 CALL            _Sub3_3                 ;(HML_DR - HML_DATA) - 80
06A0   F187           02787                 jbclr           C
06A1   A000           02788                 goto            Proc_Adc1
06A2                  02789 _ProcAdc0:                                              ;(HML_DR - HML_DATA) < 80
                      02790                 movff           TempRam11,H_DATAC
06A2   5825               M                 movar           f1
06A3   560D               M                 movra           f2
                      02791                 movff           TempRam12,M_DATAC
06A4   5826               M                 movar           f1
06A5   560E               M                 movra           f2
                      02792                 movff           TempRam13,L_DATAC
06A6   5827               M                 movar           f1
06A7   560F               M                 movra           f2
                      02793 
06A8   5824           02794                 movar           L_DATAB         ; H_DATAC+差值
06A9   5627           02795                 movra           L_DATAC
06AA   7E0F           02796                 ADDRA           TempRam13
06AB   5823           02797                 movar           M_DATAB
06AC   5626           02798                 movra           M_DATAC
06AD   120E           02799                 ADCRA           TempRam12
06AE   5822           02800                 movar           H_DATAB
06AF   5625           02801                 movra           H_DATAC
06B0   120D           02802                 ADCRA           TempRam11               ;TempRam11/12/13 = HML_DATAC + HML_DATAB ,HML_DATAB -> HML_DATAC
                      02803 ;...............
06B1   5821           02804                 movar           L_DATAA
06B2   5624           02805                 movra           L_DATAB
06B3   7E0F           02806                 ADDRA           TempRam13
06B4   5820           02807                 movar           M_DATAA
06B5   5623           02808                 movra           M_DATAB
06B6   120E           02809                 ADCRA           TempRam12
06B7   581F           02810                 movar           H_DATAA
06B8   5622           02811                 movra           H_DATAB
06B9   120D           02812                 ADCRA           TempRam11
                      02813 ;...............
06BA   581E           02814                 movar           L_DATA
06BB   5621           02815                 movra           L_DATAA
06BC   7E0F           02816                 ADDRA           TempRam13
06BD   581D           02817                 movar           M_DATA
06BE   5620           02818                 movra           M_DATAA
06BF   120E           02819                 ADCRA           TempRam12
06C0   581C           02820                 movar           H_DATA
06C1   561F           02821                 movra           H_DATAA
06C2   120D           02822                 ADCRA           TempRam11
                      02823 
06C3   D187           02824                 bclr            C
06C4   4E0D           02825                 RRR             TempRam11
06C5   4E0E           02826                 RRR             TempRam12
06C6   4E0F           02827                 RRR             TempRam13
                      02828 
06C7   D187           02829                 bclr            C
06C8   4E0D           02830                 RRR             TempRam11
06C9   4E0E           02831                 RRR             TempRam12
06CA   4E0F           02832                 RRR             TempRam13       ; 除以4取平均
                      02833 
                      02834                 movff           H_DR,TempRam11
06CB   580D               M                 movar           f1
06CC   5616               M                 movra           f2
                      02835                 movff           M_DR,TempRam12
06CD   580E               M                 movar           f1
06CE   5617               M                 movra           f2
                      02836                 movff           L_DR,TempRam13
06CF   580F               M                 movar           f1
06D0   5618               M                 movra           f2
06D1   A000           02837                 goto            Proc_Adc2
                      02838 ;***************
06D2                  02839 Proc_Adc1:                                              ;(HML_DR - HML_DATA) >= 80
06D2   581C           02840                 movar           H_DATA          ; 刷新
06D3   5616           02841                 movra           H_DR
06D4   561F           02842                 movra           H_DATAA
06D5   5622           02843                 movra           H_DATAB
06D6   5625           02844                 movra           H_DATAC
                      02845 
06D7   581D           02846                 movar           M_DATA
06D8   5617           02847                 movra           M_DR
06D9   5620           02848                 movra           M_DATAA
06DA   5623           02849                 movra           M_DATAB
06DB   5626           02850                 movra           M_DATAC
                      02851 
06DC   581E           02852                 movar           L_DATA
06DD   5618           02853                 movra           L_DR
06DE   5621           02854                 movra           L_DATAA
06DF   5624           02855                 movra           L_DATAB
06E0   5627           02856                 movra           L_DATAC
                      02857 ;...............................
06E1                  02858 Proc_Adc2:                                      ; 判断内码是否稳定
                      02859                 movff           TempRam4,H_DRBuf
06E1   5819               M                 movar           f1
06E2   560A               M                 movra           f2
                      02860                 movff           TempRam5,M_DRBuf
06E3   581A               M                 movar           f1
06E4   560B               M                 movra           f2
                      02861                 movff           TempRam6,L_DRBuf
06E5   581B               M                 movar           f1
06E6   560C               M                 movra           f2
                      02862 
06E7   5816           02863                 movar           H_DR
06E8   5619           02864                 movra           H_DRBuf
06E9   5607           02865                 movra           TempRam1
                      02866 
06EA   5817           02867                 movar           M_DR
06EB   561A           02868                 movra           M_DRBuf
06EC   5608           02869                 movra           TempRam2
                      02870 
06ED   5818           02871                 movar           L_DR
06EE   561B           02872                 movra           L_DRBuf
06EF   5609           02873                 movra           TempRam3
                      02874 
06F0   8000           02875                 call            _Sub3_3
                      02876 
06F1   760A           02877                 clrr            TempRam4
06F2   760B           02878                 clrr            TempRam5
                      02879                 movfl           TempRam6, 3             ;movff          TempRam6,AdSteadyRange
06F3   3C03               M                 movai           d1
06F4   560C               M                 movra           f1
06F5                  02880 Proc_Adc2A:
06F5   8000           02881                 call            _Sub3_3
06F6   F187           02882                 jbclr           PFALG, 0
06F7   A000           02883                 goto            Unstable
06F8   6646           02884                 incr            StableCount
                      02885 
06F9   3C05           02886                 movai           5                       ;movar          AdsteadyTimes    ; 稳定次数
06FA   4846           02887                 RSUBAR          StableCount
06FB   E187           02888                 jbset           PFALG, 0
06FC   A000           02889                 goto            ProcAdc_End
06FD   6E46           02890                 DECR            StableCount
06FE   C615           02891                 BSET            SysFlag1,SteadyFlag
06FF   A000           02892                 goto            ProcAdc_End
                      02893 ;...............................
0700                  02894 Unstable:
0700   7646           02895                 clrr            StableCount
0701   D615           02896                 BCLR            SysFlag1,SteadyFlag
0702                  02897 ProcAdc_End:
0702   D2CC           02898                 bclr            AutoOn_Flags,WdtWaken_Flag
0703   F25F           02899                 jbclr           Prog_Flow, 1
0704   A000           02900                 GOTO            Close_End
                      02901 ;***********************************************
                      02902 ;8S没有重量变化自动关机
0705                  02903 Main_close:
0705   3CB9           02904                 movai           0B9H
0706   0884           02905                 ASUBAR          second                  ;0XB9-SECOND
0707   E187           02906                 jbset           C
0708   A000           02907                 goto            Sleep_In                ;SECOND>0XB9
                      02908 
0709                  02909 Close_End:                                              ;时间未到
0709   3C2E           02910                 movai           02EH
070A   488D           02911                 RSUBAR          second3                 ;SECOND3-0X2E
070B   F187           02912                 jbclr           C
070C   768B           02913                 clrr            Key_Times               ;SECOND3>=0X2E
                      02914 
070D   3C03           02915                 movai           03
070E   488B           02916                 RSUBAR          Key_Times               ;KEY_TIMES-03
070F   E187           02917                 jbset           C
0710   A000           02918                 goto            Proc_EnterADCEnd   ;三短 KEY_TIMES<03
                      02919 
0711                  02920 Proc_EnterADC1:
0711   F190           02921                 jbclr           IOP0,0
0712   A000           02922                 goto            Proc_EnterADCEnd   ;一长
                      02923 
0713   3C30           02924                 movai           0x30
0714   488C           02925                 RSUBAR          second2
0715   E187           02926                 jbset           PFALG, 0
0716   A000           02927                 goto            Proc_EnterADCEnd
0717   768C           02928                 clrr            second2
                      02929 
0718                  02930 Proc_EnterADCoK:
                      02931                 movfl           Prog_Flow, 10000000B
0718   3C80               M                 movai           d1
0719   565F               M                 movra           f1
                      02932                 movfl           TF1, 00000010B
071A   3C02               M                 movai           d1
071B   5654               M                 movra           f1
                      02933                 movfl           UnitFlag, 00000001b
071C   3C01               M                 movai           d1
071D   56CD               M                 movra           f1
                      02934 
071E   765C           02935                 clrr            AmendZeroH
071F   7671           02936                 clrr            AmendZeroM
0720   765B           02937                 clrr            AmendZeroL
                      02938 
                      02939                 movff           TempRam11,H_DR
0721   5816               M                 movar           f1
0722   560D               M                 movra           f2
                      02940                 movff           TempRam12,M_DR
0723   5817               M                 movar           f1
0724   560E               M                 movra           f2
                      02941                 movff           TempRam13,L_DR
0725   5818               M                 movar           f1
0726   560F               M                 movra           f2
                      02942 
0727                  02943 EnterADC1:
0727   7657           02944                 clrr            Timer1S
                      02945 
0728                  02946 Proc_EnterADCEnd:
                      02947 
0728                  02948 Main_Cal:
0728   E390           02949                 jbset           IOP0,1
0729   A000           02950                 goto            Sleep_In
                      02951 
072A   EE5F           02952                 jbset           Prog_Flow, 7
072B   A000           02953                 goto            DisplayCount
                      02954                 ;#include         "Cal.asm"
                      02955 
                      02956 ;**************************************************
                      02957 ;Calibration program
                      02958 ;TF1     1显CAL    2 显零点内码      3第一校正点   4第二校正点
                      02959 ;**************************************************
072C                  02960 InterCode1:
072C   7684           02961                 clrr             second
072D   000E           02962                 CLRWDT
072E   E254           02963                 jbset           TF1, 1
072F   A000           02964                 goto            ProcCal_0
0730   0000           02965                 nop
0731   7684           02966                 clrr             second
0732   3C03           02967                 movai          00000011b
0733   5613           02968                 movra           Display4
0734   8000           02969                 call           Lcd_Dis_Sys
0735   3C00           02970                 movai           00H
0736   57C2           02971                 movra           LCDDS0
0737   3C04           02972                 movai           04H
0738   57C3           02973                 movra           LCDDS1
0739   3C04           02974                 movai           04H
073A   57C4           02975                 movra           LCDDS2
073B   3C02           02976                 movai           02H
073C   57C5           02977                 movra           LCDDS3
073D   3C03           02978                 movai           03H
073E   57C6           02979                 movra           LCDDS4
073F   3C0F           02980                 movai           0FH
0740   57C7           02981                 movra           LCDDS5
0741   3C02           02982                 movai           02H
0742   57C8           02983                 movra           LCDDS6
0743   3C04           02984                 movai           04H
0744   57C9           02985                 movra           LCDDS7
0745   3C05           02986                 movai           05H
0746   57CA           02987                 movra           LCDDS8
0747   3C02           02988                 movai           02H
0748   57CB           02989                 movra           LCDDS9
0749   D615           02990                 bclr            SysFlag1,SteadyFlag
074A   8000           02991                 call           delay2
                      02992 
074B                  02993 InterCode1A:
074B   8000           02994                 call            Change_F1                  ;转换校榜流程，改变TF1的值
074C   A000           02995                 goto            ProcCalExit
                      02996 
                      02997 ;Calibration program
                      02998 ;***************
074D                  02999 ProcCal_0:
074D   E454           03000                 jbset           TF1, 2
074E   A000           03001                 goto            ProcCal_A
                      03002 
074F   E615           03003                 jbset           SysFlag1,SteadyFlag
0750   A000           03004                 goto            ProcCalExit
                      03005 
0751   8000           03006                 call            GetZeroPoint
0752   767B           03007                 clrr            displaycal1
0753   767C           03008                 clrr            displaycal2
0754   767D           03009                 clrr            displaycal3
0755   8000           03010                 call            Change_F1
0756   A000           03011                 goto            ProcCalExit
                      03012 
                      03013 ;***************
0757                  03014 ProcCal_A:
0757   8000           03015                 call            CurAD_ZeroAD
                      03016                 movff           displaycal1,TempRam1
0758   5807               M                 movar           f1
0759   567B               M                 movra           f2
                      03017                 movff           displaycal2,TempRam2
075A   5808               M                 movar           f1
075B   567C               M                 movra           f2
                      03018                 movff           displaycal3,TempRam3
075C   5809               M                 movar           f1
075D   567D               M                 movra           f2
075E   E615           03019                 jbset           SysFlag1,SteadyFlag
075F   A000           03020                 goto            ProcCalExit
                      03021 
0760   D615           03022                 bclr            SysFlag1,SteadyFlag
0761   7646           03023                 clrr            StableCount
                      03024 
0762   8000           03025                 call            CurAD_ZeroAD
                      03026 
                      03027                 movff           displaycal1,TempRam1
0763   5807               M                 movar           f1
0764   567B               M                 movra           f2
                      03028                 movff           displaycal2,TempRam2
0765   5808               M                 movar           f1
0766   567C               M                 movra           f2
                      03029                 movff           displaycal3,TempRam3
0767   5809               M                 movar           f1
0768   567D               M                 movra           f2
                      03030 
                      03031                 movff           CalDot3H,TempRam2             ; 当前内码与零点内码差值，暂存CalDot3H、CalDot3L
0769   5808               M                 movar           f1
076A   564F               M                 movra           f2
                      03032                 movff           CalDot3L,TempRam3
076B   5809               M                 movar           f1
076C   564E               M                 movra           f2
                      03033 ;..................................................
                      03034 
076D   760A           03035                 clrr            TempRam4
                      03036                 movfl           TempRam5, 01H
076E   3C01               M                 movai           d1
076F   560B               M                 movra           f1
                      03037                 movfl           TempRam6, 090H                ; 1000个内码以下若稳定，都追零，方便同时标定多台秤
0770   3C90               M                 movai           d1
0771   560C               M                 movra           f1
0772   8000           03038                 call            _Sub3_3
0773   E187           03039                 jbset            C
0774   A000           03040                 goto            ProcCal_B
                      03041 
                      03042 
0775   E654           03043                 jbset           TF1, 3
0776   A000           03044                 goto            ProcCal_A1
                      03045                 movff           CalDot1H,CalDot3H
0777   584F               M                 movar           f1
0778   564B               M                 movra           f2
                      03046                 movff           CalDot1L,CalDot3L
0779   584E               M                 movar           f1
077A   564A               M                 movra           f2
077B   A000           03047                 goto            ProcCalDot1
077C                  03048 ProcCal_A1:
077C   E854           03049                 jbset           TF1, 4
077D   A000           03050                 goto            ProcCal_A2
077E   8000           03051                 call            CurAD_ZeroAD
                      03052                 movff           displaycal1,TempRam1
077F   5807               M                 movar           f1
0780   567B               M                 movra           f2
                      03053                 movff           displaycal2,TempRam2
0781   5808               M                 movar           f1
0782   567C               M                 movra           f2
                      03054                 movff           displaycal3,TempRam3
0783   5809               M                 movar           f1
0784   567D               M                 movra           f2
                      03055                 movff           CalDot3H,TempRam2
0785   5808               M                 movar           f1
0786   564F               M                 movra           f2
                      03056                 movff           CalDot3L,TempRam3
0787   5809               M                 movar           f1
0788   564E               M                 movra           f2
                      03057 
0789   760A           03058                 clrr            TempRam4
                      03059                 movfl           TempRam5, 0BH
078A   3C0B               M                 movai           d1
078B   560B               M                 movra           f1
                      03060                 movfl           TempRam6, 0B8H
078C   3CB8               M                 movai           d1
078D   560C               M                 movra           f1
078E   8000           03061                 call            _Sub3_3
078F   E187           03062                 jbset            C
0790   A000           03063                 goto             ProcCalExit
                      03064                 movff           CalDot2H,CalDot3H
0791   584F               M                 movar           f1
0792   564D               M                 movra           f2
                      03065                 movff           CalDot2L,CalDot3L
0793   584E               M                 movar           f1
0794   564C               M                 movra           f2
                      03066 
                      03067                 movff           TempRam3,CalDot2H
0795   584D               M                 movar           f1
0796   5609               M                 movra           f2
                      03068                 movff           TempRam4,CalDot2L
0797   584C               M                 movar           f1
0798   560A               M                 movra           f2
                      03069 
                      03070                 movff           TempRam5,CalDot1H
0799   584B               M                 movar           f1
079A   560B               M                 movra           f2
                      03071                 movff           TempRam6,CalDot1L
079B   584A               M                 movar           f1
079C   560C               M                 movra           f2
079D   8000           03072                 CALL            _Sub2_2
079E   E187           03073                 jbset           PFALG, 0
079F   A000           03074                 goto             ProcCalExit
                      03075 
                      03076                 movfl           TempRam6,200      ;校正点2要比1大100才能通过
07A0   3CC8               M                 movai           d1
07A1   560C               M                 movra           f1
07A2   760B           03077                 clrr            TempRam5
07A3   8000           03078                 CALL            _Sub2_2
07A4   E187           03079                 jbset           PFALG, 0
07A5   A000           03080                 goto             ProcCalExit
07A6   A000           03081                 goto            ProcCalDot2
07A7                  03082 ProcCal_A2:
07A7   8000           03083                 call            CurAD_ZeroAD
                      03084                 movff           displaycal1,TempRam1
07A8   5807               M                 movar           f1
07A9   567B               M                 movra           f2
                      03085                 movff           displaycal2,TempRam2
07AA   5808               M                 movar           f1
07AB   567C               M                 movra           f2
                      03086                 movff           displaycal3,TempRam3
07AC   5809               M                 movar           f1
07AD   567D               M                 movra           f2
                      03087                 movff           CalDot3H,TempRam2
07AE   5808               M                 movar           f1
07AF   564F               M                 movra           f2
                      03088                 movff           CalDot3L,TempRam3
07B0   5809               M                 movar           f1
07B1   564E               M                 movra           f2
                      03089 
07B2   760A           03090                 clrr            TempRam4
                      03091                 movfl           TempRam5, 13H
07B3   3C13               M                 movai           d1
07B4   560B               M                 movra           f1
                      03092                 movfl           TempRam6, 88H
07B5   3C88               M                 movai           d1
07B6   560C               M                 movra           f1
07B7   8000           03093                 call            _Sub3_3
07B8   E187           03094                 jbset            C
07B9   A000           03095                 goto             ProcCalExit
                      03096 
                      03097                 movff           TempRam3,CalDot3H
07BA   584F               M                 movar           f1
07BB   5609               M                 movra           f2
                      03098                 movff           TempRam4,CalDot3L
07BC   584E               M                 movar           f1
07BD   560A               M                 movra           f2
                      03099 
                      03100                 movff           TempRam5,CalDot2H
07BE   584D               M                 movar           f1
07BF   560B               M                 movra           f2
                      03101                 movff           TempRam6,CalDot2L
07C0   584C               M                 movar           f1
07C1   560C               M                 movra           f2
07C2   8000           03102                 CALL            _Sub2_2
07C3   E187           03103                 jbset           PFALG, 0
07C4   A000           03104                 goto             ProcCalExit
                      03105 
                      03106                 movfl           TempRam6,200      ;校正点3要比2大100才能通过
07C5   3CC8               M                 movai           d1
07C6   560C               M                 movra           f1
07C7   760B           03107                 clrr            TempRam5
07C8   8000           03108                 CALL            _Sub2_2
07C9   E187           03109                 jbset           PFALG, 0
07CA   A000           03110                 goto             ProcCalExit
07CB   A000           03111                 goto            ProcCalDot3
07CC                  03112 ProcCal_B:
07CC   8000           03113                 call            GetZeroPoint
07CD   767B           03114                 clrr            displaycal1
07CE   767C           03115                 clrr            displaycal2
07CF   767D           03116                 clrr            displaycal3
07D0   A000           03117                 goto            ProcCalExit
                      03118 
                      03119 ;********第一点校正
07D1                  03120 ProcCalDot1:
                      03121                 movff           TempRam3,CalDot1H
07D1   584B               M                 movar           f1
07D2   5609               M                 movra           f2
                      03122                 movff           TempRam4,CalDot1L
07D3   584A               M                 movar           f1
07D4   560A               M                 movra           f2
                      03123 
                      03124                 movff           TempRam5,CalCount1H
07D5   5848               M                 movar           f1
07D6   560B               M                 movra           f2
                      03125                 movff           TempRam6,CalCount1L                     ; CalDot1H-CalCount1H
07D7   5849               M                 movar           f1
07D8   560C               M                 movra           f2
                      03126 
07D9                  03127 ProcCalDot1D:
07D9   7684           03128                 clrr             second
07DA   3C75           03129                 movai           01110101b
07DB   5613           03130                 movra           Display4
07DC   8000           03131                 call           Lcd_Dis_Sys
07DD   3C00           03132                 movai           00H
07DE   57C2           03133                 movra           LCDDS0
07DF   3C04           03134                 movai           04H
07E0   57C3           03135                 movra           LCDDS1
07E1   3C04           03136                 movai           04H
07E2   57C4           03137                 movra           LCDDS2
07E3   3C02           03138                 movai           02H
07E4   57C5           03139                 movra           LCDDS3
07E5   3C03           03140                 movai           03H
07E6   57C6           03141                 movra           LCDDS4
07E7   3C0F           03142                 movai           0FH
07E8   57C7           03143                 movra           LCDDS5
07E9   3C02           03144                 movai           02H
07EA   57C8           03145                 movra           LCDDS6
07EB   3C04           03146                 movai           04H
07EC   57C9           03147                 movra           LCDDS7
07ED   3C05           03148                 movai           05H
07EE   57CA           03149                 movra           LCDDS8
07EF   3C02           03150                 movai           02H
07F0   57CB           03151                 movra           LCDDS9
07F1   D615           03152                 bclr            SysFlag1,SteadyFlag
07F2   8000           03153                 call           delay2
07F3   D083           03154                 bclr            SysFlag6,Caldis
07F4   8000           03155                 call            Change_F1
07F5   A000           03156                 goto            ProcCalExit
                      03157 
                      03158 ;********第二点校正
07F6                  03159 ProcCalDot2:
                      03160                 movff           TempRam5,CalDot1H
07F6   584B               M                 movar           f1
07F7   560B               M                 movra           f2
                      03161                 movff           TempRam6,CalDot1L
07F8   584A               M                 movar           f1
07F9   560C               M                 movra           f2
07FA   7684           03162                  clrr             second
07FB   3C37           03163                 movai           00110111b
07FC   5613           03164                 movra           Display4
07FD   8000           03165                 call           Lcd_Dis_Sys
07FE   3C00           03166                 movai           00H
07FF   57C2           03167                 movra           LCDDS0
0800   3C04           03168                 movai           04H
0801   57C3           03169                 movra           LCDDS1
0802   3C04           03170                 movai           04H
0803   57C4           03171                 movra           LCDDS2
0804   3C02           03172                 movai           02H
0805   57C5           03173                 movra           LCDDS3
0806   3C03           03174                 movai           03H
0807   57C6           03175                 movra           LCDDS4
0808   3C0F           03176                 movai           0FH
0809   57C7           03177                 movra           LCDDS5
080A   3C02           03178                 movai           02H
080B   57C8           03179                 movra           LCDDS6
080C   3C04           03180                 movai           04H
080D   57C9           03181                 movra           LCDDS7
080E   3C05           03182                 movai           05H
080F   57CA           03183                 movra           LCDDS8
0810   3C02           03184                 movai           02H
0811   57CB           03185                 movra           LCDDS9
0812   D615           03186                 bclr            SysFlag1,SteadyFlag
0813   8000           03187                 call           delay2
                      03188 
0814   C083           03189                 bset             SysFlag6,Caldis
0815   D083           03190                 bclr             SysFlag6,Caldis
0816   8000           03191                 call            Change_F1
0817   A000           03192                 goto            ProcCalExit
                      03193 
                      03194 ;********第三点校正
0818                  03195 ProcCalDot3:
0818   3C08           03196                 movai           00001000b
0819   565F           03197                 movra           Prog_Flow
081A   8000           03198                 call            _GetAutoOnDC
081B   A000           03199                 goto            SaveCalPoint
                      03200 
                      03201 ;*******************************
081C                  03202 SaveCalPoint:
081C   000E           03203                CLRWDT
081D   3C00           03204                movai          0x00
081E   5788           03205                movra          MCR
081F   3C00           03206                movai          0x00
0820   57AE           03207                movra          OSCM
0821   3C78           03208                MOVAI          0x78
0822   57B3           03209                movra          TPSC
0823   3C64           03210                movai          0x64
0824   57AD           03211                movra          PUMP
                      03212 
0825                  03213 SaveCalPoint1R:
0825   3C0F           03214          movai          0x0F                ;16次
0826   5695           03215          movra          REG3
0827   3C00           03216          movai          0x00
0828   5784           03217          movra          FSR0
0829   3C0F           03218          movai          0x0F
082A   5785           03219          movra          FSR1
082B                  03220 SaveCalPoint1RA:
082B   8000           03221          call          ReadBie
082C   F587           03222          jbclr         Z
082D   A000           03223          goto          SaveCalPoint1RB
082E   3C04           03224                  movai          0x04
                      03225 
082F   7F84           03226                  ADDRA          FSR0
0830   6A95           03227                  DJZR           REG3
0831   A000           03228                  goto           SaveCalPoint1RA
0832   A000           03229                  goto           CalErr1          ;标定次数满
                      03230 
0833                  03231 SaveCalPoint1RB:
0833   0000           03232                nop
0834   0000           03233                nop
0835   8000           03234                call     WriteBie
0836   A000           03235                goto     IntReadBieA
                      03236 ;..................................................
0837                  03237 SaveCalPointOk:
0837   7684           03238                 clrr            second
                      03239 
0838   3CB6           03240                 movai           10110110b               ;'5'
0839   5613           03241                 movra           Display4
083A   3CB6           03242                 movai           10110110b               ;'5'
083B   5612           03243                 movra           Display3
083C   3CF3           03244                 movai           11110011b               ;'A'
083D   5611           03245                 movra           Display2
083E   3CF1           03246                 movai           11110001b               ;'P'
083F   5610           03247                 movra           Display1
0840   8000           03248                 call            Lcd_Dis_Cal
0841   8000           03249                 call            delay2
0842   000E           03250                 CLRWDT
0843   8000           03251                 call            delay1
                      03252 
0844   3C31           03253                movai       0x31
0845   57AE           03254                movra       OSCM                         ;系统高频工作,高频一直开
0846   3C63           03255                movai       0x63
0847   57AD           03256                movra       PUMP                         ;开PUMP,选择高频时钟,烧录电压7.5V,电压受VLCDX控制,LCD电压3.0V
0848   3C81           03257                movai       0x81
0849   5788           03258                movra       MCR
084A   C1CA           03259                bset        LCDDS8,0
084B   C7C7           03260                bset        LCDDS5,3
084C   3C58           03261                MOVAI       0x58
084D   57B3           03262                movra       TPSC
                      03263 
084E   3C37           03264                 movai           0x37
084F   57B1           03265                 movra           ADCR1
                      03266 
                      03267                 org     0x853
0853                  03268 SaveCalPointOk1:
                      03269                                                  ; 1S
0853   8000           03270                 call    delay1
0854   000E           03271                                 CLRWDT
0855   8000           03272                 call    delay1
0856   000E           03273                 CLRWDT
                      03274                 movfl           Prog_Flow, 00001000B
0857   3C08               M                 movai           d1
0858   565F               M                 movra           f1
                      03275                 movfl           T_Auto_Off, 12                          ;movff          T_Auto_Off,T_WeightMode
0859   3C0C               M                 movai           d1
085A   565E               M                 movra           f1
085B   C4CC           03276                 bset            AutoOn_Flags,DispOk_Flag
                      03277                 movfl           UnitFlag, 00000001B
085C   3C01               M                 movai           d1
085D   56CD               M                 movra           f1
085E   D055           03278                 bclr            Key_Up, UnitKey
085F   A000           03279                 goto            MainLoop
                      03280 
                      03281 ;校验
                      03282 
                      03283 ;**************************************************
0860                  03284 IntReadBieA:
                      03285 
0860                  03286 IntReadBieB:
0860   0000           03287          nop
0861   0000           03288          nop
0862   0000           03289          nop
0863   5989           03290          movar    INDF3
0864   5692           03291          movra    CheckRam5
0865   5983           03292          movar    HIBYTE
0866   5693           03293          movra    CheckRam6
                      03294 
0867   0000           03295          nop
0868   0000           03296          nop
0869   6F84           03297          DECR      FSR0
086A   5989           03298          movar     INDF3
086B   5690           03299          movra     CheckRam3
086C   5983           03300          movar     HIBYTE
086D   5691           03301          movra     CheckRam4
                      03302 
                      03303 
086E   0000           03304          nop
086F   0000           03305          nop
0870   6F84           03306          DECR      FSR0
0871   5989           03307          movar     INDF3
0872   568E           03308          movra     CheckRam1
0873   5983           03309          movar     HIBYTE
0874   568F           03310          movra     CheckRam2
                      03311 
                      03312 
0875   584A           03313          movar       CalDot1L
0876   408E           03314          XORAR       CheckRam1
0877   E587           03315          jbset       Z
0878   A000           03316          goto        CalErr2
                      03317 
0879   584B           03318          movar       CalDot1H
087A   408F           03319          XORAR       CheckRam2
087B   E587           03320          jbset       Z
087C   A000           03321          goto        CalErr2
                      03322 
087D   584C           03323          movar       CalDot2L
087E   4090           03324          XORAR       CheckRam3
087F   E587           03325          jbset       Z
0880   A000           03326          goto        CalErr2
                      03327 
0881   584D           03328          movar       CalDot2H
0882   4091           03329          XORAR       CheckRam4
0883   E587           03330          jbset       Z
0884   A000           03331          goto        CalErr2
                      03332 
0885   584E           03333          movar       CalDot3L
0886   4092           03334          XORAR       CheckRam5
0887   E587           03335          jbset       Z
0888   A000           03336          goto        CalErr2
                      03337 
0889   584F           03338          movar       CalDot3H
088A   4093           03339          XORAR       CheckRam6
088B   E587           03340          jbset       Z
088C   A000           03341          goto        CalErr2
088D   A000           03342          goto        SaveCalPointOk
                      03343 ;**************************************************
                      03344  ;标定次数满
088E                  03345 CalErr1:
088E   000E           03346                 clrwdt
088F   3C03           03347                 movai           00000011b
0890   5613           03348                 movra           Display4                ;'1'
0891   3C60           03349                 movai           01100000b
0892   5612           03350                 movra           Display3                ;'r'
0893   3C60           03351                 movai           01100000b
0894   5611           03352                 movra           Display2                ;'r'
0895   3CF4           03353                 movai           11110100b
0896   5610           03354                 movra           Display1                ;'E'
0897   8000           03355                 call            Lcd_Dis_Cal
0898   A000           03356                 goto            CalErr1
                      03357 ;校验出错
0899                  03358 CalErr2:
0899   000E           03359                 clrwdt
089A   3C75           03360                 movai           01110101b
089B   5613           03361                 movra           Display4                ;'2'
089C   3C60           03362                 movai           01100000b
089D   5612           03363                 movra           Display3                ;'r'
089E   3C60           03364                 movai           01100000b
089F   5611           03365                 movra           Display2                ;'r'
08A0   3CF4           03366                 movai           11110100b
08A1   5610           03367                 movra           Display1                ;'E'
08A2   8000           03368                 call            Lcd_Dis_Cal
08A3   A000           03369                 goto            CalErr2
                      03370 ;电压不稳
08A4                  03371 CalErr3:
08A4   000E           03372                 clrwdt
08A5   3C37           03373                 movai           00110111b
08A6   5613           03374                 movra           Display4                ;'3'
08A7   3C60           03375                 movai           01100000b
08A8   5612           03376                 movra           Display3                ;'r'
08A9   3C60           03377                 movai           01100000b
08AA   5611           03378                 movra           Display2                ;'r'
08AB   3CF4           03379                 movai           11110100b
08AC   5610           03380                 movra           Display1                ;'E'
08AD   8000           03381                 call            Lcd_Dis_Cal
08AE   A000           03382                 goto            CalErr3
08AF                  03383 ProcCalExit:
08AF   A000           03384                 goto            Display
                      03385 
                      03386 ;*************************************************
08B0                  03387 DisplayCount:
08B0   F25F           03388                 jbclr           Prog_Flow, 1        ; 追零标志
08B1   A000           03389                 goto            MainLoop1
                      03390 
08B2   8000           03391                 call            _GetCount
                      03392 
08B3   FECC           03393                 jbclr           AutoOn_Flags,OverLoadFlag
08B4   A000           03394                 goto            MemCount_End
                      03395 
                      03396                 ;#include       "weight.asm"
                      03397                 org             0x8b5
08B5                  03398 TrackZero_A:
08B5   FC15           03399                 jbclr           SysFlag1,NegFlag
08B6   A000           03400                 goto            TrackZero_B
08B7   760B           03401                 CLRR            TempRam5
                      03402                 movfl           TempRam6, 46            ;movff  TempRam6,StartCount
08B8   3C2E               M                 movai           d1
08B9   560C               M                 movra           f1
                      03403 
08BA   8000           03404                 call            _Sub2_2
                      03405 
08BB   F187           03406                 jbclr           PFALG, 0
08BC   A000           03407                 goto            NoTrackZero
08BD                  03408 TrackZero_B:
08BD   D483           03409                 bclr                SysFlag6,weight_have
08BE   CA15           03410                 bset                SysFlag1,ZeroFlag
08BF   DC15           03411                 bclr                SysFlag1,NegFlag
08C0   DCCC           03412                 bclr                AutoOn_Flags,OnWeightFlag
08C1   DECC           03413                 bclr                AutoOn_Flags,OverLoadFlag
08C2   7652           03414                 CLRR            CountH
08C3   7653           03415                 CLRR            CountL
08C4                  03416 TrackZero_C:
08C4   F615           03417                 jbclr           SysFlag1,SteadyFlag
08C5   A000           03418                 goto            TrackZero_E
08C6   7667           03419                 CLRR            TrackCount
08C7   A000           03420                 goto            TrackZero_End
08C8                  03421 TrackZero_D:
08C8   6667           03422                 INCR            TrackCount
08C9   3C02           03423                 movai           2       ;5              ;movfw  TrackZeroTimes
                      03424 
08CA   4867           03425                 RSUBAR          TrackCount
08CB   E187           03426                 jbset           PFALG, 0
08CC   A000           03427                 goto            TrackZero_End
08CD                  03428 TrackZero_E:
08CD   7667           03429                 CLRR            TrackCount
                      03430 
08CE   8000           03431                 call            GetZeroPoint
                      03432 
08CF   8000           03433                 call            _GetAutoOnDC
                      03434 
                      03435                 org     0x8d0
08D0   C856           03436                 bset            SysFlag3,4
08D1   A000           03437                 goto            TrackZero_End
                      03438 
                      03439 ;************************************************
08D2                  03440 NoTrackZero:
08D2   7684           03441                 CLRR            second
08D3   C4CC           03442                 bset            AutoOn_Flags,DispOk_Flag
08D4   7667           03443                 CLRR            TrackCount
08D5   C483           03444                 bset            SysFlag6,weight_have
08D6   FC15           03445                 jbclr           SysFlag1,NegFlag           ;判断称重值是否为正值
08D7   A000           03446                 goto            TrackZero_End
                      03447 
08D8   EA15           03448                 jbset           SysFlag1,ZeroFlag         ; 解锁处理,注意：要重量重新回到零后有上升沿才能解锁
08D9   A000           03449                 goto            TrackZero_End
                      03450 
                      03451                 movff           TempRam3,CountH
08DA   5852               M                 movar           f1
08DB   5609               M                 movra           f2
                      03452                 movff           TempRam4,CountL
08DC   5853               M                 movar           f1
08DD   560A               M                 movra           f2
08DE   760B           03453                 CLRR            TempRam5
                      03454                 movfl           TempRam6, 20    ;movff  TempRam6,StartCount     ; 上升沿解锁范围?(利用开机起磅重量)
08DF   3C14               M                 movai           d1
08E0   560C               M                 movra           f1
                      03455 
08E1   8000           03456                 CALL            _Sub2_2
08E2   E187           03457                 jbset            PFALG, 0
08E3   A000           03458                 GOTO            TrackZero_End
08E4                  03459 NoTrackZero4:
08E4   D466           03460                 bclr            SysFlag4,LockFlag
08E5   DA15           03461                 bclr            SysFlag1,ZeroFlag
                      03462                                                 ;bclr   SysFlag2,GlintOpenFlag
                      03463 
08E6   3C0C           03464                 movai           12
08E7   EECC           03465                 jbset           AutoOn_Flags,OverLoadFlag
08E8   565E           03466                 movra           T_Auto_Off      ;movff  T_Auto_Off,T_WeightMode
08E9                  03467 TrackZero_End:
                      03468 ;**************************************************
08E9   F466           03469                 jbclr           SysFlag4,LockFlag
08EA   A000           03470                 goto            JudgeLock_End
                      03471 
                      03472 ;**************************************************
08EB                  03473 MinusCount:
08EB   D056           03474                 bclr            SysFlag3,DspNegFlag
                      03475 
08EC   FC15           03476                 jbclr           SysFlag1,NegFlag
08ED   C056           03477                 bset            SysFlag3,DspNegFlag                     ; 负重量显示标记
08EE                  03478 MinusCount_End:
                      03479 ;**************************************************
08EE                  03480 MemCount:
                      03481 
                      03482 ;..................................................
08EE                  03483 MemCount4:
08EE   8000           03484                 call            Real_LockCount             ;Count-lockCount
08EF   760B           03485                 CLRR            TempRam5
                      03486                 movfl           TempRam6,05     ;movff  TempRam6,MemRange
08F0   3C05               M                 movai           d1
08F1   560C               M                 movra           f1
                      03487 
08F2   8000           03488                 CALL            _Sub2_2
08F3   F187           03489                 jbclr           PFALG, 0                   ;0在范围内,锁定
08F4   A000           03490                 goto            MemCount_End
                      03491                 movff           CountH,LockCountH
08F5   5860               M                 movar           f1
08F6   5652               M                 movra           f2
                      03492                 movff           CountL,LockCountL
08F7   5861               M                 movar           f1
08F8   5653               M                 movra           f2
08F9                  03493 MemCount_End:
                      03494 ;**************************************************
08F9                  03495 JudgeOverWeight:
08F9   DECC           03496                 bclr            AutoOn_Flags,OverLoadFlag
                      03497 
                      03498                 movff           TempRam3,MaxCountH
08FA   5868               M                 movar           f1
08FB   5609               M                 movra           f2
                      03499                 movff           TempRam4,MaxCountL
08FC   5869               M                 movar           f1
08FD   560A               M                 movra           f2
                      03500 
                      03501                 movff           TempRam5,CountH
08FE   5852               M                 movar           f1
08FF   560B               M                 movra           f2
                      03502                 movff           TempRam6,CountL
0900   5853               M                 movar           f1
0901   560C               M                 movra           f2
                      03503 ;                call            GetRealCount
                      03504 
                      03505                 org     0x0902
0902   8000           03506                 CALL            _Sub2_2
0903   F187           03507                 jbclr            PFALG, 0
0904   A000           03508                 goto             OverWeight_End
0905   CECC           03509                 bset            AutoOn_Flags,OverLoadFlag                       ; 超重
0906   3C37           03510                 movai            00110111b              ;'3'
0907   5613           03511                 movra            Display4
0908   3C60           03512                 movai            01100000b              ;'r'
0909   5612           03513                 movra            Display3
090A   3C60           03514                 movai            01100000b              ;'r'
090B   5611           03515                 movra            Display2
090C   3CF4           03516                 movai            11110100b              ;'E'
090D   5610           03517                 movra            Display1
090E   8000           03518                 call             Lcd_Dis_Cal
                      03519                                 ;goto             JudgeOverWeight
090F                  03520 OverWeight_End:
                      03521 ;==================================================
090F                  03522 JudgeLock:
090F   E615           03523                 jbset           SysFlag1,SteadyFlag
0910   A000           03524                 GOTO            JudgeLock_End
                      03525 
0911   FC15           03526                 jbclr           SysFlag1,NegFlag
0912   A000           03527                 GOTO            JudgeLock_End
                      03528 
0913   FA15           03529                 jbclr           SysFlag1,ZeroFlag
0914   A000           03530                 GOTO            JudgeLock_End
                      03531 
0915   FECC           03532                 jbclr           AutoOn_Flags,OverLoadFlag
0916   A000           03533                 GOTO            JudgeLock_End
                      03534 
0917   DA15           03535                 bclr                SysFlag1,ZeroFlag
0918   C466           03536                 bset                SysFlag4,LockFlag
0919   CCCC           03537                 bset                AutoOn_Flags,OnWeightFlag
                      03538                 movff           LockCountH,CountH
091A   5852               M                 movar           f1
091B   5660               M                 movra           f2
                      03539                 movff           LockCountL,CountL
091C   5853               M                 movar           f1
091D   5661               M                 movra           f2
                      03540 
091E   7663           03541                 CLRR            WTMemCount
                      03542 
091F   C862           03543                 bset            SysFlag2,GlintOpenFlag                  ; 允许进入中断处理闪烁的标志
0920   CA62           03544                 bset                SysFlag2,GlintFlag                  ; 亮
0921   7684           03545                                 CLRR            second
                      03546 
0922   7664           03547                 CLRR            LCount
0923   7665           03548                 CLRR            LLCount
0924                  03549 JudgeLock_End:
0924   760D           03550                  clrr           TempRam11
                      03551                  movff           TempRam12,CountH     ;称重显示
0925   5852               M                 movar           f1
0926   560E               M                 movra           f2
                      03552                  movff           TempRam13,CountL
0927   5853               M                 movar           f1
0928   560F               M                 movra           f2
                      03553 
0929                  03554 Display:
                      03555 
0929   EE5F           03556                 jbset           Prog_Flow, 7
092A   A000           03557                 goto            Display_weightA
092B   0000           03558                 nop
                      03559 
                      03560                 movff           TempRam11,displaycal1
092C   587B               M                 movar           f1
092D   560D               M                 movra           f2
                      03561                 movff           TempRam12,displaycal2
092E   587C               M                 movar           f1
092F   560E               M                 movra           f2
                      03562                 movff           TempRam13,displaycal3
0930   587D               M                 movar           f1
0931   560F               M                 movra           f2
0932   F083           03563                 jbclr           SysFlag6,Caldis
0933   A000           03564                 goto             Main_Hold
0934   A000           03565                 goto            Display_cal
                      03566  ;锁定显示
0935                  03567 Display_weightA:
0935   E466           03568                  jbset           SysFlag4,LockFlag
0936   A000           03569                  goto            Display_weightB
0937   0000           03570                  nop
0938   000E           03571                 CLRWDT
                      03572 
                      03573                  movff           TempRam12,LockCountH                  ;重量锁定
0939   5860               M                 movar           f1
093A   560E               M                 movra           f2
                      03574                  movff           TempRam13,LockCountL
093B   5861               M                 movar           f1
093C   560F               M                 movra           f2
                      03575 
093D   EA62           03576                  jbset           SysFlag2,GlintFlag                   ;中断闪烁亮
093E   A000           03577                  goto            Display_weightB
093F   E862           03578                  jbset           SysFlag2,GlintOpenFlag
0940   A000           03579                  goto            Display_weightB
0941   0000           03580                  nop
0942   8000           03581                  call            ClrLCDBuffer
0943   8000           03582                  call            LoadDspData            ;LCD 全灭
0944   8000           03583                  call            Lcd_Dis
0945   77C2           03584                  clrr            LCDDS0
0946   77C5           03585                  clrr            LCDDS3
0947   77C8           03586                  clrr            LCDDS6
0948   77CA           03587                  clrr            LCDDS8
0949   77CB           03588                  clrr            LCDDS9
094A   000E           03589                  CLRWDT
094B   A000           03590                  goto            MainLoop
                      03591 
                      03592 
                      03593  ;称重显示
094C                  03594 Display_weightB:
094C   FECC           03595                  jbclr           AutoOn_Flags,OverLoadFlag
094D   A000           03596                  goto            MainLoop
094E   0000           03597                  nop
094F   8000           03598                  call           Display_Weight
0950   8000           03599                  call           ClrLCDBuffer
0951   8000           03600                  call           Lcd_Dis
0952   77C2           03601                  clrr            LCDDS0
0953   77C5           03602                  clrr            LCDDS3
0954   77C8           03603                  clrr            LCDDS6
0955   77CA           03604                  clrr            LCDDS8
0956   77CB           03605                  clrr            LCDDS9
0957   8000           03606                  call           Disp_To_Ram
0958   8000           03607                  call           Lcd_Dis
                      03608 
0959   F082           03609                  jbclr           keycode,0
095A   A000           03610                  goto            MainLoop
095B   E483           03611                  jbset           SysFlag6,weight_have
095C   A000           03612                  goto            Main_Hold
095D   A000           03613                  goto            MainLoop
                      03614 ;校正显示
095E                  03615 Display_cal:
                      03616 
095E   8000           03617                  call            ClrLCDBuffer
095F   000E           03618                  CLRWDT
0960   8000           03619                  call            _Ftob
0961   8000           03620                  call            Display_Num
0962   8000           03621                  call            Lcd_Dis_Cal
0963   A000           03622                  goto            MainLoop
0964                  03623 Main_Hold:
0964   A000           03624                 goto              MainLoop
0965   C1AE           03625                 bset             OSCM,0
0966   D3AE           03626                 bclr              OSCM,1
0967   D5AE           03627                 bclr              OSCM,2
                      03628 
0968   DFB0           03629                 bclr              ADCR0,7 ;关闭AD
0969   DBB0           03630                 bclr              ADCR0,5 ;关闭PGA
096A   D9B3           03631                 bclr              TPSC,4  ;关闭LDO
096B   3C00           03632                 movai             0x00
096C   578B           03633                 movra             INTF
096D   CFA0           03634                 bset              T0CR,7
096E   000E           03635                 CLRWDT
096F   0000           03636                 NOP
0970   000B           03637                 stop
0971   0000           03638                 nop
0972   0000           03639                 nop
0973   0000           03640                 nop
                      03641 
0974   DFA0           03642                 bclr              T0CR,7
0975   C9B3           03643                 bset              TPSC,4  ;开启LDO
0976   CBB0           03644                 bset              ADCR0,5 ;开启PGA
0977   CFB0           03645                 bset              ADCR0,7 ;开启AD
0978   CF88           03646                 bset              MCR,7
0979   000E           03647                 CLRWDT
097A                  03648 wait_adif:
                      03649 
097A   E190           03650                 jbset            IOP0,0
097B   A000           03651                 goto              wait_end
097C   ED8B           03652                 jbset             ADIF
097D   A000           03653                 goto              wait_adif
097E   DD8B           03654                 BCLR              INTF,6
097F                  03655 wait2_adif:
                      03656 
097F   E190           03657                 jbset            IOP0,0
0980   A000           03658                 goto              wait_end
0981   ED8B           03659                 jbset             ADIF
0982   A000           03660                 goto              wait2_adif
0983   DD8B           03661                 BCLR              INTF,6
0984                  03662 wait_end:
0984   DD8B           03663                 BCLR              INTF,6
0985   3C30           03664                 movai       0x30
0986   57AE           03665                 movra       OSCM
0987   A000           03666                 goto              MainLoop
                      03667 
0988                  03668 Sleep_In:
0988   8000           03669                 call            _GetAutoOnDC
                      03670                 ;#include       "TurnOff.asm"
                      03671 ;*************************************************
                      03672 ;关机
                      03673 ;**********************************************
                      03674                 org             0x0989
0989                  03675 goto_allstop:
                      03676 
0989   DFB0           03677                 bclr            ADCR0,7                 ;关ADC
                      03678 ;               bclr            LVDCR,7
098A   3C2F           03679                 movai           0x2F
098B   57AF           03680                 movra           LVDCR                   ;关LVD,比较电压2.4V
098C   DBB0           03681                 bclr            ADCR0,5                 ;关PGA
098D   D9B3           03682                 bclr            TPSC,4                  ;关LDO
098E   D7B3           03683                 bclr            TPSC,3                  ;关基准电压
098F   DFA0           03684                 bclr            T0CR,7                  ;关T0
0990   DFA4           03685                 bclr            T1CR,7                  ;关T1
0991   3C00           03686                 movai           0x00
0992   57B3           03687                 movra           TPSC
0993   57B0           03688                 movra           ADCR0
0994   57B1           03689                 movra           ADCR1
0995   57BB           03690                 movra           LCDIOS2                 ;LCD引脚改为IO
0996   57BA           03691                 movra           LCDIOS1
                      03692 
                      03693 
0997   DFB8           03694                 bclr            LCDCR0,7                ;关LCD
0998   DDAD           03695                 bclr            PUMP,6                  ;关PUMP
0999   D1AE           03696                 bclr            OSCM,0                  ;高频振荡器休眠时停振
099A   C3AE           03697                 bset            OSCM,1                  ;低频振荡器始终工作
099B   C5AE           03698                 bset            OSCM,2                  ;低频时钟作为系统时钟
                      03699 
099C   3C00           03700                 movai           0x00
099D   5796           03701                 movra           PUP1                    ;P1上拉无效
099E   579A           03702                 movra           PUP2                    ;P2上拉无效
099F   579E           03703                 movra           PUP3                    ;P3上拉无效
09A0   3C00           03704                 movai           0x00
09A1   5794           03705                 movra           IOP1
09A2   5799           03706                 movra           IOP2
09A3   579D           03707                 movra           IOP3
09A4   3CFF           03708                 movai           0xFF
09A5   5795           03709                 movra           OEP1                    ;P1全输出低
09A6   5798           03710                 movra           OEP2                    ;P2全输出低
09A7   579C           03711                 movra           OEP3                    ;P3全输出低
                      03712 
09A8                  03713 goto_allstop1:
09A8   3CFE           03714                 movai           0xFE
09A9   5791           03715                 movra           OEP0                    ;p00 to input
09AA   3C01           03716                 movai           0x01
09AB   5790           03717                 movra           IOP0                    ;P01-P07输出低
09AC   3C01           03718                 movai           0x01
09AD   5792           03719                 movra           PUP0                    ;set p00 to pullup
09AE                  03720 goto_allstop2:
09AE   CF88           03721                 bset            MCR,7                   ;GIE=1
09AF   3C04           03722                 movai           0x04
09B0   578A           03723                 movra           INTE                    ;INT0IE=1
09B1   778B           03724                 clrr            INTF
09B2   000E           03725                 clrwdt
09B3   0000           03726                 NOP
                      03727 
09B4   000B           03728                 STOP                                    ;WDT能唤醒;INT0能唤醒进中断
09B5   0000           03729                 nop                                     ;唤醒后系统以低频工作
09B6   0000           03730                 nop
09B7   0000           03731                 nop
                      03732 
09B8   C1AE           03733                 bset            OSCM,0                  ;高频振荡器始终工作
09B9   C3AE           03734                 bset            OSCM,1                  ;低频振荡器始终工作
                      03735 
09BA   FB88           03736                 JBCLR           MCR,5
09BB   A000           03737                 goto            WDTWankenUp             ;发生WDT溢出
                      03738 
                      03739 ;*******************************
09BC   778B           03740                 clrr            INTF
09BD   778A           03741                 clrr            INTE
09BE   F190           03742                 jbclr           IOP0,0
09BF   A000           03743                 goto            goto_allstop2
09C0   0000           03744                 nop
09C1   0000           03745                 nop
09C2   0000           03746                 nop
09C3   0000           03747                 nop
09C4   3C20           03748                 MOVAI           0X20
09C5   8000           03749                 CALL            delay4
09C6   F190           03750                 jbclr           IOP0,0
09C7   A000           03751                 goto            goto_allstop2
09C8   A000           03752                 goto            SysInit1
                      03753 
                      03754 ;**************************************************
                      03755 ;****************@@@@@@@@@@@@@@@@@@****************
                      03756 ;**************************************************
                      03757 
                      03758 ;...............................................
                      03759                 end
gpasm-2.0.0_beta1 (Jun 21 2017)main.asm           2017-6-21  15:27:42          PAGE  2


SYMBOL TABLE
  LABEL                             VALUE

ADCInt                            0000001E
ADCInt1                           0000005A
ADCInt2                           00000068
ADCInt2Loop                       00000077
ADCInt_Time                       0000004B
ADCR0                             000001B0
ADCR1                             000001B1
ADCR2                             000001B2
ADRH                              000001B4
ADRL                              000001B6
ADRM                              000001B5
AdcInt3                           00000088
AdcOkFlag                         00000002
AdcStartFlag                      00000001
AmendZeroH                        0000005C
AmendZeroL                        0000005B
AmendZeroM                        00000071
AutoOnADH                         000000D1
AutoOnADL                         000000D2
AutoOn_Flags                      000000CC
BiePoint                          00000058
CLRR_LCD                          00000147
CalErr1                           0000088E
CalErr2                           00000899
CalErr3                           000008A4
CalNo6v_Flag                      00000006
Caldis                            00000000
Change_F1                         000000F5
CheckRam1                         0000008E
CheckRam2                         0000008F
CheckRam3                         00000090
CheckRam4                         00000091
CheckRam5                         00000092
CheckRam6                         00000093
Close_End                         00000709
ClrLCDBuffer                      00000481
ClrRam                            0000059D
CountL                            00000053
CurAD_ZeroAD                      000000E7
DataOkFlag                        00000003
DispOk_Flag                       00000002
Disp_To_Ram                       00000156
Display                           00000929
DisplayCom                        00000484
DisplayCom1                       00000485
DisplayCount                      000008B0
DisplayFlag                       00000074
DisplayRam1                       00000086
DisplayRam2                       00000087
DisplayRam3                       00000088
DisplayRam4                       00000089
Display_ADC                       0000035F
Display_ADC0                      00000371
Display_ADC1                      0000038F
Display_ADC2                      00000391
Display_ADCCAL                    00000361
Display_Num                       00000464
Display_Num1                      00000470
Display_Weight                    000002F9
Display_cal                       0000095E
Display_weightA                   00000935
Display_weightB                   0000094C
DspCalFlag                        00000001
DspHideData                       00000040
DspNegFlag                        00000000
Dsp_Hide                          00000006
Dsp_Kg                            00000000
Dsp_Lb                            00000001
Dsp_St                            00000002
Dsp_Weight_B                      00000300
Dsp_Weight_B1                     0000031A
Dsp_Weight_C                      00000304
Dsp_Weight_C1                     00000316
Dsp_Weight_St                     00000326
Dsp_Weight_St1                    00000354
Dsp_Weight_St2                    0000035A
EeFull_Flag                       00000001
EnterADC1                         00000727
ErrEFlag                          00000003
ExitIntProc                       00000014
Ext0Int                           0000001A
FSR0                              00000184
FSR1                              00000185
FirTestBie_Flag                   00000002
FirTracZeroFlag                   00000004
Fk_ADFI                           00000000
Flash5_Flag                       00000002
FlashK                            00000096
FlashZFlag                        00000007
FlashZTimeH                       0000006E
FlashZTimeL                       0000006D
FlashZeroFlag                     00000003
FullDspBuffer                     00000483
GetCount1                         000002BC
GetCount2                         000002C7
GetCount3                         000002D3
GetRealCount                      000000FA
GetZeroPoint                      000000E0
Glint1Flag                        00000005
GlintFlag                         00000005
GlintFlagCom                      00000020
GlintOpen1Flag                    00000002
GlintOpenFlag                     00000004
HIBYTE                            00000183
HIRCCR0                           000001A9
HIRCCR1                           000001AA
HIRCCR2                           000001AB
INDF0                             00000180
INDF1                             00000181
INDF2                             00000182
INDF3                             00000189
INTE0                             0000018A
INTF0                             0000018B
INVALID_ADDR0                     0000018C
INVALID_ADDR1                     0000018D
INVALID_ADDR14                    000001AC
INVALID_ADDR15                    000001BC
INVALID_ADDR16                    000001BD
INVALID_ADDR17                    000001BE
INVALID_ADDR18                    000001BF
INVALID_ADDR19                    000001C0
INVALID_ADDR2                     0000018E
INVALID_ADDR20                    000001C1
INVALID_ADDR21                    000001CE
INVALID_ADDR22                    000001CF
INVALID_ADDR23                    000001D0
INVALID_ADDR24                    000001D1
INVALID_ADDR3                     0000018F
INVALID_ADDR4                     00000193
INVALID_ADDR5                     00000197
INVALID_ADDR6                     0000019B
INVALID_ADDR7                     0000019F
INVALID_ADDRff                    000001B7
IOP0                              00000190
IOP1                              00000194
IOP2                              00000199
IOP3                              0000019D
Init_Power                        00000625
Init_Power1                       00000639
IntReadBie                        000005A8
IntReadBie1                       000005B6
IntReadBie2                       000005E4
IntReadBie3                       000005EB
IntReadBie4                       000005F7
IntReadBieA                       00000860
IntReadBieB                       00000860
InterCode1                        0000072C
InterCode1A                       0000074B
IntrruptProc                      00000008
IntrruptProc1                     00000010
Io_init                           0000056F
JudgeLock                         0000090F
JudgeLock_End                     00000924
JudgeOverWeight                   000008F9
Key1                              00000078
Key2                              00000079
KeyOn_Flag                        00000003
KeyTimes                          00000076
KeyTmr                            0000007A
Key_Exit                          00000673
Key_Times                         0000008B
Key_Up                            00000055
KgFlag                            00000000
LCDCR0                            000001B8
LCDCR1                            000001B9
LCDDS0                            000001C2
LCDDS1                            000001C3
LCDDS2                            000001C4
LCDDS3                            000001C5
LCDDS4                            000001C6
LCDDS5                            000001C7
LCDDS6                            000001C8
LCDDS7                            000001C9
LCDDS8                            000001CA
LCDDS9                            000001CB
LCDDSa                            000001CC
LCDDSb                            000001CD
LCDIOS1                           000001BA
LCDIOS2                           000001BB
LCount                            00000064
LLCount                           00000065
LVDCR                             000001AF
LXTCR                             000001A8
LbFlag                            00000001
Lcd_Dis                           000004A4
Lcd_Dis1                          000004A8
Lcd_Dis2                          000004BC
Lcd_Dis3                          000004C0
Lcd_Dis4                          000004D4
Lcd_Dis5                          000004D8
Lcd_Dis6                          000004EC
Lcd_Dis7                          000004F0
Lcd_Dis_Cal                       0000039C
Lcd_Dis_Cal1                      000003A0
Lcd_Dis_Cal2                      000003B4
Lcd_Dis_Cal3                      000003B8
Lcd_Dis_Cal4                      000003CC
Lcd_Dis_Cal5                      000003D0
Lcd_Dis_Cal6                      000003E4
Lcd_Dis_Cal7                      000003E8
Lcd_Dis_Sys                       000003FD
Lcd_Dis_Sys1                      00000401
Lcd_Num                           00000416
Lo_Counter                        00000094
LoadBIEdata                       0000060F
LoadDspData                       0000048A
LoadDspDataLoop1                  00000491
Load_LB                           00000686
Load_ST                           00000688
Load_Unit                         00000689
LockCountH                        00000060
LockCountL                        00000061
LockFlag                          00000002
LowBatFlag                        00000004
MCR                               00000188
MainLoop                          00000644
MainLoop1                         00000639
MainLoop1End                      00000644
Main_Cal                          00000728
Main_Hold                         00000964
Main_Key                          0000066D
Main_close                        00000705
Max162KG_Flag                     00000004
Max182KG_Flag                     00000005
Max202KG_Flag                     00000006
MaxCountH                         00000068
MaxCountL                         00000069
MemCount                          000008EE
MemCount4                         000008EE
MemCount_End                      000008F9
MinusCount                        000008EB
MinusCount_End                    000008EE
NegFlag                           00000006
NoSteadyCount                     00000075
NoTrackZero                       000008D2
NoTrackZero4                      000008E4
OEP0                              00000191
OEP1                              00000195
OEP2                              00000198
OEP3                              0000019C
OSCCAL                            000001F3
OSCM                              000001AE
OnWeightFlag                      00000006
OverLoadFlag                      00000007
OverWeight_End                    0000090F
PCL                               00000186
PFALG                             00000187
PUMP                              000001AD
PUP0                              00000192
PUP1                              00000196
PUP2                              0000019A
PUP3                              0000019E
Power_Flags                       0000005A
Proc1_Interrupt                   0000000B
ProcAdc_End                       00000702
ProcCalDot1                       000007D1
ProcCalDot1D                      000007D9
ProcCalDot2                       000007F6
ProcCalDot3                       00000818
ProcCalExit                       000008AF
ProcCal_0                         0000074D
ProcCal_A                         00000757
ProcCal_A1                        0000077C
ProcCal_A2                        000007A7
ProcCal_B                         000007CC
Proc_Adc1                         000006D2
Proc_Adc2                         000006E1
Proc_Adc2A                        000006F5
Proc_EnterADC1                    00000711
Proc_EnterADCEnd                  00000728
Proc_EnterADCoK                   00000718
Prog_Flow                         0000005F
REG3                              00000095
Ram_To_Disp                       0000015F
ReadBie                           00000248
ReadBie_Flag                      00000004
Real_LockCount                    00000105
Reset_Flag                        00000000
SWUnitFlag                        00000000
SaveCalPoint                      0000081C
SaveCalPoint1R                    00000825
SaveCalPoint1RA                   0000082B
SaveCalPoint1RB                   00000833
SaveCalPointOk                    00000837
SaveCalPointOk1                   00000853
ScanKeyCount                      00000077
Scankey_In                        00000668
Sleep_In                          00000988
StFlag                            00000002
Start                             0000061B
StartFlag                         00000001
Status_Flags                      0000006C
SteadyFlag                        00000004
StopFlag                          00000000
Sub10                             0000023C
Sub100                            0000022D
Sub100Loop                        00000230
Sub10kLoop                        00000211
Sub1k                             0000021D
Sub1kLoop                         00000221
SysFlag2                          00000062
SysFlag3                          00000056
SysFlag4                          00000066
SysFlag5                          0000006F
SysFlag6                          00000083
SysInit                           0000055C
SysInit1                          00000566
T0CNT                             000001A1
T0CR                              000001A0
T0DATA                            000001A3
T0LOAD                            000001A2
T1CNT                             000001A5
T1CR                              000001A4
T1DATA                            000001A7
T1LOAD                            000001A6
TF1                               00000054
TF_01A                            00000000
TF_01B                            00000001
TF_05A                            00000002
TF_05B                            00000003
TPSC                              000001B3
T_Auto_Off                        0000005E
TempRam8                          00000072
TempRam9                          00000073
TestWdt                           00000001
TestWdtIn                         00000518
Test_LowBat                       0000064A
Test_LowBat01                     0000064C
Timer1S                           00000057
TimerInt1A                        0000003B
TimerInt2End                      0000003D
TimerInt3                         0000003D
TimerInt4                         00000047
TrackCount                        00000067
TrackZero_A                       000008B5
TrackZero_B                       000008BD
TrackZero_C                       000008C4
TrackZero_D                       000008C8
TrackZero_E                       000008CD
TrackZero_End                     000008E9
TwoUnit_Flag                      00000003
UnLockDelayFlag                   00000003
UnStableFlag                      00000005
UnitFlag                          000000CD
UnitKey                           00000000
Unit_Dis                          00000504
Unit_DisKG                        0000050A
Unit_DisLB                        0000050D
Unit_DisST                        00000511
Unit_key                          00000670
Unstable                          00000700
WDTClock                          0000051A
WDTWakenUp0                       00000550
WDTWakenUp1                       00000556
WDTWakenUp2                       00000557
WDTWakenUpEnd                     0000055B
WDTWakenUpLoop                    00000522
WDTWakenUpLoop1                   00000523
WDTWankenUp                       00000514
WDT_STOP                          00000538
WDT_WAIT                          00000538
WTMemCount                        00000063
WakenOn_Flag                      00000000
WakenUpCount                      00000070
WdtProcADFlag                     00000000
WdtTrackBFlag                     00000007
WdtTrackSFlag                     00000006
WdtWaken_Flag                     00000001
WriteBie                          00000260
ZFlashUnitFlag                    00000007
ZeroFlag                          00000005
ZhenDong_Flag                     00000001
_.org_8_008E                      0000008E
_.org_8_0098                      00000098
_.org_8_00A0                      000000A0
_.org_8_00AC                      000000AC
_.org_8_00B8                      000000B8
_.org_8_00C4                      000000C4
_.org_8_00D0                      000000D0
_.org_8_013E                      0000013E
_.org_8_0144                      00000144
_.org_8_016C                      0000016C
_.org_8_0176                      00000176
_Add2_2                           00000184
_Div6_3                           000001AA
_Div6_3Loop                       000001AD
_Div6_3Loop1                      000001C6
_Ftob                             00000208
_GetAutoOnDC                      0000010F
_GetAutoOnDCLoop                  00000121
_GetAutoOnDCLoop1                 0000012F
_GetCount                         00000285
_GetCount123                      0000028D
_GetUnitAux                       00000673
_GetUnitAuxEnd                    0000068B
_GetUnitAuxKey                    00000675
_GetUnitAuxKey1                   00000682
_Mul3_2                           000001DC
_Mul3_2Loop                       000001EE
_Mul3_2Loop1                      000001FE
_ProcAdc                          0000068B
_ProcAdc0                         000006A2
_ProcAdd1                         000001C9
_ProcAdd1_A                       000001D5
_Sub2_2                           00000189
_Sub3_3                           00000197
__7212                            00000001
ad_init                           0000058F
delay1                            0000008A
delay2                            0000009A
delay2A                           000000A9
delay3                            00000168
delay4                            00000178
delay_reg1                        0000008A
discard_ad                        000000DC
displaycal1                       0000007B
displaycal2                       0000007C
displaycal3                       0000007D
dlylp4                            00000179
goto_allstop                      00000989
goto_allstop1                     000009A8
goto_allstop2                     000009AE
inte_init                         00000583
keycode                           00000082
lcd_disp0                         00000443
lcd_disp1                         00000446
lcd_disp2                         00000449
lcd_disp3                         0000044C
lcd_disp4                         0000044F
lcd_disp5                         00000452
lcd_disp6                         00000455
lcd_disp7                         00000458
lcd_disp8                         0000045B
lcd_disp9                         0000045E
lcd_disp_null                     00000461
option                            0000013B
rst_clr                           0000055E
second                            00000084
second2                           0000008C
second3                           0000008D
sub1                              00000245
sub10Loop                         0000023E
sys_init                          00000566
tempcal1                          0000007E
tempcal2                          0000007F
tempcal3                          00000080
tempcal4                          00000081
wait2_adif                        0000097F
wait_adif                         0000097A
wait_adifE                        00000545
wait_end                          00000984
weight_have                       00000002
ADCHS_0                           0<<4
ADCHS_1                           1<<4
ADCHS_2                           2<<4
ADCHS_3                           3<<4
ADCHS_4                           4<<4
ADCHS_5                           5<<4
ADCHS_6                           6<<4
ADCKS_16                          0<<1
ADCKS_2                           2<<1
ADCKS_4                           2<<1
ADCKS_8                           1<<1
ADEN                              ADCR0,0
ADEOC                             ADCR0,3
ADIE                              INTECON,6
ADIF                              INTF,6
ADRamH                            0x28
ADRamL                            0x2a
ADRamM                            0x29
ADV_2V                            0
ADV_3V                            1
ADV_4V                            2
ADV_ADD                           3
ADV_EX                            4
AD_Temp0                          0x2b
AD_Temp1                          0x2c
AD_Temp2                          0x2d
AD_Temp3                          0x2e
AdcCount                          0x42
AdcOkFlag                         2
AdcStartFlag                      1
BUZ0OUT                           T0CR,5
BUZ1OUT                           T1CR,5
Buffer0                           0x00
Buffer1                           0x01
Buffer2                           0x02
Buffer3                           0x03
Buffer4                           0x04
Buffer5                           0x05
Buffer6                           0x06
C                                 PFALG,0
CLKS                              OSCM,2
CalConstH                         0x51
CalConstL                         0x50
CalCount1H                        0x48
CalCount1L                        0x49
CalDot1H                          0x4B
CalDot1L                          0x4A
CalDot2H                          0x4D
CalDot2L                          0x4C
CalDot3H                          0x4F
CalDot3L                          0x4E
Count1                            0x47
CountH                            0x52
DC                                PFALG,1
DDR10                             DDR1,0
DDR11                             DDR1,1
DDR12                             DDR1,2
DDR13                             DDR1,3
DDR20                             DDR2,0
DDR21                             DDR2,1
DDR22                             DDR2,2
DDR23                             DDR2,3
DDR24                             DDR2,4
DDR25                             DDR2,5
DDR26                             DDR2,6
DDR27                             DDR2,7
Display1                          0x10
Display2                          0x11
Display3                          0x12
Display4                          0x13
DisplayFs1                        0x14
DspData                           0x3f
DspData1                          0x40
DspZou8Count                      0x39
Dsp_Col                           7
Dsp_Point                         7
ENB                               POWCR,6
EPEN                              UCR,3
FREF                              UFR,7
FSR                               FSR0
FtobH                             TempRam8
FtobL                             TempRam9
GIE                               MCR,7
HFEN                              OSCM,0
H_DATA                            0x1c
H_DATAA                           0x1f
H_DATAB                           0x22
H_DATAC                           0x25
H_DR                              0x16
H_DRBuf                           0x19
INDF                              INDF0
INT0IE                            INTECON,2
INT0IF                            INTF,2
INT1IE                            INTECON,3
INT1IF                            INTF,3
INTE                              INTECON
INTECON                           INTE0
INTEFLAG                          INTF0
INTF                              INTEFLAG
KBIE                              INTECON,4
KBIF                              INTF,4
LCDDS10                           LCDDSa
LCDDS11                           LCDDSb
LCDDS12                           LCDDSc
LCDDS13                           LCDDSd
LCDDS14                           LCDDSe
LCDDS15                           LCDDSf
LCDEN                             LCDCR0,7
LDOEN                             POWCR,7
LFEN                              OSCM,1
LVD                               PLVDCR,7
LVDS                              PLVDCR,6
L_DATA                            0x1e
L_DATAA                           0x21
L_DATAB                           0x24
L_DATAC                           0x27
L_DR                              0x18
L_DRBuf                           0x1b
M_DATA                            0x1d
M_DATAA                           0x20
M_DATAB                           0x23
M_DATAC                           0x26
M_DR                              0x17
M_DRBuf                           0x1a
OPEN                              UCR,4
OVEF                              UFR,5
P0HCON                            PUP0
P1HCON                            PUP1
P20PH                             P2HCON,0
P21PH                             P2HCON,1
P22PH                             P2HCON,2
P23PH                             P2HCON,3
P24PH                             P2HCON,4
P25PH                             P2HCON,5
P26PH                             P2HCON,6
P27PH                             P2HCON,7
PAEF                              UFR,6
PWM0OUT                           T0CR,6
PWM1OUT                           T1CR,6
RDAF                              UFR,1
Reg0                              0x35
Reg1                              0x36
Reg2                              0x37
Reg3                              0x38
STATUS                            PFALG
STBH                              OSCM,4
STBL                              OSCM,5
SampleTimes                       0x3c
StableCount                       0x46
StatusBank                        0x3b
SteadyFlag                        3
SysFlag1                          0x015
T0IE                              INTECON,0
T0IF                              INTF,0
T1IE                              INTECON,1
T1IF                              INTF,1
TBASE01S                          0x3d
TBASE05S                          0x3e
TC0EN                             T0CR,7
TC1EN                             T1CR,7
TREF                              UFR,0
TSEF                              UFR,4
Tbase1S                           0x41
TempRam1                          0x07
TempRam11                         0x0d
TempRam12                         0x0e
TempRam13                         0x0f
TempRam2                          0x08
TempRam3                          0x09
TempRam4                          0x0a
TempRam5                          0x0b
TempRam6                          0x0c
UARTEN                            UCR,2
VLCDS                             LCDCR0,3
WorkRegBank                       0x3a
Z                                 PFALG,2
ZeroH                             0xCE
ZeroL                             0xD0
ZeroM                             0xCF
delay_reg                         0x34

Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     0 reported,     0 suppressed

